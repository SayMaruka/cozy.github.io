<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <meta name="author" content="CozyCloud - https://cozy.io">
        <link rel="canonical" href="https://docs.cozy.io/cozy-konnector-libs/api/">
        <link rel="shortcut icon" href="../../img/favicon.png">
        
        <title>API - Dev Documentation</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
            <link href="../../css/extra.css" rel="stylesheet">
            <link href="../../css/highlight_theme.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

	<script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://docs.cozy.io/">Dev Documentation</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../..">Home</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorials <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../tutorials/app/">Create Your Application</a>
</li>
                            
<li >
    <a href="../../tutorials/konnector/">Develop a Connector</a>
</li>
                            
<li >
    <a href="../../tutorials/selfhost-debian/">Self-Host on Debian</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">How-to <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
  <li class="dropdown-submenu">
    <a href="#">Dev</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../howTos/dev/runCozyDocker/">Run an App in a Cozy using Docker</a>
</li>
            
<li >
    <a href="../../howTos/dev/hmr/">Use Hot Module Replacement in Your App</a>
</li>
            
<li >
    <a href="../../howTos/dev/cordova/">Make a Mobile App Using Cordova</a>
</li>
            
<li >
    <a href="../../howTos/dev/connect-mobile-app-local-stack/">Connect a Mobile App to Your Local Stack</a>
</li>
            
<li >
    <a href="../../howTos/dev/sendmail/">Send and Receive E-mails in Development</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Synchronize</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../howTos/sync/linux/">Install Cozy Drive on GNU/Linux</a>
</li>
    </ul>
  </li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">References <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../references/tech-intro/">Technical introduction to the Cozy platform</a>
</li>
                            
<li >
    <a href="../../references/git-flow/">Our Front-End Git Flow</a>
</li>
                            
  <li class="dropdown-submenu">
    <a href="#">Stack and tools</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">cozy-app-publish</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-app-publish/README/">CLI & Workflow</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-apps-registry</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-apps-registry/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-client</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-client/getting-started/">Getting started</a>
</li>
            
<li >
    <a href="../../cozy-client/how-tos/">How tos</a>
</li>
            
<li >
    <a href="../../cozy-client/api/cozy-client/">Cozy Client API</a>
</li>
            
<li >
    <a href="../../cozy-client/api/cozy-pouch-link/">Cozy Pouch Link API</a>
</li>
            
<li >
    <a href="../../cozy-client/api/cozy-stack-client/">Cozy Stack Client API</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-client-js</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-client-js/README/">README</a>
</li>
            
<li >
    <a href="../../cozy-client-js/intro/">Introduction</a>
</li>
            
<li >
    <a href="../../cozy-client-js/browser-sdk-transition/">Transition from cozy-browser-sdk</a>
</li>
            
<li >
    <a href="../../cozy-client-js/offline/">How to support offline</a>
</li>
            
<li >
    <a href="../../cozy-client-js/oauth/">OAuth guide</a>
</li>
            
<li >
    <a href="../../cozy-client-js/auth-api/">Authentication API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/data-api/">Data System API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/files-api/">Files API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/jobs-api/">Jobs API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/intents-api/">Intents API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/settings-api/">Settings API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/sharing-api/">Sharing API</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-ui</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-ui/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-doctypes</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-doctypes/docs/README/">README</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.accounts/">Accounts</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.photos.albums/">Albums</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.bank/">Banking doctypes</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.bills/">Bills</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.konnectors/">Connectors</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.contacts/">Contacts</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.files/">Files</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.notifications/">Notifications</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.remote.requests/">Remote requests</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.sessions.logins/">Session logins</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.sharings/">Sharings</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.triggers/">Triggers</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-konnector-libs</a>
    <ul class="dropdown-menu">
            
<li class="active">
    <a href="./">API</a>
</li>
            
<li >
    <a href="../cli/">CLI</a>
</li>
            
<li >
    <a href="/en/dev/">Develop</a>
</li>
            
<li >
    <a href="../errors/">Errors</a>
</li>
            
<li >
    <a href="../operation-linking/">Operation linking</a>
</li>
            
<li >
    <a href="../synchronization/">Synchronization</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-stack</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/README/">README</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Usage</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/INSTALL/">Install the cozy-stack</a>
</li>
            
<li >
    <a href="../../cozy-stack/config/">Configuration file</a>
</li>
            
<li >
    <a href="../../cozy-stack/instance/">Managing Instances</a>
</li>
            
<li >
    <a href="../../cozy-stack/security/">Security</a>
</li>
            
<li >
    <a href="../../cozy-stack/cli/cozy-stack/">Manpages of the command-line tool</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">How-to guides for developpers</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/client-app-dev/">Develop a client-side app</a>
</li>
            
<li >
    <a href="../../cozy-stack/docker/">Running and building Docker images</a>
</li>
            
<li >
    <a href="../../cozy-stack/assets/">Working with the stack assets</a>
</li>
            
<li >
    <a href="../../cozy-stack/release/">Build a release</a>
</li>
            
<li >
    <a href="../../cozy-stack/CONTRIBUTING/">The contributing guide</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Explanations</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/sharing-design/">Sharing design</a>
</li>
            
<li >
    <a href="../../cozy-stack/konnectors-workflow/">Workflow of the konnectors</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">List of services</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/auth/">/auth - Authentication & OAuth</a>
</li>
            
<li >
    <a href="../../cozy-stack/apps/">/apps - Applications Management</a>
</li>
            
<li >
    <a href="../../cozy-stack/registry/"> /apps - Apps registry</a>
</li>
            
<li >
    <a href="../../cozy-stack/konnectors/"> /apps - Konnectors</a>
</li>
            
<li >
    <a href="../../cozy-stack/data-system/">/data - Data System</a>
</li>
            
<li >
    <a href="../../cozy-stack/mango/"> /data - Mango</a>
</li>
            
<li >
    <a href="../../cozy-stack/replication/"> /data - Replication</a>
</li>
            
<li >
    <a href="../../cozy-stack/couchdb-quirks/"> /data - CouchDB Quirks</a>
</li>
            
<li >
    <a href="../../cozy-stack/pouchdb-quirks/"> /data - PouchDB Quirks</a>
</li>
            
<li >
    <a href="../../cozy-stack/files/">/files - Virtual File System</a>
</li>
            
<li >
    <a href="../../cozy-stack/references-docs-in-vfs/"> /files - References of documents in VFS</a>
</li>
            
<li >
    <a href="../../cozy-stack/intents/">/intents - Intents</a>
</li>
            
<li >
    <a href="../../cozy-stack/jobs/">/jobs - Jobs</a>
</li>
            
<li >
    <a href="../../cozy-stack/workers/"> /jobs - Workers</a>
</li>
            
<li >
    <a href="../../cozy-stack/move/">/move - Move, export and import an instance</a>
</li>
            
<li >
    <a href="../../cozy-stack/notifications/">/notifications - Notifications</a>
</li>
            
<li >
    <a href="../../cozy-stack/public/">/public - Public</a>
</li>
            
<li >
    <a href="../../cozy-stack/permissions/">/permissions - Permissions</a>
</li>
            
<li >
    <a href="../../cozy-stack/realtime/">/realtime - Realtime</a>
</li>
            
<li >
    <a href="../../cozy-stack/remote/">/remote - Proxy for remote data/API</a>
</li>
            
<li >
    <a href="../../cozy-stack/settings/">/settings - Settings</a>
</li>
            
<li >
    <a href="../../cozy-stack/user-action-required/"> /settings - Terms of Services</a>
</li>
            
<li >
    <a href="../../cozy-stack/sharing/">/sharings - Sharing</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">konitor</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../konitor/cli/">CLI</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">babel-preset-cozy-app</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../babel-preset-cozy-app/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">commitlint-config-cozy</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../commitlint-config-cozy/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-device-helper</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-device-helper/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">eslint-config-cozy-app</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../eslint-config-cozy-app/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-flags</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-flags/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-realtime</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-realtime/README/">README</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li>
                        <a href="https://github.com/cozy/cozy.github.io/">
                                <i class="fa fa-github"></i>GitHub
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3 main-toc">
<div class="bs-sidebar hidden-print affix" role="complementary">
    <ul class="nav bs-sidenav well" style='padding-left: 0; padding-right: 0; margin-bottom: 1.5rem'>
        <li class="main active"><a href="#api">API</a></li>
        <li class="main "><a href="#modules">Modules</a></li>
        <li class="main "><a href="#classes">Classes</a></li>
        <li class="main "><a href="#constants">Constants</a></li>
        <li class="main "><a href="#functions">Functions</a></li>
        <li class="main "><a href="#adddata">addData</a></li>
            <li><a href="#moduleexports">module.exports() ⏏</a></li>
        <li class="main "><a href="#cozyclient">cozyClient</a></li>
            <li><a href="#moduleexports_1">module.exports ⏏</a></li>
        <li class="main "><a href="#hydrateandfilter">hydrateAndFilter</a></li>
            <li><a href="#hydrateandfilter_1">hydrateAndFilter() ⏏</a></li>
        <li class="main "><a href="#linkbankoperations">linkBankOperations</a></li>
            <li><a href="#moduleexports_2">module.exports() ⏏</a></li>
        <li class="main "><a href="#mkdirp">mkdirp</a></li>
            <li><a href="#moduleexports_3">module.exports ⏏</a></li>
        <li class="main "><a href="#normalizefilename">normalizeFilename</a></li>
            <li><a href="#normalizefilename_1">normalizeFilename() ⏏</a></li>
        <li class="main "><a href="#savebills">saveBills</a></li>
            <li><a href="#moduleexports_4">module.exports() ⏏</a></li>
        <li class="main "><a href="#savefiles">saveFiles</a></li>
            <li><a href="#savefiles_1">saveFiles() ⏏</a></li>
        <li class="main "><a href="#signin">signin</a></li>
            <li><a href="#moduleexports_5">module.exports() ⏏</a></li>
        <li class="main "><a href="#solvecaptcha">solveCaptcha</a></li>
            <li><a href="#moduleexports_6">module.exports() ⏏</a></li>
        <li class="main "><a href="#updateorcreate">updateOrCreate</a></li>
            <li><a href="#moduleexportsentries-doctype-matchingattributes-promise">module.exports(entries, doctype, matchingAttributes) ⇒ Promise ⏏</a></li>
        <li class="main "><a href="#utils">utils</a></li>
            <li><a href="#utilsfetchall">utils~fetchAll()</a></li>
            <li><a href="#utilsqueryall">utils~queryAll()</a></li>
            <li><a href="#utilsfindduplicates">utils~findDuplicates()</a></li>
            <li><a href="#utilsbatchupdateattributes">utils~batchUpdateAttributes()</a></li>
            <li><a href="#utilsbatchdelete">utils~batchDelete()</a></li>
            <li><a href="#utilsgetpdftext">utils~getPdfText()</a></li>
            <li><a href="#utilsformatdate">utils~formatDate()</a></li>
        <li class="main "><a href="#basekonnector">BaseKonnector</a></li>
            <li><a href="#new-basekonnectorfetch">new BaseKonnector(fetch)</a></li>
            <li><a href="#basekonnectorend">baseKonnector.end()</a></li>
            <li><a href="#basekonnectorfail">baseKonnector.fail()</a></li>
            <li><a href="#basekonnectorinit-promise">baseKonnector.init() ⇒ Promise</a></li>
            <li><a href="#basekonnectorsaveaccountdatadata-options-promise">baseKonnector.saveAccountData(data, options) ⇒ Promise</a></li>
            <li><a href="#basekonnectorgetaccountdata-object">baseKonnector.getAccountData() ⇒ object</a></li>
            <li><a href="#basekonnectorupdateaccountattributes">baseKonnector.updateAccountAttributes()</a></li>
            <li><a href="#basekonnectorterminatemessage">baseKonnector.terminate(message)</a></li>
        <li class="main "><a href="#cookiekonnector">CookieKonnector</a></li>
            <li><a href="#new-cookiekonnectorrequestfactoryoptions">new CookieKonnector(requestFactoryOptions)</a></li>
            <li><a href="#cookiekonnectorinit-promise">cookieKonnector.init() ⇒ Promise</a></li>
            <li><a href="#cookiekonnectorend">cookieKonnector.end()</a></li>
            <li><a href="#cookiekonnectorrequestfactoryoptions-object">cookieKonnector.requestFactory(options) ⇒ object</a></li>
            <li><a href="#cookiekonnectorresetsession-promise">cookieKonnector.resetSession() ⇒ Promise</a></li>
            <li><a href="#cookiekonnectorinitsession-promise">cookieKonnector.initSession() ⇒ Promise</a></li>
            <li><a href="#cookiekonnectorsavesession-promise">cookieKonnector.saveSession() ⇒ Promise</a></li>
            <li><a href="#cookiekonnectorsignin-promise">cookieKonnector.signin() ⇒ Promise</a></li>
            <li><a href="#cookiekonnectorsavefiles-promise">cookieKonnector.saveFiles() ⇒ Promise</a></li>
            <li><a href="#cookiekonnectorsavebills-promise">cookieKonnector.saveBills() ⇒ Promise</a></li>
        <li class="main "><a href="#document">Document</a></li>
            <li><a href="#documentisequal">document.isEqual()</a></li>
        <li class="main "><a href="#login_failed-string">LOGIN_FAILED : String</a></li>
        <li class="main "><a href="#not_existing_directory-string">NOT_EXISTING_DIRECTORY : String</a></li>
        <li class="main "><a href="#vendor_down-string">VENDOR_DOWN : String</a></li>
        <li class="main "><a href="#user_action_needed-string">USER_ACTION_NEEDED : String</a></li>
        <li class="main "><a href="#file_download_failed-string">FILE_DOWNLOAD_FAILED : String</a></li>
        <li class="main "><a href="#save_file_failed-string">SAVE_FILE_FAILED : String</a></li>
        <li class="main "><a href="#disk_quota_exceeded-string">DISK_QUOTA_EXCEEDED : String</a></li>
        <li class="main "><a href="#challenge_asked-string">CHALLENGE_ASKED : String</a></li>
        <li class="main "><a href="#login_failed_too_many_attempts-string">LOGIN_FAILED_TOO_MANY_ATTEMPTS : String</a></li>
        <li class="main "><a href="#user_action_needed_oauth_outdated-string">USER_ACTION_NEEDED_OAUTH_OUTDATED : String</a></li>
        <li class="main "><a href="#user_action_needed_account_removed-string">USER_ACTION_NEEDED_ACCOUNT_REMOVED : String</a></li>
        <li class="main "><a href="#user_action_needed_change_password-string">USER_ACTION_NEEDED_CHANGE_PASSWORD : String</a></li>
        <li class="main "><a href="#user_action_needed_permissions_changed-string">USER_ACTION_NEEDED_PERMISSIONS_CHANGED : String</a></li>
        <li class="main "><a href="#user_action_needed_cgu_form-string">USER_ACTION_NEEDED_CGU_FORM : String</a></li>
        <li class="main "><a href="#captcha_resolution_failed-string">CAPTCHA_RESOLUTION_FAILED : String</a></li>
        <li class="main "><a href="#mkspec">mkSpec()</a></li>
        <li class="main "><a href="#scrape-specs-childselector-object-124-array">scrape($, spec(s), [childSelector]) ⇒ object | array</a></li>
            <li><a href="#permissions">⚠ Permissions</a></li>
    </ul>
  <div style='padding-left: 2rem'>
    
    <a id='edit-link' href='https://github.com/cozy/cozy.github.io/edit/dev/src/cozy-konnector-libs/api.md'>Edit documentation</a>
    <script type='text/javascript'>
        /* Here we detect if the current page is from an external documentation and we 
        change the href of the editing link so it goes to the right repository and file */
        const outsideDocs = [{"name": "cozy-app-publish", "repo": "https://github.com/cozy/cozy-app-publish.git", "subdir": "."}, {"name": "cozy-apps-registry", "repo": "https://github.com/cozy/cozy-apps-registry.git", "subdir": "."}, {"name": "cozy-client", "repo": "https://github.com/cozy/cozy-client.git", "subdir": "docs"}, {"name": "cozy-client-js", "repo": "https://github.com/cozy/cozy-client-js.git", "subdir": "docs"}, {"name": "cozy-ui", "repo": "https://github.com/cozy/cozy-ui.git", "subdir": "docs"}, {"name": "cozy-doctypes", "repo": "https://github.com/cozy/cozy-doctypes.git", "subdir": "."}, {"name": "cozy-konnector-libs", "repo": "https://github.com/konnectors/libs.git", "subdir": "packages/cozy-konnector-libs/docs"}, {"name": "cozy-scripts", "repo": "https://github.com/CPatchane/create-cozy-app.git", "subdir": "packages/cozy-scripts/docs"}, {"name": "cozy-stack", "repo": "https://github.com/cozy/cozy-stack.git", "subdir": "docs"}, {"name": "konitor", "repo": "https://github.com/konnectors/konitor.git", "subdir": "docs"}, {"name": "babel-preset-cozy-app", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/babel-preset-cozy-app"}, {"name": "commitlint-config-cozy", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/commitlint-config-cozy"}, {"name": "cozy-device-helper", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-device-helper"}, {"name": "eslint-config-cozy-app", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/eslint-config-cozy-app"}, {"name": "cozy-flags", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-flags"}, {"name": "cozy-realtime", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-realtime"}]
        const editNode = document.querySelector('#edit-link')
        const pathname = window.location.pathname
        const editURI = 'edit/master/'
        const removeGitSuffix = function (x) { return x.replace(/\.git$/, '') }

        // Returns the external repo associated to a pathname
        const detectExternalRepo = function (pathname) {
            for (var outsideDoc of outsideDocs) {
                if (window.location.pathname.includes('/' + outsideDoc.name + '/')) {
                    return outsideDoc
                }
            }
        }

        // Change the href attribute of a link to point to the correct edition page on GitHub
        // for the passed external documentation
        const fixEditLink = function (editNode, externalDoc) {
            const repoFile = pathname.replace('/en/' + externalDoc.name, '').replace(/\/$/, '.md')
            const baseRepo = removeGitSuffix(externalDoc.repo)
            editNode.href = baseRepo + '/' + editURI + externalDoc.subdir + repoFile
        }

        const externalRepo = detectExternalRepo(pathname)
        if (externalRepo) {
            fixEditLink(editNode, externalRepo)
        }
    </script>
    
  </div>
</div></div>
                <div class="col-md-9" role="main">
                    

<h2 id="api">API<a class="headerlink" href="#api" title="Permanent link">&para;</a></h2>
<h2 id="modules">Modules<a class="headerlink" href="#modules" title="Permanent link">&para;</a></h2>
<dl>
<dt><a href="#module_addData">addData</a></dt>
<dd><p>Saves the data into the cozy blindly without check.</p>
</dd>
<dt><a href="#module_cozyClient">cozyClient</a></dt>
<dd><p><a href="https://cozy.github.io/cozy-client-js/">cozy-client-js</a> instance already
initialized and ready to use.</p>
</dd>
<dt><a href="#module_hydrateAndFilter">hydrateAndFilter</a></dt>
<dd><p>Filters the passed array from data already present in the cozy so that there is
not duplicated data in the Cozy.</p>
</dd>
<dt><a href="#module_linkBankOperations">linkBankOperations</a></dt>
<dd><p>Finds links between bills and bank operations.</p>
</dd>
<dt><a href="#module_mkdirp">mkdirp</a></dt>
<dd></dd>
<dt><a href="#module_normalizeFilename">normalizeFilename</a></dt>
<dd><p>Returns the given name, replacing characters that could be an issue when
used in a filename with spaces.</p>
</dd>
<dt><a href="#module_saveBills">saveBills</a></dt>
<dd><p>Encapsulates the saving of Bills : saves the files, saves the new data, and associate the files
to an existing bank operation</p>
</dd>
<dt><a href="#module_saveFiles">saveFiles</a></dt>
<dd><p>Saves the given files in the given folder via the Cozy API.</p>
</dd>
<dt><a href="#module_signin">signin</a></dt>
<dd><p>Provides an handy method to log the user in,
on HTML form pages. On success, it resolves to a promise with a parsed body.</p>
</dd>
<dt><a href="#module_solveCaptcha">solveCaptcha</a></dt>
<dd><p>Use every possible means to solve a captcha. At the moment, Anticaptcha web service is used if
any related secret key is found in COZY_PARAMETERS environment variable.</p>
</dd>
<dt><a href="#module_updateOrCreate">updateOrCreate</a></dt>
<dd><p>Creates or updates the given entries according to if they already
exist in the cozy or not</p>
</dd>
<dt><a href="#module_utils">utils</a></dt>
<dd><p>Small utilities helping to develop konnectors.</p>
</dd>
</dl>

<h2 id="classes">Classes<a class="headerlink" href="#classes" title="Permanent link">&para;</a></h2>
<dl>
<dt><a href="#BaseKonnector">BaseKonnector</a></dt>
<dd><p>The class from which all the connectors must inherit.
It takes a fetch function in parameter that must return a <code>Promise</code>.
You need at least the <code>GET</code> permission on <code>io.cozy.accounts</code> in your manifest to allow it to
fetch account information for your connector.</p>
</dd>
<dt><a href="#CookieKonnector">CookieKonnector</a></dt>
<dd><p>Connector base class extending BaseKonnector which handles cookie session in a central way
It also handles saving cookie session in the account and automatically restore it for the next
connector run.
All cozy-konnector-libs tools using request are proposed as methods of this class to force them
to use the central cookie which can be saved/restored.
You need at least the <code>GET</code> and <code>PUT</code> permissions on <code>io.cozy.accounts</code> in your manifest to allow
it to save/restore cookies</p>
</dd>
<dt><a href="#Document">Document</a></dt>
<dd><p>Simple Model for Documents. Allows to specify
<code>shouldSave</code>, <code>shouldUpdate</code> as methods.</p>
<p>Has useful <code>isEqual</code> method</p>
</dd>
</dl>

<h2 id="constants">Constants<a class="headerlink" href="#constants" title="Permanent link">&para;</a></h2>
<dl>
<dt><a href="#LOGIN_FAILED">LOGIN_FAILED</a> : <code>String</code></dt>
<dd><p>The konnector could not login</p>
</dd>
<dt><a href="#NOT_EXISTING_DIRECTORY">NOT_EXISTING_DIRECTORY</a> : <code>String</code></dt>
<dd><p>The folder specified as folder_to_save does not exist (checked by BaseKonnector)</p>
</dd>
<dt><a href="#VENDOR_DOWN">VENDOR_DOWN</a> : <code>String</code></dt>
<dd><p>The vendor&#39;s website is down</p>
</dd>
<dt><a href="#USER_ACTION_NEEDED">USER_ACTION_NEEDED</a> : <code>String</code></dt>
<dd><p>There was an unexpected error, please take a look at the logs to know what happened</p>
</dd>
<dt><a href="#FILE_DOWNLOAD_FAILED">FILE_DOWNLOAD_FAILED</a> : <code>String</code></dt>
<dd><p>There was a problem while downloading a file</p>
</dd>
<dt><a href="#SAVE_FILE_FAILED">SAVE_FILE_FAILED</a> : <code>String</code></dt>
<dd><p>There was a problem while saving a file</p>
</dd>
<dt><a href="#DISK_QUOTA_EXCEEDED">DISK_QUOTA_EXCEEDED</a> : <code>String</code></dt>
<dd><p>Could not save a file to the cozy because of disk quota exceeded</p>
</dd>
<dt><a href="#CHALLENGE_ASKED">CHALLENGE_ASKED</a> : <code>String</code></dt>
<dd><p>It seems that the website requires a second authentification factor that we don’t support yet.</p>
</dd>
<dt><a href="#LOGIN_FAILED_TOO_MANY_ATTEMPTS">LOGIN_FAILED_TOO_MANY_ATTEMPTS</a> : <code>String</code></dt>
<dd><p>Temporarily blocked</p>
</dd>
<dt><a href="#USER_ACTION_NEEDED_OAUTH_OUTDATED">USER_ACTION_NEEDED_OAUTH_OUTDATED</a> : <code>String</code></dt>
<dd><p>Access refresh required</p>
</dd>
<dt><a href="#USER_ACTION_NEEDED_ACCOUNT_REMOVED">USER_ACTION_NEEDED_ACCOUNT_REMOVED</a> : <code>String</code></dt>
<dd><p>Unavailable account</p>
</dd>
<dt><a href="#USER_ACTION_NEEDED_CHANGE_PASSWORD">USER_ACTION_NEEDED_CHANGE_PASSWORD</a> : <code>String</code></dt>
<dd><p>Unavailable account</p>
</dd>
<dt><a href="#USER_ACTION_NEEDED_PERMISSIONS_CHANGED">USER_ACTION_NEEDED_PERMISSIONS_CHANGED</a> : <code>String</code></dt>
<dd><p>Password update required</p>
</dd>
<dt><a href="#USER_ACTION_NEEDED_CGU_FORM">USER_ACTION_NEEDED_CGU_FORM</a> : <code>String</code></dt>
<dd><p>The user needs to accept a CGU form before accessing the rest of the website</p>
</dd>
<dt><a href="#CAPTCHA_RESOLUTION_FAILED">CAPTCHA_RESOLUTION_FAILED</a> : <code>String</code></dt>
<dd><p>solveCaptcha failed to solve the captcha</p>
</dd>
</dl>

<h2 id="functions">Functions<a class="headerlink" href="#functions" title="Permanent link">&para;</a></h2>
<dl>
<dt><a href="#mkSpec">mkSpec()</a></dt>
<dd><p>Declarative scraping.</p>
<p>Describe your items attributes and where to find/parse them
instead of imperatively building them.</p>
<p>Heavily inspired by <a href="https://medialab.github.io/artoo/">artoo</a> scraping method.</p>
</dd>
<dt><a href="#scrape">scrape($, spec(s), [childSelector])</a> ⇒ <code>object</code> | <code>array</code></dt>
<dd><p>Scrape a cheerio object for properties</p>
</dd>
</dl>

<p><a name="module_addData"></a></p>
<h2 id="adddata">addData<a class="headerlink" href="#adddata" title="Permanent link">&para;</a></h2>
<p>Saves the data into the cozy blindly without check.</p>
<p><a name="exp_module_addData--module.exports"></a></p>
<h3 id="moduleexports">module.exports() ⏏<a class="headerlink" href="#moduleexports" title="Permanent link">&para;</a></h3>
<p>Saves the data into the cozy blindly without check.</p>
<p>You need at least the <code>POST</code> permission for the given doctype in your manifest, to be able to
use this function.</p>
<p>Parameters:</p>
<ul>
<li><code>documents</code>: an array of objects corresponding to the data you want to save in the cozy</li>
<li><code>doctype</code> (string): the doctype where you want to save data (ex: &lsquo;io.cozy.bills&rsquo;)</li>
</ul>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">documents</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;toto&#39;</span><span class="p">,</span>
    <span class="nx">height</span><span class="o">:</span> <span class="mf">1.8</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;titi&#39;</span><span class="p">,</span>
    <span class="nx">height</span><span class="o">:</span> <span class="mf">1.7</span>
  <span class="p">}</span>
<span class="p">]</span>

<span class="k">return</span> <span class="nx">addData</span><span class="p">(</span><span class="nx">documents</span><span class="p">,</span> <span class="s1">&#39;io.cozy.height&#39;</span><span class="p">)</span>
</pre></div>


<p><strong>Kind</strong>: Exported function<br />
<a name="module_cozyClient"></a></p>
<h2 id="cozyclient">cozyClient<a class="headerlink" href="#cozyclient" title="Permanent link">&para;</a></h2>
<p><a href="https://cozy.github.io/cozy-client-js/">cozy-client-js</a> instance already
initialized and ready to use.</p>
<p><a name="exp_module_cozyClient--module.exports"></a></p>
<h3 id="moduleexports_1">module.exports ⏏<a class="headerlink" href="#moduleexports_1" title="Permanent link">&para;</a></h3>
<p><a href="https://cozy.github.io/cozy-client-js/">cozy-client-js</a> instance already initialized and ready to use.</p>
<p>If you want to access cozy-client-js directly, this method gives you directly an instance of it,
initialized according to <code>COZY_URL</code> and <code>COZY_CREDENTIALS</code> environment variable given by cozy-stack
You can refer to the <a href="https://cozy.github.io/cozy-client-js/">cozy-client-js documentation</a> for more information.</p>
<p>Example :</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="p">{</span><span class="nx">cozyClient</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cozy-konnector-libs&#39;</span><span class="p">)</span>

<span class="nx">cozyClient</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">defineIndex</span><span class="p">(</span><span class="s1">&#39;my.doctype&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;_id&#39;</span><span class="p">])</span>
</pre></div>


<p><strong>Kind</strong>: Exported member<br />
<a name="module_hydrateAndFilter"></a></p>
<h2 id="hydrateandfilter">hydrateAndFilter<a class="headerlink" href="#hydrateandfilter" title="Permanent link">&para;</a></h2>
<p>Filters the passed array from data already present in the cozy so that there is
not duplicated data in the Cozy.</p>
<ul>
<li><a href="#module_hydrateAndFilter">hydrateAndFilter</a><ul>
<li><a href="#exp_module_hydrateAndFilter--hydrateAndFilter">hydrateAndFilter()</a> ⏏<ul>
<li><a href="#module_hydrateAndFilter--hydrateAndFilter..suitableCall">~suitableCall()</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><a name="exp_module_hydrateAndFilter--hydrateAndFilter"></a></p>
<h3 id="hydrateandfilter_1">hydrateAndFilter() ⏏<a class="headerlink" href="#hydrateandfilter_1" title="Permanent link">&para;</a></h3>
<p>Filters the passed array from data already present in the cozy so that there is
not duplicated data in the Cozy.</p>
<p>You need at least the <code>GET</code> permission for the given doctype in your manifest, to be able to
use this function.</p>
<p>Parameters:</p>
<ul>
<li><code>documents</code>: an array of objects corresponding to the data you want to save in the cozy</li>
<li><code>doctype</code> (string): the doctype where you want to save data (ex: &lsquo;io.cozy.bills&rsquo;)</li>
<li><code>options</code> :</li>
<li><code>keys</code> (array) : List of keys used to check that two items are the same. By default it is set to `[&lsquo;id&rsquo;]&rsquo;.</li>
<li><code>index</code> (optionnal) : Return value returned by <code>cozy.data.defineIndex</code>, the default will correspond to all documents of the selected doctype.</li>
<li><code>selector</code> (optionnal object) : Mango request to get records. Default is built from the keys <code>{selector: {_id: {"$gt": null}}}</code> to get all the records.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">documents</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;toto&#39;</span><span class="p">,</span>
    <span class="nx">height</span><span class="o">:</span> <span class="mf">1.8</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;titi&#39;</span><span class="p">,</span>
    <span class="nx">height</span><span class="o">:</span> <span class="mf">1.7</span>
  <span class="p">}</span>
<span class="p">]</span>

<span class="k">return</span> <span class="nx">hydrateAndFilter</span><span class="p">(</span><span class="nx">documents</span><span class="p">,</span> <span class="s1">&#39;io.cozy.height&#39;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">keys</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">filteredDocuments</span> <span class="p">=&gt;</span> <span class="nx">addData</span><span class="p">(</span><span class="nx">filteredDocuments</span><span class="p">,</span> <span class="s1">&#39;io.cozy.height&#39;</span><span class="p">))</span>
</pre></div>


<p><strong>Kind</strong>: Exported function<br />
<a name="module_hydrateAndFilter--hydrateAndFilter..suitableCall"></a></p>
<h4 id="hydrateandfiltersuitablecall">hydrateAndFilter~suitableCall()<a class="headerlink" href="#hydrateandfiltersuitablecall" title="Permanent link">&para;</a></h4>
<p>Since we can use methods or basic functions for
<code>shouldSave</code> and <code>shouldUpdate</code> we pass the
appropriate <code>this</code> and <code>arguments</code>.</p>
<p>If <code>funcOrMethod</code> is a method, it will be called
with args[0] as <code>this</code> and the rest as <code>arguments</code>
Otherwise, <code>this</code> will be null and <code>args</code> will be passed
as <code>arguments</code>.</p>
<p><strong>Kind</strong>: inner method of <a href="#exp_module_hydrateAndFilter--hydrateAndFilter"><code>hydrateAndFilter</code></a><br />
<a name="module_linkBankOperations"></a></p>
<h2 id="linkbankoperations">linkBankOperations<a class="headerlink" href="#linkbankoperations" title="Permanent link">&para;</a></h2>
<p>Finds links between bills and bank operations.</p>
<p><a name="exp_module_linkBankOperations--module.exports"></a></p>
<h3 id="moduleexports_2">module.exports() ⏏<a class="headerlink" href="#moduleexports_2" title="Permanent link">&para;</a></h3>
<p>Will soon move to a dedicated service. You should not use it.</p>
<p>Finds links between bills and bank operations.</p>
<p><strong>Kind</strong>: Exported function<br />
<a name="module_mkdirp"></a></p>
<h2 id="mkdirp">mkdirp<a class="headerlink" href="#mkdirp" title="Permanent link">&para;</a></h2>
<p><a name="exp_module_mkdirp--module.exports"></a></p>
<h3 id="moduleexports_3">module.exports ⏏<a class="headerlink" href="#moduleexports_3" title="Permanent link">&para;</a></h3>
<p>Creates a directory and its missing ancestors as needed.</p>
<p>Options :</p>
<ul>
<li><code>...pathComponents</code>:  one or many path components to be joined</li>
</ul>
<div class="codehilite"><pre><span></span><span class="nx">await</span> <span class="nx">mkdirp</span><span class="p">(</span><span class="s1">&#39;/foo&#39;</span><span class="p">)</span> <span class="c1">// Creates /foo</span>
<span class="nx">await</span> <span class="nx">mkdirp</span><span class="p">(</span><span class="s1">&#39;/foo&#39;</span><span class="p">)</span> <span class="c1">// Does nothing as /foo already exists</span>
<span class="nx">await</span> <span class="nx">mkdirp</span><span class="p">(</span><span class="s1">&#39;/bar/baz&#39;</span><span class="p">)</span> <span class="c1">// Creates /bar, then /bar/baz</span>
<span class="nx">await</span> <span class="nx">mkdirp</span><span class="p">(</span><span class="s1">&#39;/foo/bar/baz&#39;</span><span class="p">)</span> <span class="c1">// Creates /foo/bar, then /foo/bar/baz, not /foo</span>
<span class="nx">await</span> <span class="nx">mkdirp</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="c1">// Does nothing</span>
<span class="nx">await</span> <span class="nx">mkdirp</span><span class="p">(</span><span class="s1">&#39;/qux&#39;</span><span class="p">,</span> <span class="s1">&#39;qux2/qux3&#39;</span><span class="p">,</span> <span class="s1">&#39;qux4&#39;</span><span class="p">)</span> <span class="c1">// Creates /qux, then /qux/qux2,</span>
                                          <span class="c1">// then /qux/qux2/qux3 and</span>
                                          <span class="c1">// finally /qux/qux2/qux3/qux4</span>
</pre></div>


<p>The function will automatically add a leading slash when missing:</p>
<div class="codehilite"><pre><span></span><span class="nx">await</span> <span class="nx">mkdirp</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span> <span class="c1">// Creates /foo, then /foo/bar</span>
</pre></div>


<p><strong>Kind</strong>: Exported member<br />
<a name="module_normalizeFilename"></a></p>
<h2 id="normalizefilename">normalizeFilename<a class="headerlink" href="#normalizefilename" title="Permanent link">&para;</a></h2>
<p>Returns the given name, replacing characters that could be an issue when
used in a filename with spaces.</p>
<p><a name="exp_module_normalizeFilename--normalizeFilename"></a></p>
<h3 id="normalizefilename_1">normalizeFilename() ⏏<a class="headerlink" href="#normalizefilename_1" title="Permanent link">&para;</a></h3>
<p>Returns the given name, replacing characters that could be an issue when
used in a filename with spaces.</p>
<p>Replaced characters include:</p>
<ul>
<li>Those forbidden on one or many popular OS or filesystem: <code>&lt;&gt;:"/\|?*</code></li>
<li>Those forbidden by the cozy-stack <code>\0</code>, <code>\r</code> and <code>\n</code></li>
<li>Multiple spaces and/or tabs are replaced with a single space</li>
<li>Leading &amp; trailing spaces and/or tabs are removed</li>
</ul>
<p>An exception will be thrown in case there is not any filename-compatible
character in the given name.</p>
<p>Parameters:</p>
<ul>
<li><code>basename</code> is whatever string you want to generate the filename from</li>
<li><code>ext</code> is an optional file extension, with or without leading dot</li>
</ul>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="p">{</span> <span class="nx">normalizeFilename</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cozy-konnector-libs&#39;</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">filename</span> <span class="o">=</span> <span class="nx">normalizeFilename</span><span class="p">(</span><span class="s1">&#39;*foo/bar: &lt;baz&gt; \\&quot;qux&quot;\t???&#39;</span><span class="p">,</span> <span class="s1">&#39;.txt&#39;</span><span class="p">)</span>
<span class="c1">// `filename` === `foo bar baz qux.txt`</span>
</pre></div>


<p><strong>Kind</strong>: Exported function<br />
<a name="module_saveBills"></a></p>
<h2 id="savebills">saveBills<a class="headerlink" href="#savebills" title="Permanent link">&para;</a></h2>
<p>Encapsulates the saving of Bills : saves the files, saves the new data, and associate the files
to an existing bank operation</p>
<p><a name="exp_module_saveBills--module.exports"></a></p>
<h3 id="moduleexports_4">module.exports() ⏏<a class="headerlink" href="#moduleexports_4" title="Permanent link">&para;</a></h3>
<p>Combines the features of <code>saveFiles</code>, <code>hydrateAndFilter</code>, <code>addData</code> and <code>linkBankOperations</code> for a
common case: bills.
Will create <code>io.cozy.bills</code> objects. The default deduplication keys are <code>['date', 'amount', 'vendor']</code>.
You need the full permission on <code>io.cozy.bills</code>, full permission on <code>io.cozy.files</code> and also
full permission on <code>io.cozy.bank.operations</code> in your manifest, to be able to use this function.</p>
<p>Parameters:</p>
<ul>
<li><code>documents</code> is an array of objects with any attributes with some mandatory attributes :</li>
<li><code>amount</code> (Number): the amount of the bill used to match bank operations</li>
<li><code>date</code> (Date): the date of the bill also used to match bank operations</li>
<li><code>vendor</code> (String): the name of the vendor associated to the bill. Ex: &lsquo;trainline&rsquo;
  You can also pass attributes expected by <code>saveFiles</code>
  Please take a look at <a href="https://github.com/cozy/cozy-doctypes/blob/master/docs/io.cozy.bills.md">io.cozy.bills doctype documentation</a></li>
<li><code>fields</code> (object) this is the first parameter given to BaseKonnector&rsquo;s constructor</li>
<li><code>options</code> is passed directly to <code>saveFiles</code>, <code>hydrateAndFilter</code>, <code>addData</code> and <code>linkBankOperations</code>.</li>
</ul>
<p><strong>Kind</strong>: Exported function<br />
<strong>Example</strong>  </p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="p">{</span> <span class="nx">BaseKonnector</span><span class="p">,</span> <span class="nx">saveBills</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cozy-konnector-libs&#39;</span><span class="p">)</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BaseKonnector</span><span class="p">(</span><span class="kd">function</span> <span class="nx">fetch</span> <span class="p">(</span><span class="nx">fields</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">documents</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="c1">// some code which fills documents</span>
  <span class="k">return</span> <span class="nx">saveBills</span><span class="p">(</span><span class="nx">documents</span><span class="p">,</span> <span class="nx">fields</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">identifiers</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;vendor&#39;</span><span class="p">]</span>
  <span class="p">})</span>
<span class="p">})</span>
</pre></div>


<p><a name="module_saveFiles"></a></p>
<h2 id="savefiles">saveFiles<a class="headerlink" href="#savefiles" title="Permanent link">&para;</a></h2>
<p>Saves the given files in the given folder via the Cozy API.</p>
<p><a name="exp_module_saveFiles--saveFiles"></a></p>
<h3 id="savefiles_1">saveFiles() ⏏<a class="headerlink" href="#savefiles_1" title="Permanent link">&para;</a></h3>
<p>Saves the files given in the fileurl attribute of each entries</p>
<p>You need the full permission on <code>io.cozy.files</code> in your manifest to use this function.</p>
<ul>
<li>
<p><code>files</code> is an array of <code>{ fileurl, filename }</code> :</p>
</li>
<li>
<p>fileurl: The url of the file. This attribute is mandatory or this item will be ignored (can be a function returning the value)</p>
</li>
<li>filestream: the stream which will be directly passed to cozyClient.files.create (can also be
  function returning the stream)</li>
<li>requestOptions (object) : The options passed to request to fetch fileurl (can be a function returning the value)</li>
<li>filename : The file name of the item written on disk. This attribute is optional and as default value, the
    file name will be &ldquo;smartly&rdquo; guessed by the function. Use this attribute if the guess is not smart
  enough for you (can be a function returning the value).</li>
<li><code>shouldReplaceName</code> (string) default: <code>undefined</code> use to select the old filename to replace
  by filename if possible (can be a function returning the value)</li>
<li><code>shouldReplaceFile</code> (function) default: use this function to state if the current file
  should be redownloaded and replaced. You can use the same attribute directly in the entry.</li>
<li>
<p><code>fileAttributes</code> (object) ex: <code>{created_at: new Date()}</code> sets some additionnal file
  attributes passed to cozyClient.file.create</p>
</li>
<li>
<p><code>fields</code> (string) is the argument given to the main function of your connector by the BaseKonnector.
     It especially contains a <code>folderPath</code> which is the string path configured by the user in
     collect/home</p>
</li>
<li>
<p><code>options</code> (object) is optional. Possible options :</p>
</li>
<li>
<p><code>timeout</code> (timestamp) can be used if your connector needs to fetch a lot of files and if the
  stack does not give enough time to your connector to fetch it all. It could happen that the
  connector is stopped right in the middle of the download of the file and the file will be
  broken. With the <code>timeout</code> option, the <code>saveFiles</code> function will check if the timeout has
  passed right after downloading each file and then will be sure to be stopped cleanly if the
  timeout is not too long. And since it is really fast to check that a file has already been
  downloaded, on the next run of the connector, it will be able to download some more
  files, and so on. If you want the timeout to be in 10s, do <code>Date.now() + 10*1000</code>.
  You can try it in the previous code.</p>
</li>
<li><code>contentType</code> (string) ex: &lsquo;application/pdf&rsquo; used to force the contentType of documents when
  they are badly recognized by cozy.</li>
<li><code>concurrency</code> (number) default: <code>1</code> sets the maximum number of concurrent downloads</li>
</ul>
<p><strong>Kind</strong>: Exported function<br />
<strong>Example</strong>  </p>
<div class="codehilite"><pre><span></span><span class="nx">await</span> <span class="nx">saveFiles</span><span class="p">([{</span><span class="nx">fileurl</span><span class="o">:</span> <span class="s1">&#39;https://...&#39;</span><span class="p">,</span> <span class="nx">filename</span><span class="o">:</span> <span class="s1">&#39;bill1.pdf&#39;</span><span class="p">}],</span> <span class="nx">fields</span><span class="p">)</span>
</pre></div>


<p><a name="module_signin"></a></p>
<h2 id="signin">signin<a class="headerlink" href="#signin" title="Permanent link">&para;</a></h2>
<p>Provides an handy method to log the user in,
on HTML form pages. On success, it resolves to a promise with a parsed body.</p>
<p><a name="exp_module_signin--module.exports"></a></p>
<h3 id="moduleexports_5">module.exports() ⏏<a class="headerlink" href="#moduleexports_5" title="Permanent link">&para;</a></h3>
<p>Provides an handy method to log the user in,
on HTML form pages. On success, it resolves to a promise with a parsed body.</p>
<p>Errors:</p>
<ul>
<li>LOGIN_FAILED if the validate predicate is false</li>
<li>INVALID_FORM if the element matched by <code>formSelector</code> is not a form or has
  no <code>action</code> attribute</li>
<li>UNKNOWN_PARSING_STRATEGY if <code>parse</code> is not one of the accepted values:
  <code>raw</code>, <code>cheerio</code>, <code>json</code>.</li>
<li>VENDOR_DOWN if a request throws a RequestError, or StatusCodeError</li>
</ul>
<p>It does not submit values provided through <code>select</code> tags, except if populated
by user with <code>formData</code>.</p>
<ul>
<li>
<p><code>url</code> is the url to access the html form</p>
</li>
<li>
<p><code>formSelector</code> is used by cheerio to uniquely identify the form in which to
  log in</p>
</li>
<li>
<p><code>formData</code> is an object <code>{ name: value, … }</code>. It is used to populate the
  form, in the proper inputs with the same name as the properties of this
  object, before submitting it. It can also be a function that returns this
  object. The page at <code>url</code> would be given as argument, right after having
  been parsed through <code>cheerio</code>.</p>
</li>
<li>
<p><code>parse</code> allow the user to resolve <code>signin</code> with a preparsed body. The
  choice of the strategy for the parsing is one of : <code>raw</code>, <code>json</code> or
  <code>cheerio</code>. <code>cheerio</code> being the default.</p>
</li>
<li>
<p><code>validate</code> is a predicate taking three arguments <code>statusCode</code>, <code>parsedBody</code> and <code>fullResponse</code>.
  If it is false, <code>LOGIN_FAILED</code> is thrown, otherwise the
  signin resolves with <code>parsedBody</code> value.</p>
</li>
<li>
<p><code>requestOpts</code> allows to pass eventual options to the <code>signin</code>&lsquo;s
  <code>requestFactory</code>. It could be useful for pages using <code>latin1</code> <code>encoding</code>
  for instance.</p>
</li>
</ul>
<p><strong>Kind</strong>: Exported function<br />
<strong>Example</strong><br />
== basic example : ==</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">$</span> <span class="o">=</span> <span class="nx">signin</span><span class="p">({</span>
  <span class="nx">url</span><span class="o">:</span> <span class="sb">`http://quotes.toscrape.com/login`</span><span class="p">,</span>
  <span class="nx">formSelector</span><span class="o">:</span> <span class="s1">&#39;form&#39;</span><span class="p">,</span>
  <span class="nx">formData</span><span class="o">:</span> <span class="p">{</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">password</span> <span class="p">}</span>
<span class="p">})</span>
</pre></div>


<p>If the behavior of the targeted website is not standard. You can pass a validate function which
will allow you to:
 - detect if the credentials work or not -&gt; LOGIN_FAILED
 - detect if actions from the user are needed -&gt; USER_ACTION_NEEDED
 - detect if the targeted website is out -&gt; VENDOR_DOWN
<strong>Example</strong>  </p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">$</span> <span class="o">=</span> <span class="nx">signin</span><span class="p">({</span>
  <span class="nx">url</span><span class="o">:</span> <span class="sb">`http://quotes.toscrape.com/login`</span><span class="p">,</span>
  <span class="nx">formSelector</span><span class="o">:</span> <span class="s1">&#39;form&#39;</span><span class="p">,</span>
  <span class="nx">formData</span><span class="o">:</span> <span class="p">{</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">password</span> <span class="p">},</span>
  <span class="nx">validate</span><span class="o">:</span> <span class="p">(</span><span class="nx">statusCode</span><span class="p">,</span> <span class="nx">$</span><span class="p">,</span> <span class="nx">fullResponse</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">if</span> <span class="p">(</span><span class="nx">statusCode</span> <span class="o">!==</span> <span class="mi">200</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span> <span class="c1">// LOGIN_FAILED</span>
   <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.cgu&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;USER_ACTION_NEEDED&#39;</span><span class="p">)</span>
   <span class="k">if</span> <span class="p">(</span><span class="nx">fullResponse</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">uri</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">))</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;VENDOR_DOWN&#39;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">})</span>
</pre></div>


<p>Do not forget that the use of the signin function is not mandatory in a connector and won&rsquo;t work
if the signin page does not use html forms. Here, a simple POST request may be a lot more
simple.
<a name="module_solveCaptcha"></a></p>
<h2 id="solvecaptcha">solveCaptcha<a class="headerlink" href="#solvecaptcha" title="Permanent link">&para;</a></h2>
<p>Use every possible means to solve a captcha. At the moment, Anticaptcha web service is used if
any related secret key is found in COZY_PARAMETERS environment variable.</p>
<p><a name="exp_module_solveCaptcha--module.exports"></a></p>
<h3 id="moduleexports_6">module.exports() ⏏<a class="headerlink" href="#moduleexports_6" title="Permanent link">&para;</a></h3>
<p>Use every possible means to solve a captcha. At the moment, Anticaptcha web service is used if
any related secret key is found in COZY_PARAMETERS environment variable.
If you do not want to solve the captcha each time the connector is run, please also use
CookieKonnector which will help you save the session.</p>
<p>Parameters:</p>
<ul>
<li><code>params</code> is an array of objects with any attributes with some mandatory attributes :</li>
<li><code>type</code> (String): (default recaptcha) type of captcha to solve</li>
<li><code>timeout</code> (Number): (default 4 minutes after now) time when the solver should stop trying to
  solve the captcha</li>
<li><code>websiteKey</code> (String): the key you can find on the targeted website</li>
<li><code>websiteURL</code> (String): The URL of the page showing the captcha
Returns: Promise with the solved captcha response as a string</li>
</ul>
<p><strong>Kind</strong>: Exported function<br />
<strong>Example</strong>  </p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="p">{</span> <span class="nx">solveCaptcha</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cozy-konnector-libs&#39;</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">solvedKey</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">solveCaptcha</span><span class="p">({</span>
  <span class="nx">websiteKey</span><span class="o">:</span> <span class="s1">&#39;the key in the webpage&#39;</span><span class="p">,</span>
  <span class="nx">websiteURL</span><span class="o">:</span> <span class="s1">&#39;http://quotes.toscrape.com/login&#39;</span><span class="p">,</span>
<span class="p">})</span>
<span class="c1">// now use the solveKey to submit your form</span>
</pre></div>


<p><a name="module_updateOrCreate"></a></p>
<h2 id="updateorcreate">updateOrCreate<a class="headerlink" href="#updateorcreate" title="Permanent link">&para;</a></h2>
<p>Creates or updates the given entries according to if they already
exist in the cozy or not</p>
<p><a name="exp_module_updateOrCreate--module.exports"></a></p>
<h3 id="moduleexportsentries-doctype-matchingattributes-promise">module.exports(entries, doctype, matchingAttributes) ⇒ <code>Promise</code> ⏏<a class="headerlink" href="#moduleexportsentries-doctype-matchingattributes-promise" title="Permanent link">&para;</a></h3>
<p>Creates or updates the given entries according to if they already
exist in the cozy or not</p>
<p>You need the full permission for the given doctype in your manifest, to be able to
use this function.</p>
<p><strong>Kind</strong>: Exported function  </p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>entries</td>
<td><code>Array.&lt;Object&gt;</code></td>
<td>Documents to save</td>
</tr>
<tr>
<td>doctype</td>
<td><code>String</code></td>
<td>Doctype of the documents</td>
</tr>
<tr>
<td>matchingAttributes</td>
<td><code>Array.&lt;String&gt;</code></td>
<td>attributes in each entry used to check if an entry already exists in the Cozy</td>
</tr>
</tbody>
</table>
<p><a name="module_utils"></a></p>
<h2 id="utils">utils<a class="headerlink" href="#utils" title="Permanent link">&para;</a></h2>
<p>Small utilities helping to develop konnectors.</p>
<ul>
<li><a href="#module_utils">utils</a><ul>
<li><a href="#module_utils..fetchAll">~fetchAll()</a></li>
<li><a href="#module_utils..queryAll">~queryAll()</a></li>
<li><a href="#module_utils..findDuplicates">~findDuplicates()</a></li>
<li><a href="#module_utils..batchUpdateAttributes">~batchUpdateAttributes()</a></li>
<li><a href="#module_utils..batchDelete">~batchDelete()</a></li>
<li><a href="#module_utils..getPdfText">~getPdfText()</a></li>
<li><a href="#module_utils..formatDate">~formatDate()</a></li>
</ul>
</li>
</ul>
<p><a name="module_utils..fetchAll"></a></p>
<h3 id="utilsfetchall">utils~fetchAll()<a class="headerlink" href="#utilsfetchall" title="Permanent link">&para;</a></h3>
<p>This function allows to fetch all documents for a given doctype. It is the fastest to get all
documents but without filtering possibilities
deprecated by the findAll method from cozyClient</p>
<p>Parameters:</p>
<ul>
<li><code>doctype</code> (string): the doctype from which you want to fetch the data</li>
</ul>
<p><strong>Kind</strong>: inner method of <a href="#module_utils"><code>utils</code></a><br />
<a name="module_utils..queryAll"></a></p>
<h3 id="utilsqueryall">utils~queryAll()<a class="headerlink" href="#utilsqueryall" title="Permanent link">&para;</a></h3>
<p>This function allows to fetch all documents for a given doctype exceeding the 100 limit.
It is slower that fetchAll because it fetches the data 100 by 100 but allows to filter the data
with a selector and an index</p>
<p>Parameters:</p>
<ul>
<li><code>doctype</code> (string): the doctype from which you want to fetch the data</li>
<li><code>selector</code> (object): the mango query selector</li>
<li><code>index</code> (object): (optional) the query selector index. If not defined, the function will
create it&rsquo;s own index with the keys specified in the selector</li>
</ul>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">documents</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">queryAll</span><span class="p">(</span><span class="s1">&#39;io.cozy.bills&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">vendor</span><span class="o">:</span> <span class="s1">&#39;Direct Energie&#39;</span><span class="p">})</span>
</pre></div>


<p><strong>Kind</strong>: inner method of <a href="#module_utils"><code>utils</code></a><br />
<a name="module_utils..findDuplicates"></a></p>
<h3 id="utilsfindduplicates">utils~findDuplicates()<a class="headerlink" href="#utilsfindduplicates" title="Permanent link">&para;</a></h3>
<p>This function find duplicates in a given doctype, filtered by an optional mango selector</p>
<p>Parameters:</p>
<ul>
<li><code>doctype</code> (string): the doctype from which you want to fetch the data</li>
<li><code>selector</code> (object): (optional) the mango query selector</li>
<li><code>options</code> :</li>
<li><code>keys</code> (array) : List of keys used to check that two items are the same.</li>
<li><code>index</code> (optionnal) : Return value returned by <code>cozy.data.defineIndex</code>, the default will correspond to all documents of the selected doctype.</li>
<li><code>selector</code> (optionnal object) : Mango request to get records. Gets all the records by default</li>
</ul>
<p>Returns an object with the following keys:
<em> <code>toKeep</code>: this is the list of unique documents that you should keep in db
</em> <code>toRemove</code>: this is the list of documents that can remove from db. If this is io.cozy.bills
documents, do not forget to clean linked bank operations</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="p">{</span><span class="nx">toKeep</span><span class="p">,</span> <span class="nx">toRemove</span><span class="p">}</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">findDuplicates</span><span class="p">(</span><span class="s1">&#39;io.cozy.bills&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">selector</span><span class="o">:</span> <span class="p">{</span><span class="nx">vendor</span><span class="o">:</span> <span class="s1">&#39;Direct Energie&#39;</span><span class="p">}})</span>
</pre></div>


<p><strong>Kind</strong>: inner method of <a href="#module_utils"><code>utils</code></a><br />
<a name="module_utils..batchUpdateAttributes"></a></p>
<h3 id="utilsbatchupdateattributes">utils~batchUpdateAttributes()<a class="headerlink" href="#utilsbatchupdateattributes" title="Permanent link">&para;</a></h3>
<p>This is a shortcut to update multiple documents in one call</p>
<p>Parameters:</p>
<ul>
<li><code>doctype</code> (string): the doctype from which you want to fetch the data</li>
<li><code>ids</code> (array): array of ids of documents to update</li>
<li><code>transformation</code> (object): attributes to change with their values</li>
<li><code>options</code> :</li>
<li><code>keys</code> (array) : List of keys used to check that two items are the same.</li>
<li><code>index</code> (optionnal) : Return value returned by <code>cozy.data.defineIndex</code>, the default will correspond to all documents of the selected doctype.</li>
<li><code>selector</code> (optionnal object) : Mango request to get records. Gets all the records by default</li>
</ul>
<p>Returns a promise which resolves with all the return values of updateAttributes</p>
<div class="codehilite"><pre><span></span><span class="nx">await</span> <span class="nx">batchUpdateAttributes</span><span class="p">(</span><span class="s1">&#39;io.cozy.bills&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">{</span><span class="nx">vendor</span><span class="o">:</span> <span class="s1">&#39;Direct Energie&#39;</span><span class="p">})</span>
</pre></div>


<p><strong>Kind</strong>: inner method of <a href="#module_utils"><code>utils</code></a><br />
<a name="module_utils..batchDelete"></a></p>
<h3 id="utilsbatchdelete">utils~batchDelete()<a class="headerlink" href="#utilsbatchdelete" title="Permanent link">&para;</a></h3>
<p>This is a shortcut to delete multiple documents in one call</p>
<p>Parameters:</p>
<ul>
<li><code>doctype</code> (string): the doctype from which you want to fetch the data</li>
<li><code>documents</code> (array): documents to delete with their ids</li>
<li><code>transformation</code> (object): attributes to change with their values</li>
<li><code>options</code> :</li>
<li><code>keys</code> (array) : List of keys used to check that two items are the same.</li>
<li><code>index</code> (optionnal) : Return value returned by <code>cozy.data.defineIndex</code>, the default will correspond to all documents of the selected doctype.</li>
<li><code>selector</code> (optionnal object) : Mango request to get records. Gets all the records by default</li>
</ul>
<p>Returns a promise which resolves with all the return values of updateAttributes</p>
<p>Example to remove all the documents for a given doctype</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">documents</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">fetchAll</span><span class="p">(</span><span class="s1">&#39;io.cozy.marvel&#39;</span><span class="p">)</span>
<span class="nx">await</span> <span class="nx">batchDelete</span><span class="p">(</span><span class="s1">&#39;io.cozy.marvel&#39;</span><span class="p">,</span> <span class="nx">documents</span><span class="p">)</span>
</pre></div>


<p><strong>Kind</strong>: inner method of <a href="#module_utils"><code>utils</code></a><br />
<a name="module_utils..getPdfText"></a></p>
<h3 id="utilsgetpdftext">utils~getPdfText()<a class="headerlink" href="#utilsgetpdftext" title="Permanent link">&para;</a></h3>
<p>This function can read the content of a cozy pdf file and output its text</p>
<p>Parameters:</p>
<ul>
<li><code>fileId</code> (string): the id of the file in the cozy</li>
<li><code>options</code> :</li>
<li><code>pages</code> (array or number) : The list of page you want to interpret</li>
</ul>
<p>Returns a promise which resolves with an object with the following attributes:
   - <code>text</code> (string) : The full text of the pdf
   - <code>1</code> : The full pdfjs data for page 1
   - <code>n</code> : The full pdfjs data for page n</p>
<p>Example:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">pdfText</span> <span class="o">=</span> <span class="p">(</span><span class="nx">await</span> <span class="nx">getPdfText</span><span class="p">(</span><span class="s1">&#39;887ABCFE87687&#39;</span><span class="p">)).</span><span class="nx">text</span>
</pre></div>


<p><strong>Kind</strong>: inner method of <a href="#module_utils"><code>utils</code></a><br />
<a name="module_utils..formatDate"></a></p>
<h3 id="utilsformatdate">utils~formatDate()<a class="headerlink" href="#utilsformatdate" title="Permanent link">&para;</a></h3>
<p>This function convert a Date Object to a ISO date string (2018-07-31)</p>
<p>Parameters:</p>
<ul>
<li><code>date</code> (Date): the id of the file in the cozy</li>
</ul>
<p>Returns a string</p>
<p>Example:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">date</span> <span class="o">=</span> <span class="nx">formatFrenchDate</span><span class="p">(</span><span class="nx">New</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">())</span>
</pre></div>


<p><strong>Kind</strong>: inner method of <a href="#module_utils"><code>utils</code></a><br />
<a name="BaseKonnector"></a></p>
<h2 id="basekonnector">BaseKonnector<a class="headerlink" href="#basekonnector" title="Permanent link">&para;</a></h2>
<p>The class from which all the connectors must inherit.
It takes a fetch function in parameter that must return a <code>Promise</code>.
You need at least the <code>GET</code> permission on <code>io.cozy.accounts</code> in your manifest to allow it to
fetch account information for your connector.</p>
<p><strong>Kind</strong>: global class  </p>
<ul>
<li><a href="#BaseKonnector">BaseKonnector</a><ul>
<li><a href="#new_BaseKonnector_new">new BaseKonnector(fetch)</a></li>
<li><a href="#BaseKonnector+end">.end()</a></li>
<li><a href="#BaseKonnector+fail">.fail()</a></li>
<li><a href="#BaseKonnector+init">.init()</a> ⇒ <code>Promise</code></li>
<li><a href="#BaseKonnector+saveAccountData">.saveAccountData(data, options)</a> ⇒ <code>Promise</code></li>
<li><a href="#BaseKonnector+getAccountData">.getAccountData()</a> ⇒ <code>object</code></li>
<li><a href="#BaseKonnector+updateAccountAttributes">.updateAccountAttributes()</a></li>
<li><a href="#BaseKonnector+terminate">.terminate(message)</a></li>
</ul>
</li>
</ul>
<p><a name="new_BaseKonnector_new"></a></p>
<h3 id="new-basekonnectorfetch">new BaseKonnector(fetch)<a class="headerlink" href="#new-basekonnectorfetch" title="Permanent link">&para;</a></h3>
<p>Its role is twofold :</p>
<ul>
<li>Make the link between account data and konnector</li>
<li>Handle errors</li>
</ul>
<p>⚠️  A promise should be returned from the <code>fetch</code> function otherwise
the konnector cannot know that asynchronous code has been called.</p>
<div class="codehilite"><pre><span></span>this.terminate(&#39;LOGIN_FAILED&#39;)
</pre></div>


<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>fetch</td>
<td><code>function</code></td>
<td>Function to be run automatically after account data is fetched. This function will be binded to the current connector. If not fetch function is given. The connector will have to handle itself it&rsquo;s own exection and error handling</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong>  </p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="p">{</span> <span class="nx">BaseKonnector</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cozy-konnector-libs&#39;</span><span class="p">)</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BaseKonnector</span><span class="p">(</span><span class="kd">function</span> <span class="nx">fetch</span> <span class="p">()</span> <span class="p">{</span>
 <span class="c1">// use this to access the instance of the konnector to</span>
 <span class="c1">// store any information that needs to be passed to</span>
 <span class="c1">// different stages of the konnector</span>
 <span class="k">return</span> <span class="nx">request</span><span class="p">(</span><span class="s1">&#39;http://ameli.fr&#39;</span><span class="p">)</span>
   <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">computeReimbursements</span><span class="p">)</span>
   <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">saveBills</span><span class="p">)</span>
<span class="p">})</span>
</pre></div>


<p><a name="BaseKonnector+end"></a></p>
<h3 id="basekonnectorend">baseKonnector.end()<a class="headerlink" href="#basekonnectorend" title="Permanent link">&para;</a></h3>
<p>Hook called when the connector is ended</p>
<p><strong>Kind</strong>: instance method of <a href="#BaseKonnector"><code>BaseKonnector</code></a><br />
<a name="BaseKonnector+fail"></a></p>
<h3 id="basekonnectorfail">baseKonnector.fail()<a class="headerlink" href="#basekonnectorfail" title="Permanent link">&para;</a></h3>
<p>Hook called when the connector fails</p>
<p><strong>Kind</strong>: instance method of <a href="#BaseKonnector"><code>BaseKonnector</code></a><br />
<a name="BaseKonnector+init"></a></p>
<h3 id="basekonnectorinit-promise">baseKonnector.init() ⇒ <code>Promise</code><a class="headerlink" href="#basekonnectorinit-promise" title="Permanent link">&para;</a></h3>
<p>Initializes the current connector with data coming from the associated account</p>
<p><strong>Kind</strong>: instance method of <a href="#BaseKonnector"><code>BaseKonnector</code></a><br />
<strong>Returns</strong>: <code>Promise</code> - with the fields as an object<br />
<a name="BaseKonnector+saveAccountData"></a></p>
<h3 id="basekonnectorsaveaccountdatadata-options-promise">baseKonnector.saveAccountData(data, options) ⇒ <code>Promise</code><a class="headerlink" href="#basekonnectorsaveaccountdatadata-options-promise" title="Permanent link">&para;</a></h3>
<p>Saves data to the account that is passed to the konnector.
Use it to persist data that needs to be passed to each
konnector run.</p>
<p>By default, the data is merged to the remote data, use
<code>options.merge = false</code> to overwrite the data.</p>
<p>The data is saved under the <code>.data</code> attribute of the cozy
account.</p>
<p><strong>Kind</strong>: instance method of <a href="#BaseKonnector"><code>BaseKonnector</code></a>  </p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>data</td>
<td><code>object</code></td>
<td>Attributes to be merged</td>
</tr>
<tr>
<td>options</td>
<td><code>object</code></td>
<td>{ merge: true</td>
</tr>
</tbody>
</table>
<p><a name="BaseKonnector+getAccountData"></a></p>
<h3 id="basekonnectorgetaccountdata-object">baseKonnector.getAccountData() ⇒ <code>object</code><a class="headerlink" href="#basekonnectorgetaccountdata-object" title="Permanent link">&para;</a></h3>
<p>Get the data saved by saveAccountData</p>
<p><strong>Kind</strong>: instance method of <a href="#BaseKonnector"><code>BaseKonnector</code></a><br />
<a name="BaseKonnector+updateAccountAttributes"></a></p>
<h3 id="basekonnectorupdateaccountattributes">baseKonnector.updateAccountAttributes()<a class="headerlink" href="#basekonnectorupdateaccountattributes" title="Permanent link">&para;</a></h3>
<p>Update account attributes and cache the account</p>
<p><strong>Kind</strong>: instance method of <a href="#BaseKonnector"><code>BaseKonnector</code></a><br />
<a name="BaseKonnector+terminate"></a></p>
<h3 id="basekonnectorterminatemessage">baseKonnector.terminate(message)<a class="headerlink" href="#basekonnectorterminatemessage" title="Permanent link">&para;</a></h3>
<p>Send a special error code which is interpreted by the cozy stack to terminate the execution of the
connector now</p>
<p><strong>Kind</strong>: instance method of <a href="#BaseKonnector"><code>BaseKonnector</code></a>  </p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>message</td>
<td><code>string</code></td>
<td>The error code to be saved as connector result see [docs/ERROR_CODES.md]</td>
</tr>
</tbody>
</table>
<p><a name="CookieKonnector"></a></p>
<h2 id="cookiekonnector">CookieKonnector<a class="headerlink" href="#cookiekonnector" title="Permanent link">&para;</a></h2>
<p>Connector base class extending BaseKonnector which handles cookie session in a central way
It also handles saving cookie session in the account and automatically restore it for the next
connector run.
All cozy-konnector-libs tools using request are proposed as methods of this class to force them
to use the central cookie which can be saved/restored.
You need at least the <code>GET</code> and <code>PUT</code> permissions on <code>io.cozy.accounts</code> in your manifest to allow
it to save/restore cookies</p>
<p><strong>Kind</strong>: global class  </p>
<ul>
<li><a href="#CookieKonnector">CookieKonnector</a><ul>
<li><a href="#new_CookieKonnector_new">new CookieKonnector(requestFactoryOptions)</a></li>
<li><a href="#CookieKonnector+init">.init()</a> ⇒ <code>Promise</code></li>
<li><a href="#CookieKonnector+end">.end()</a></li>
<li><a href="#CookieKonnector+requestFactory">.requestFactory(options)</a> ⇒ <code>object</code></li>
<li><a href="#CookieKonnector+resetSession">.resetSession()</a> ⇒ <code>Promise</code></li>
<li><a href="#CookieKonnector+initSession">.initSession()</a> ⇒ <code>Promise</code></li>
<li><a href="#CookieKonnector+saveSession">.saveSession()</a> ⇒ <code>Promise</code></li>
<li><a href="#CookieKonnector+signin">.signin()</a> ⇒ <code>Promise</code></li>
<li><a href="#CookieKonnector+saveFiles">.saveFiles()</a> ⇒ <code>Promise</code></li>
<li><a href="#CookieKonnector+saveBills">.saveBills()</a> ⇒ <code>Promise</code></li>
</ul>
</li>
</ul>
<p><a name="new_CookieKonnector_new"></a></p>
<h3 id="new-cookiekonnectorrequestfactoryoptions">new CookieKonnector(requestFactoryOptions)<a class="headerlink" href="#new-cookiekonnectorrequestfactoryoptions" title="Permanent link">&para;</a></h3>
<p>Constructor</p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>requestFactoryOptions</td>
<td><code>function</code></td>
<td>Option object passed to requestFactory to initialize this.request. It is still possible to change this.request doing : <code>javascript this.request = this.requestFactory(...)</code> Please not you have to run the connector yourself doing : <code>javascript connector.run()</code></td>
</tr>
</tbody>
</table>
<p><strong>Example</strong>  </p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="p">{</span> <span class="nx">CookieKonnector</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cozy-konnector-libs&#39;</span><span class="p">)</span>
<span class="kr">class</span> <span class="nx">MyConnector</span> <span class="kr">extends</span> <span class="nx">CookieKonnector</span> <span class="p">{</span>
  <span class="nx">async</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">fields</span><span class="p">)</span> <span class="p">{</span>
     <span class="c1">// the code of your connector</span>
     <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="s1">&#39;https://...&#39;</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nx">async</span> <span class="nx">testSession</span><span class="p">()</span> <span class="p">{</span>
     <span class="kr">const</span> <span class="nx">$</span> <span class="o">=</span> <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="s1">&#39;https://...&#39;</span><span class="p">)</span>
     <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kr">const</span> <span class="nx">connector</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyKonnector</span><span class="p">({</span>
  <span class="nx">cheerio</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">json</span><span class="o">:</span> <span class="kc">false</span>
<span class="p">})</span>
<span class="nx">connector</span><span class="p">.</span><span class="nx">run</span><span class="p">()</span>
</pre></div>


<p><a name="CookieKonnector+init"></a></p>
<h3 id="cookiekonnectorinit-promise">cookieKonnector.init() ⇒ <code>Promise</code><a class="headerlink" href="#cookiekonnectorinit-promise" title="Permanent link">&para;</a></h3>
<p>Initializes the current connector with data coming from the associated account
and also the session</p>
<p><strong>Kind</strong>: instance method of <a href="#CookieKonnector"><code>CookieKonnector</code></a><br />
<strong>Returns</strong>: <code>Promise</code> - with the fields as an object<br />
<a name="CookieKonnector+end"></a></p>
<h3 id="cookiekonnectorend">cookieKonnector.end()<a class="headerlink" href="#cookiekonnectorend" title="Permanent link">&para;</a></h3>
<p>Hook called when the connector is ended</p>
<p><strong>Kind</strong>: instance method of <a href="#CookieKonnector"><code>CookieKonnector</code></a><br />
<a name="CookieKonnector+requestFactory"></a></p>
<h3 id="cookiekonnectorrequestfactoryoptions-object">cookieKonnector.requestFactory(options) ⇒ <code>object</code><a class="headerlink" href="#cookiekonnectorrequestfactoryoptions-object" title="Permanent link">&para;</a></h3>
<p>Calls cozy-konnector-libs requestFactory forcing this._jar as the cookie</p>
<p><strong>Kind</strong>: instance method of <a href="#CookieKonnector"><code>CookieKonnector</code></a><br />
<strong>Returns</strong>: <code>object</code> - - The resulting request object  </p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>options</td>
<td><code>object</code></td>
<td>requestFactory option</td>
</tr>
</tbody>
</table>
<p><a name="CookieKonnector+resetSession"></a></p>
<h3 id="cookiekonnectorresetsession-promise">cookieKonnector.resetSession() ⇒ <code>Promise</code><a class="headerlink" href="#cookiekonnectorresetsession-promise" title="Permanent link">&para;</a></h3>
<p>Reset cookie session with a new empty session and save it to the associated account</p>
<p><strong>Kind</strong>: instance method of <a href="#CookieKonnector"><code>CookieKonnector</code></a><br />
<a name="CookieKonnector+initSession"></a></p>
<h3 id="cookiekonnectorinitsession-promise">cookieKonnector.initSession() ⇒ <code>Promise</code><a class="headerlink" href="#cookiekonnectorinitsession-promise" title="Permanent link">&para;</a></h3>
<p>Get the cookie session from the account if any</p>
<p><strong>Kind</strong>: instance method of <a href="#CookieKonnector"><code>CookieKonnector</code></a><br />
<strong>Returns</strong>: <code>Promise</code> - true or false if the session in the account exists or not<br />
<a name="CookieKonnector+saveSession"></a></p>
<h3 id="cookiekonnectorsavesession-promise">cookieKonnector.saveSession() ⇒ <code>Promise</code><a class="headerlink" href="#cookiekonnectorsavesession-promise" title="Permanent link">&para;</a></h3>
<p>Saves the current cookie session to the account</p>
<p><strong>Kind</strong>: instance method of <a href="#CookieKonnector"><code>CookieKonnector</code></a><br />
<a name="CookieKonnector+signin"></a></p>
<h3 id="cookiekonnectorsignin-promise">cookieKonnector.signin() ⇒ <code>Promise</code><a class="headerlink" href="#cookiekonnectorsignin-promise" title="Permanent link">&para;</a></h3>
<p>This is signin function from cozy-konnector-libs which is forced to use the current cookies
and current request from CookieKonnector. It also automatically saves the session after
signin if it is a success.</p>
<p><strong>Kind</strong>: instance method of <a href="#CookieKonnector"><code>CookieKonnector</code></a><br />
<a name="CookieKonnector+saveFiles"></a></p>
<h3 id="cookiekonnectorsavefiles-promise">cookieKonnector.saveFiles() ⇒ <code>Promise</code><a class="headerlink" href="#cookiekonnectorsavefiles-promise" title="Permanent link">&para;</a></h3>
<p>This is saveFiles function from cozy-konnector-libs which is forced to use the current cookies
and current request from CookieKonnector.</p>
<p><strong>Kind</strong>: instance method of <a href="#CookieKonnector"><code>CookieKonnector</code></a><br />
<a name="CookieKonnector+saveBills"></a></p>
<h3 id="cookiekonnectorsavebills-promise">cookieKonnector.saveBills() ⇒ <code>Promise</code><a class="headerlink" href="#cookiekonnectorsavebills-promise" title="Permanent link">&para;</a></h3>
<p>This is saveBills function from cozy-konnector-libs which is forced to use the current cookies
and current request from CookieKonnector.</p>
<p><strong>Kind</strong>: instance method of <a href="#CookieKonnector"><code>CookieKonnector</code></a><br />
<a name="Document"></a></p>
<h2 id="document">Document<a class="headerlink" href="#document" title="Permanent link">&para;</a></h2>
<p>Simple Model for Documents. Allows to specify
<code>shouldSave</code>, <code>shouldUpdate</code> as methods.</p>
<p>Has useful <code>isEqual</code> method</p>
<p><strong>Kind</strong>: global class<br />
<a name="Document+isEqual"></a></p>
<h3 id="documentisequal">document.isEqual()<a class="headerlink" href="#documentisequal" title="Permanent link">&para;</a></h3>
<p>Compares to another document deeply.</p>
<p><code>_id</code> and <code>_rev</code> are by default ignored in the comparison.</p>
<p>By default, will compare dates loosely since you often
compare existing documents (dates in ISO string) with documents
that just have been scraped where dates are <code>Date</code>s.</p>
<p><strong>Kind</strong>: instance method of <a href="#Document"><code>Document</code></a><br />
<a name="LOGIN_FAILED"></a></p>
<h2 id="login_failed-string">LOGIN_FAILED : <code>String</code><a class="headerlink" href="#login_failed-string" title="Permanent link">&para;</a></h2>
<p>The konnector could not login</p>
<p><strong>Kind</strong>: global constant<br />
<a name="NOT_EXISTING_DIRECTORY"></a></p>
<h2 id="not_existing_directory-string">NOT_EXISTING_DIRECTORY : <code>String</code><a class="headerlink" href="#not_existing_directory-string" title="Permanent link">&para;</a></h2>
<p>The folder specified as folder_to_save does not exist (checked by BaseKonnector)</p>
<p><strong>Kind</strong>: global constant<br />
<a name="VENDOR_DOWN"></a></p>
<h2 id="vendor_down-string">VENDOR_DOWN : <code>String</code><a class="headerlink" href="#vendor_down-string" title="Permanent link">&para;</a></h2>
<p>The vendor&rsquo;s website is down</p>
<p><strong>Kind</strong>: global constant<br />
<a name="USER_ACTION_NEEDED"></a></p>
<h2 id="user_action_needed-string">USER_ACTION_NEEDED : <code>String</code><a class="headerlink" href="#user_action_needed-string" title="Permanent link">&para;</a></h2>
<p>There was an unexpected error, please take a look at the logs to know what happened</p>
<p><strong>Kind</strong>: global constant<br />
<a name="FILE_DOWNLOAD_FAILED"></a></p>
<h2 id="file_download_failed-string">FILE_DOWNLOAD_FAILED : <code>String</code><a class="headerlink" href="#file_download_failed-string" title="Permanent link">&para;</a></h2>
<p>There was a problem while downloading a file</p>
<p><strong>Kind</strong>: global constant<br />
<a name="SAVE_FILE_FAILED"></a></p>
<h2 id="save_file_failed-string">SAVE_FILE_FAILED : <code>String</code><a class="headerlink" href="#save_file_failed-string" title="Permanent link">&para;</a></h2>
<p>There was a problem while saving a file</p>
<p><strong>Kind</strong>: global constant<br />
<a name="DISK_QUOTA_EXCEEDED"></a></p>
<h2 id="disk_quota_exceeded-string">DISK_QUOTA_EXCEEDED : <code>String</code><a class="headerlink" href="#disk_quota_exceeded-string" title="Permanent link">&para;</a></h2>
<p>Could not save a file to the cozy because of disk quota exceeded</p>
<p><strong>Kind</strong>: global constant<br />
<a name="CHALLENGE_ASKED"></a></p>
<h2 id="challenge_asked-string">CHALLENGE_ASKED : <code>String</code><a class="headerlink" href="#challenge_asked-string" title="Permanent link">&para;</a></h2>
<p>It seems that the website requires a second authentification factor that we don’t support yet.</p>
<p><strong>Kind</strong>: global constant<br />
<a name="LOGIN_FAILED_TOO_MANY_ATTEMPTS"></a></p>
<h2 id="login_failed_too_many_attempts-string">LOGIN_FAILED_TOO_MANY_ATTEMPTS : <code>String</code><a class="headerlink" href="#login_failed_too_many_attempts-string" title="Permanent link">&para;</a></h2>
<p>Temporarily blocked</p>
<p><strong>Kind</strong>: global constant<br />
<a name="USER_ACTION_NEEDED_OAUTH_OUTDATED"></a></p>
<h2 id="user_action_needed_oauth_outdated-string">USER_ACTION_NEEDED_OAUTH_OUTDATED : <code>String</code><a class="headerlink" href="#user_action_needed_oauth_outdated-string" title="Permanent link">&para;</a></h2>
<p>Access refresh required</p>
<p><strong>Kind</strong>: global constant<br />
<a name="USER_ACTION_NEEDED_ACCOUNT_REMOVED"></a></p>
<h2 id="user_action_needed_account_removed-string">USER_ACTION_NEEDED_ACCOUNT_REMOVED : <code>String</code><a class="headerlink" href="#user_action_needed_account_removed-string" title="Permanent link">&para;</a></h2>
<p>Unavailable account</p>
<p><strong>Kind</strong>: global constant<br />
<a name="USER_ACTION_NEEDED_CHANGE_PASSWORD"></a></p>
<h2 id="user_action_needed_change_password-string">USER_ACTION_NEEDED_CHANGE_PASSWORD : <code>String</code><a class="headerlink" href="#user_action_needed_change_password-string" title="Permanent link">&para;</a></h2>
<p>Unavailable account</p>
<p><strong>Kind</strong>: global constant<br />
<a name="USER_ACTION_NEEDED_PERMISSIONS_CHANGED"></a></p>
<h2 id="user_action_needed_permissions_changed-string">USER_ACTION_NEEDED_PERMISSIONS_CHANGED : <code>String</code><a class="headerlink" href="#user_action_needed_permissions_changed-string" title="Permanent link">&para;</a></h2>
<p>Password update required</p>
<p><strong>Kind</strong>: global constant<br />
<a name="USER_ACTION_NEEDED_CGU_FORM"></a></p>
<h2 id="user_action_needed_cgu_form-string">USER_ACTION_NEEDED_CGU_FORM : <code>String</code><a class="headerlink" href="#user_action_needed_cgu_form-string" title="Permanent link">&para;</a></h2>
<p>The user needs to accept a CGU form before accessing the rest of the website</p>
<p><strong>Kind</strong>: global constant<br />
<a name="CAPTCHA_RESOLUTION_FAILED"></a></p>
<h2 id="captcha_resolution_failed-string">CAPTCHA_RESOLUTION_FAILED : <code>String</code><a class="headerlink" href="#captcha_resolution_failed-string" title="Permanent link">&para;</a></h2>
<p>solveCaptcha failed to solve the captcha</p>
<p><strong>Kind</strong>: global constant<br />
<a name="mkSpec"></a></p>
<h2 id="mkspec">mkSpec()<a class="headerlink" href="#mkspec" title="Permanent link">&para;</a></h2>
<p>Declarative scraping.</p>
<p>Describe your items attributes and where to find/parse them
instead of imperatively building them.</p>
<p>Heavily inspired by <a href="https://medialab.github.io/artoo/">artoo</a> scraping method.</p>
<p><strong>Kind</strong>: global function<br />
<a name="scrape"></a></p>
<h2 id="scrape-specs-childselector-object-124-array">scrape($, spec(s), [childSelector]) ⇒ <code>object</code> | <code>array</code><a class="headerlink" href="#scrape-specs-childselector-object-124-array" title="Permanent link">&para;</a></h2>
<p>Scrape a cheerio object for properties</p>
<p><strong>Kind</strong>: global function<br />
<strong>Returns</strong>: <code>object</code> | <code>array</code> - - Item(s) scraped  </p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>$</td>
<td><code>cheerio</code></td>
<td>Cheerio node which will be scraped</td>
</tr>
<tr>
<td>spec(s)</td>
<td><code>object</code> | <code>string</code></td>
<td>Options object describing what you want to scrape</td>
</tr>
<tr>
<td>[childSelector]</td>
<td><code>string</code></td>
<td>If passed, scrape will return an array of items</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong><br />
<code>scrape</code> can be used to declaratively extract data :</p>
<ul>
<li>For one object :</li>
</ul>
<div class="codehilite"><pre><span></span>const item = scrape($(&#39;#item&#39;), {
  title: &#39;.title&#39;,
  content: &#39;.content&#39;
})
</pre></div>


<ul>
<li>For a list of objects :</li>
</ul>
<div class="codehilite"><pre><span></span>const items = scrape($(&#39;#content&#39;), {
  title: &#39;.title&#39;,
  content: &#39;.content&#39;
}, &#39;.item&#39;)
</pre></div>


<p>For more power, you can use <code>object</code>s for each retriever :</p>
<div class="codehilite"><pre><span></span>const items = scrape($(&#39;#content&#39;), {
  title: &#39;.title&#39;,
  content: &#39;.content&#39;,
  link: {
    sel: &#39;a&#39;,
    attr: &#39;href&#39;
  },
}, &#39;.item&#39;)
</pre></div>


<p>Here the <code>href</code> attribute of the <code>a</code> inside <code>.item</code>s would have been
put into the <code>link</code> attribute of the items returned by <code>scrape</code>.</p>
<p>Available options :</p>
<ul>
<li><code>sel</code>: the CSS selector used to target the HTML node from which data will be scraped</li>
<li><code>attr</code>: the HTML attribute from which to extract data</li>
<li><code>parse</code>: function applied to the value extracted (<code>{ sel: '.price', parse: parseAmount }</code>)</li>
<li><code>fn</code>: if you need something more complicated than <code>attr</code>, you can use this function, it receives
the complete DOM node. <code>{ sel: '.person', fn: $node =&gt; $node.attr('data-name') + $node.attr('data-firstname') }</code></li>
</ul>
<h3 id="permissions">⚠ Permissions<a class="headerlink" href="#permissions" title="Permanent link">&para;</a></h3>
<p>Please note that some classes require some permissions:</p>
<ul>
<li><code>io.cozy.accounts</code> for the <code>BaseKonnector</code> class (<code>GET</code> only)</li>
<li><code>io.cozy.files</code> to save files</li>
<li><code>io.cozy.bills</code> to save bills</li>
<li><code>io.cozy.bank.operations</code> for <code>linkBankOperations</code></li>
</ul>
                </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <!-- Piwik -->
        <script type="text/javascript">
          var _paq = _paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
          _paq.push(['trackPageView']);
          _paq.push(['enableLinkTracking']);
          (function() {
            var u="//matomo.cozycloud.cc/";
            _paq.push(['setTrackerUrl', u+'piwik.php']);
            _paq.push(['setSiteId', '7']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
          })();
        </script>
        <noscript><p><img src="//matomo.cozycloud.cc/piwik.php?idsite=7&rec=1" style="border:0;" alt="" /></p></noscript>
        <!-- End Piwik Code -->
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>
        <script src="../../extra.js"></script>
        <script src="../../search/main.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
