<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <meta name="author" content="CozyCloud - https://cozy.io">
        <link rel="canonical" href="https://docs.cozy.io/cozy-konnector-libs/synchronization/">
        <link rel="shortcut icon" href="../../img/favicon.png">
        
        <title>Synchronization - Dev Documentation</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
            <link href="../../css/extra.css" rel="stylesheet">
            <link href="../../css/highlight_theme.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

	<script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://docs.cozy.io/">Dev Documentation</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../..">Home</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorials <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../tutorials/app/">Create Your Application</a>
</li>
                            
<li >
    <a href="../../tutorials/konnector/">Develop a Connector</a>
</li>
                            
<li >
    <a href="../../tutorials/selfhost-debian/">Self-Host on Debian</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">How-to <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
  <li class="dropdown-submenu">
    <a href="#">Dev</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../howTos/dev/runCozyDocker/">Run an App in a Cozy using Docker</a>
</li>
            
<li >
    <a href="../../howTos/dev/hmr/">Use Hot Module Replacement in Your App</a>
</li>
            
<li >
    <a href="../../howTos/dev/cordova/">Make a Mobile App Using Cordova</a>
</li>
            
<li >
    <a href="../../howTos/dev/connect-mobile-app-local-stack/">Connect a Mobile App to Your Local Stack</a>
</li>
            
<li >
    <a href="../../howTos/dev/sendmail/">Send and Receive E-mails in Development</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Synchronize</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../howTos/sync/linux/">Install Cozy Drive on GNU/Linux</a>
</li>
    </ul>
  </li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">References <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../references/tech-intro/">Technical introduction to the Cozy platform</a>
</li>
                            
<li >
    <a href="../../references/git-flow/">Our Front-End Git Flow</a>
</li>
                            
  <li class="dropdown-submenu">
    <a href="#">Stack and tools</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">cozy-app-publish</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-app-publish/README/">CLI & Workflow</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-apps-registry</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-apps-registry/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-client</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-client/getting-started/">Getting started</a>
</li>
            
<li >
    <a href="../../cozy-client/how-tos/">How tos</a>
</li>
            
<li >
    <a href="../../cozy-client/api/cozy-client/">Cozy Client API</a>
</li>
            
<li >
    <a href="../../cozy-client/api/cozy-pouch-link/">Cozy Pouch Link API</a>
</li>
            
<li >
    <a href="../../cozy-client/api/cozy-stack-client/">Cozy Stack Client API</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-client-js</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-client-js/README/">README</a>
</li>
            
<li >
    <a href="../../cozy-client-js/intro/">Introduction</a>
</li>
            
<li >
    <a href="../../cozy-client-js/browser-sdk-transition/">Transition from cozy-browser-sdk</a>
</li>
            
<li >
    <a href="../../cozy-client-js/offline/">How to support offline</a>
</li>
            
<li >
    <a href="../../cozy-client-js/oauth/">OAuth guide</a>
</li>
            
<li >
    <a href="../../cozy-client-js/auth-api/">Authentication API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/data-api/">Data System API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/files-api/">Files API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/jobs-api/">Jobs API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/intents-api/">Intents API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/settings-api/">Settings API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/sharing-api/">Sharing API</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-ui</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-ui/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-doctypes</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-doctypes/docs/README/">README</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.accounts/">Accounts</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.photos.albums/">Albums</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.bank/">Banking doctypes</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.bills/">Bills</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.konnectors/">Connectors</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.contacts/">Contacts</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.files/">Files</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.notifications/">Notifications</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.remote.requests/">Remote requests</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.sessions.logins/">Session logins</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.sharings/">Sharings</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.triggers/">Triggers</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-konnector-libs</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../api/">API</a>
</li>
            
<li >
    <a href="../cli/">CLI</a>
</li>
            
<li >
    <a href="/en/dev/">Develop</a>
</li>
            
<li >
    <a href="../errors/">Errors</a>
</li>
            
<li >
    <a href="../operation-linking/">Operation linking</a>
</li>
            
<li class="active">
    <a href="./">Synchronization</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-stack</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/README/">README</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Usage</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/INSTALL/">Install the cozy-stack</a>
</li>
            
<li >
    <a href="../../cozy-stack/config/">Configuration file</a>
</li>
            
<li >
    <a href="../../cozy-stack/instance/">Managing Instances</a>
</li>
            
<li >
    <a href="../../cozy-stack/security/">Security</a>
</li>
            
<li >
    <a href="../../cozy-stack/cli/cozy-stack/">Manpages of the command-line tool</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">How-to guides for developpers</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/client-app-dev/">Develop a client-side app</a>
</li>
            
<li >
    <a href="../../cozy-stack/docker/">Running and building Docker images</a>
</li>
            
<li >
    <a href="../../cozy-stack/doctype/">Adding a new doctype</a>
</li>
            
<li >
    <a href="../../cozy-stack/assets/">Working with the stack assets</a>
</li>
            
<li >
    <a href="../../cozy-stack/release/">Build a release</a>
</li>
            
<li >
    <a href="../../cozy-stack/CONTRIBUTING/">The contributing guide</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Explanations</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/sharing-design/">Sharing design</a>
</li>
            
<li >
    <a href="../../cozy-stack/konnectors-workflow/">Workflow of the konnectors</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">List of services</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/auth/">/auth - Authentication & OAuth</a>
</li>
            
<li >
    <a href="../../cozy-stack/apps/">/apps - Applications Management</a>
</li>
            
<li >
    <a href="../../cozy-stack/registry/"> /apps - Apps registry</a>
</li>
            
<li >
    <a href="../../cozy-stack/konnectors/"> /apps - Konnectors</a>
</li>
            
<li >
    <a href="../../cozy-stack/data-system/">/data - Data System</a>
</li>
            
<li >
    <a href="../../cozy-stack/mango/"> /data - Mango</a>
</li>
            
<li >
    <a href="../../cozy-stack/couchdb-quirks/"> /data - CouchDB Quirks</a>
</li>
            
<li >
    <a href="../../cozy-stack/pouchdb-quirks/"> /data - PouchDB Quirks</a>
</li>
            
<li >
    <a href="../../cozy-stack/files/">/files - Virtual File System</a>
</li>
            
<li >
    <a href="../../cozy-stack/references-docs-in-vfs/"> /files - References of documents in VFS</a>
</li>
            
<li >
    <a href="../../cozy-stack/intents/">/intents - Intents</a>
</li>
            
<li >
    <a href="../../cozy-stack/jobs/">/jobs - Jobs</a>
</li>
            
<li >
    <a href="../../cozy-stack/workers/"> /jobs - Workers</a>
</li>
            
<li >
    <a href="../../cozy-stack/move/">/move - Move, export and import an instance</a>
</li>
            
<li >
    <a href="../../cozy-stack/notifications/">/notifications - Notifications</a>
</li>
            
<li >
    <a href="../../cozy-stack/public/">/public - Public</a>
</li>
            
<li >
    <a href="../../cozy-stack/permissions/">/permissions - Permissions</a>
</li>
            
<li >
    <a href="../../cozy-stack/realtime/">/realtime - Realtime</a>
</li>
            
<li >
    <a href="../../cozy-stack/remote/">/remote - Proxy for remote data/API</a>
</li>
            
<li >
    <a href="../../cozy-stack/settings/">/settings - Settings</a>
</li>
            
<li >
    <a href="../../cozy-stack/user-action-required/"> /settings - Terms of Services</a>
</li>
            
<li >
    <a href="../../cozy-stack/sharing/">/sharings - Sharing</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">konitor</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../konitor/cli/">CLI</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">babel-preset-cozy-app</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../babel-preset-cozy-app/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">commitlint-config-cozy</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../commitlint-config-cozy/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-device-helper</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-device-helper/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">eslint-config-cozy-app</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../eslint-config-cozy-app/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-flags</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-flags/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-realtime</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-realtime/README/">README</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li>
                        <a href="https://github.com/cozy/cozy.github.io/">
                                <i class="fa fa-github"></i>GitHub
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3 main-toc">
<div class="bs-sidebar hidden-print affix" role="complementary">
    <ul class="nav bs-sidenav well" style='padding-left: 0; padding-right: 0; margin-bottom: 1.5rem'>
        <li class="main active"><a href="#table-of-contents">Table of contents</a></li>
        <li class="main "><a href="#konnector-synchronisation-data-and-options">Konnector synchronisation data and options</a></li>
            <li><a href="#problems">Problems</a></li>
            <li><a href="#current-usage">Current usage</a></li>
            <li><a href="#objectives-of-this-document">Objectives of this document</a></li>
            <li><a href="#storing-synchronization-data-in-documents">Storing synchronization data in documents</a></li>
            <li><a href="#saving-document-based-on-synchronization-strategy">Saving document based on synchronization strategy</a></li>
            <li><a href="#synchronization-strategy">Synchronization strategy</a></li>
    </ul>
  <div style='padding-left: 2rem'>
    
    <a id='edit-link' href='https://github.com/cozy/cozy.github.io/edit/dev/src/cozy-konnector-libs/synchronization.md'>Edit documentation</a>
    <script type='text/javascript'>
        /* Here we detect if the current page is from an external documentation and we 
        change the href of the editing link so it goes to the right repository and file */
        const outsideDocs = [{"name": "cozy-app-publish", "repo": "https://github.com/cozy/cozy-app-publish.git", "subdir": "."}, {"name": "cozy-apps-registry", "repo": "https://github.com/cozy/cozy-apps-registry.git", "subdir": "."}, {"name": "cozy-client", "repo": "https://github.com/cozy/cozy-client.git", "subdir": "docs"}, {"name": "cozy-client-js", "repo": "https://github.com/cozy/cozy-client-js.git", "subdir": "docs"}, {"name": "cozy-ui", "repo": "https://github.com/cozy/cozy-ui.git", "subdir": "docs"}, {"name": "cozy-doctypes", "repo": "https://github.com/cozy/cozy-doctypes.git", "subdir": "."}, {"name": "cozy-konnector-libs", "repo": "https://github.com/konnectors/libs.git", "subdir": "packages/cozy-konnector-libs/docs"}, {"name": "cozy-scripts", "repo": "https://github.com/CPatchane/create-cozy-app.git", "subdir": "packages/cozy-scripts/docs"}, {"name": "cozy-stack", "repo": "https://github.com/cozy/cozy-stack.git", "subdir": "docs"}, {"name": "konitor", "repo": "https://github.com/konnectors/konitor.git", "subdir": "docs"}, {"name": "babel-preset-cozy-app", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/babel-preset-cozy-app"}, {"name": "commitlint-config-cozy", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/commitlint-config-cozy"}, {"name": "cozy-device-helper", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-device-helper"}, {"name": "eslint-config-cozy-app", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/eslint-config-cozy-app"}, {"name": "cozy-flags", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-flags"}, {"name": "cozy-realtime", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-realtime"}]
        const editNode = document.querySelector('#edit-link')
        const pathname = window.location.pathname
        const editURI = 'edit/master/'
        const removeGitSuffix = function (x) { return x.replace(/\.git$/, '') }

        // Returns the external repo associated to a pathname
        const detectExternalRepo = function (pathname) {
            for (var outsideDoc of outsideDocs) {
                if (window.location.pathname.includes('/' + outsideDoc.name + '/')) {
                    return outsideDoc
                }
            }
        }

        // Change the href attribute of a link to point to the correct edition page on GitHub
        // for the passed external documentation
        const fixEditLink = function (editNode, externalDoc) {
            const repoFile = pathname.replace('/en/' + externalDoc.name, '').replace(/\/$/, '.md')
            const baseRepo = removeGitSuffix(externalDoc.repo)
            editNode.href = baseRepo + '/' + editURI + externalDoc.subdir + repoFile
        }

        const externalRepo = detectExternalRepo(pathname)
        if (externalRepo) {
            fixEditLink(editNode, externalRepo)
        }
    </script>
    
  </div>
</div></div>
                <div class="col-md-9" role="main">
                    

<h1 id="table-of-contents">Table of contents<a class="headerlink" href="#table-of-contents" title="Permanent link">&para;</a></h1>
<ul>
<li><a href="#konnector-synchronisation-data-and-options">Konnector synchronisation data and options</a></li>
<li><a href="#problems">Problems</a></li>
<li><a href="#current-usage">Current usage</a></li>
<li><a href="#objectives-of-this-document">Objectives of this document</a></li>
<li><a href="#storing-synchronization-data-in-documents">Storing synchronization data in documents</a><ul>
<li><a href="#simple-case--by-id">Simple case, by id</a></li>
<li><a href="#by-multiple-attributes">By multiple attributes</a></li>
<li><a href="#by-custom-method">By custom method</a></li>
</ul>
</li>
<li><a href="#saving-document-based-on-synchronization-strategy">Saving document based on synchronization strategy</a><ul>
<li><a href="#adding-synchronization-data">Adding synchronization data</a></li>
<li><a href="#filtering-entries">Filtering entries</a></li>
</ul>
</li>
<li><a href="#synchronization-strategy">Synchronization strategy</a><ul>
<li><a href="#findlegacydocument">findLegacyDocument</a></li>
<li><a href="#getsyncdata">getSyncData</a></li>
<li><a href="#array">Array</a><ul>
<li><a href="#example">Example</a></li>
</ul>
</li>
<li><a href="#function">function</a><ul>
<li><a href="#example-1">Example</a></li>
</ul>
</li>
<li><a href="#konnector">konnector</a></li>
<li><a href="#shouldsave">shouldSave</a></li>
<li><a href="#shouldupdate">shouldUpdate</a></li>
</ul>
</li>
<li><a href="#whole-example">Whole example</a></li>
</ul>
<h1 id="konnector-synchronisation-data-and-options">Konnector synchronisation data and options<a class="headerlink" href="#konnector-synchronisation-data-and-options" title="Permanent link">&para;</a></h1>
<h2 id="problems">Problems<a class="headerlink" href="#problems" title="Permanent link">&para;</a></h2>
<p>Except bank konnectors which are already solving the addressed problem, all konnectors are currently processing data they are collecting in the same way:</p>
<ul>
<li>Get all data to synchronize</li>
<li>Store it in CouchDB, even if it means overriding previously synchronized data.</li>
</ul>
<p>This process has at least two major flows :
<em> We are always synchronizing <em>all</em> the data provided by the external service.
</em> When something is modified (for example, the name of the stored file, it&rsquo;s almost sure that the previous one will be kept and that we&rsquo;ll have a duplicate)</p>
<p>Another side effect could be that in a very large set of documents to synchronize, the whole process may take more than 3 minutes and never synchronize documents at the end of the list.</p>
<h2 id="current-usage">Current usage<a class="headerlink" href="#current-usage" title="Permanent link">&para;</a></h2>
<p>When saving bills, <code>cozy-konnector-libs</code> provides a filtering and hydratation mechanism, to avoid overriding existing bills. It is done in function <a href="https://github.com/cozy/cozy-konnector-libs/blob/master/libs/hydrateAndFilter.js"><code>hydrateAndFilters</code></a>.</p>
<p>This method performs two actions :
<em> hydrate entries retrieved from service with usable data from couchDB (like existing bill id)
</em> filter entries retrieved from service and return only entries that need to be saved/synchronized.</p>
<h2 id="objectives-of-this-document">Objectives of this document<a class="headerlink" href="#objectives-of-this-document" title="Permanent link">&para;</a></h2>
<p>The goals of this document are:</p>
<ul>
<li>Define a common way to store synchronization data for all konnector</li>
<li>Propose a naive implementation for an abstract synchronisation data storing mechanism, provided by <code>cozy-konnector-libs</code></li>
<li>Propose a solution to synchronize every type of data or file, not only bills</li>
<li>Taking the <code>hydrateAndFilter</code> function as basis, split it in three functions performing the following tasks : actual filtering, synchronization data hydratation and saving/updating current database document with correspondig external entries (the part done by the actual <em>hydratation</em>)</li>
</ul>
<h2 id="storing-synchronization-data-in-documents">Storing synchronization data in documents<a class="headerlink" href="#storing-synchronization-data-in-documents" title="Permanent link">&para;</a></h2>
<p>Before saving any data or file, we will add in the relying document every synchronization data we will need. The added data will depend on how the service the konnector connects to retrieve entries and which information they gave us.</p>
<h3 id="simple-case-by-id">Simple case, by id<a class="headerlink" href="#simple-case-by-id" title="Permanent link">&para;</a></h3>
<p>We suppose that in the most cases, we will face to entries provinding their own <code>id</code> attribute. The idea is to store it as synchronization data to be able to easily retrieve them later.
To store synchronization data, we are using a <code>sync</code> attribute in document <code>metadata</code> attribute. Example:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;sync&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;7ee401e841c94159addb47f190903139&quot;</span><span class="p">,</span>
      <span class="nt">&quot;konnector&quot;</span><span class="p">:</span> <span class="s2">&quot;trainline&quot;</span><span class="p">,</span>
      <span class="nt">&quot;last_sync&quot;</span><span class="p">:</span> <span class="s2">&quot;Mon, 12 Feb 2018 16:25:34 GMT&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>The expected information to be save is:</p>
<table>
<thead>
<tr>
<th> field</th>
<th>role</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>The id of the document, but given by the external service. If the external service does not provide any id or uuid, it could be interesting to generate one, with an hash of the file for example.</td>
</tr>
<tr>
<td>konnector</td>
<td>The slug of the konnector (Example: <code>trainline</code>, <code>freemobile</code>, <code>cic</code>). This could be very useful to retrieve data synchronized with this konnector.</td>
</tr>
<tr>
<td>last_sync</td>
<td>Date of last synchronization, set to <code>now()</code> when storage is made.</td>
</tr>
</tbody>
</table>
<h3 id="by-multiple-attributes">By multiple attributes<a class="headerlink" href="#by-multiple-attributes" title="Permanent link">&para;</a></h3>
<p>If the external service does not provide any <code>id</code> attribute, we may need to use instead a list of attributes, for example <code>firstname</code>, <code>lastname</code>, <code>dateofbirth</code>.</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;sync&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;firstname&quot;</span><span class="p">:</span> <span class="s2">&quot;Claude&quot;</span><span class="p">,</span>
      <span class="nt">&quot;lastname&quot;</span><span class="p">:</span> <span class="s2">&quot;Causi&quot;</span><span class="p">,</span>
      <span class="nt">&quot;dateofbirth&quot;</span><span class="p">:</span> <span class="s2">&quot;06/12/1980&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>As we cannot be sure that we will have different data, it could be better to use a custom way of providing an unique identifier.</p>
<h3 id="by-custom-method">By custom method<a class="headerlink" href="#by-custom-method" title="Permanent link">&para;</a></h3>
<p>When the external service does not provide any identifier, we have to use a custom method to generate one.
It could be for example the filename or a hash generated with the document content.</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;sync&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;id:&quot;</span><span class="p">:</span> <span class="s2">&quot;customhash34FED5465645ABF54656FCB&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h2 id="saving-document-based-on-synchronization-strategy">Saving document based on synchronization strategy<a class="headerlink" href="#saving-document-based-on-synchronization-strategy" title="Permanent link">&para;</a></h2>
<p>To solve the synchronization process we need to:
<em> be able to add synchronization data on any type of document
</em> be able to compare external entries to current database state
* provide a default implementation while letting the contributors to define their own ones</p>
<h3 id="adding-synchronization-data">Adding synchronization data<a class="headerlink" href="#adding-synchronization-data" title="Permanent link">&para;</a></h3>
<p>We should provide an <code>addSyncData</code> function could, which look like this (naive implementation, this piece of code needs to be improved to handle cases where <code>synchronizationStrategy.idAttribute</code> is an array or a function):</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">addSyncData</span> <span class="o">=</span> <span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="nx">entry</span><span class="p">,</span> <span class="nx">synchronizationStrategy</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="p">...</span><span class="nb">document</span><span class="p">,</span>
    <span class="nx">metadata</span><span class="o">:</span> <span class="p">{</span>
      <span class="p">...</span><span class="nb">document</span><span class="p">.</span><span class="nx">metadata</span><span class="p">,</span>
      <span class="nx">id</span><span class="o">:</span> <span class="nx">entry</span><span class="p">[</span><span class="nx">synchronizationStrategy</span><span class="p">.</span><span class="nx">idAttribute</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="sb">````</span>

<span class="nx">Where</span> <span class="sb">`document`</span> <span class="nx">is</span> <span class="nx">the</span> <span class="nx">future</span> <span class="nb">document</span> <span class="nx">to</span> <span class="nx">save</span><span class="p">,</span> <span class="sb">`entry`</span> <span class="nx">the</span> <span class="nx">corresponding</span> <span class="nx">external</span> <span class="nx">entry</span><span class="p">,</span> <span class="nx">and</span> <span class="sb">`synchronizationStrategy`</span> <span class="nx">and</span> <span class="nx">object</span> <span class="nx">defining</span> <span class="nx">the</span> <span class="nx">synchronization</span> <span class="nx">properties</span> <span class="nx">and</span> <span class="nx">methods</span> <span class="p">(</span><span class="nx">see</span> <span class="nx">below</span><span class="p">).</span>

<span class="err">###</span> <span class="nx">Filtering</span> <span class="nx">entries</span>

<span class="nx">Now</span> <span class="nx">we</span> <span class="nx">have</span> <span class="nx">saved</span> <span class="nx">our</span> <span class="nx">documents</span> <span class="k">in</span> <span class="nx">database</span> <span class="kd">with</span> <span class="nx">consistent</span> <span class="nx">synchronization</span> <span class="nx">metadata</span><span class="p">,</span> <span class="nx">we</span> <span class="nx">need</span> <span class="nx">to</span> <span class="nx">provide</span> <span class="nx">a</span> <span class="nx">way</span> <span class="nx">to</span> <span class="nx">filter</span> <span class="nx">external</span> <span class="nx">entries</span><span class="p">.</span>

<span class="nx">We</span> <span class="nx">should</span> <span class="nx">provide</span> <span class="nx">a</span> <span class="sb">`filterEntriesToSynchronize`</span> <span class="nx">which</span> <span class="nx">returns</span> <span class="nx">a</span> <span class="nx">list</span> <span class="k">of</span> <span class="nx">entries</span> <span class="kd">with</span> <span class="k">new</span> <span class="nx">data</span> <span class="nx">or</span> <span class="nx">data</span> <span class="nx">to</span> <span class="nx">update</span><span class="p">.</span>

<span class="nx">As</span> <span class="sb">`addSyncData`</span><span class="p">,</span> <span class="k">this</span> <span class="nx">method</span> <span class="nx">will</span> <span class="nx">receive</span> <span class="nx">a</span> <span class="sb">`synchronizationStrategy`</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">filtering</span> <span class="nx">algorithm</span> <span class="nx">should</span> <span class="nx">be</span> <span class="nx">based</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">returned</span> <span class="nx">value</span> <span class="k">of</span> <span class="sb">`synchronizationStrategy.shouldSave`</span> <span class="nx">and</span> <span class="sb">`synchronizationStrategy.shouldUpdate`</span><span class="p">.</span>

<span class="o">&gt;</span> <span class="err">⚠️</span> <span class="nx">As</span> <span class="nx">the</span> <span class="sb">`synchronizationStrategy.shouldSave`</span> <span class="nx">and</span> <span class="sb">`synchronizationStrategy.shouldUpdate`</span> <span class="nx">will</span> <span class="nx">be</span> <span class="nx">asynchronous</span> <span class="nx">methods</span><span class="p">,</span> <span class="sb">`filterEntriesToSynchronize`</span> <span class="nx">should</span> <span class="nx">also</span> <span class="nx">be</span> <span class="nx">asynchronous</span><span class="p">.</span>

<span class="nx">A</span> <span class="nx">naive</span> <span class="nx">example</span> <span class="k">of</span> <span class="sb">`filterEntriesToSynchronize`</span> <span class="nx">implementation</span> <span class="nx">should</span> <span class="nx">be</span><span class="o">:</span>

<span class="sb">```js</span>
<span class="sb">const filterEntriesToSynchronize = async (cozy, entries, synchronizationStrategy) = {</span>
<span class="sb">  const filtered = []</span>

<span class="sb">  entries.forEach(entry =&gt; {</span>
<span class="sb">    // getExistingSynchronizedDocument needs to be implemented, it should retrieve</span>
<span class="sb">    // existing document from database, based on synchronization data.</span>
<span class="sb">    const existingDocument = cozy.getExistingSynchronizedDocument(entry, synchronizationStrategy)</span>

<span class="sb">    const toSave = await synchronizationStrategy.shouldSave(entry, existingDocument)</span>
<span class="sb">    const toUpdate = await synchronizationStrategy.shouldUpdate(entry, existingDocument)</span>

<span class="sb">    if (toSave || toUpdate) filtered.push(entry)</span>
<span class="sb">  })</span>

<span class="sb">  return filtered</span>
<span class="sb">}</span>
</pre></div>


<h2 id="synchronization-strategy">Synchronization strategy<a class="headerlink" href="#synchronization-strategy" title="Permanent link">&para;</a></h2>
<p>For our functions or methods dealing with synchronization, we pass a <code>synchronizationStrategy</code> object. Internally, we will use a default one but let the ability to contributors to pass their own ones.</p>
<p>It is a simple object containing the following properties:</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Role</th>
</tr>
</thead>
<tbody>
<tr>
<td>disableSyncData</td>
<td>(boolean) Disable storage of  synchronization data. Default: <code>false</code></td>
</tr>
<tr>
<td>findLegacyDocument</td>
<td>(function) Custom function which a konnector may use to look for a legacy document. Default is <code>null</code>. See below for more details.</td>
</tr>
<tr>
<td>getSyncData</td>
<td>(function) A mapping method returning additional synchronization data which have to be added to the document.</td>
</tr>
<tr>
<td>idAttribute</td>
<td>(string&#124;Array&#124;function) How the identifier attribute is named in the entry. Default value: <code>id</code>. See below for additional customization</td>
</tr>
<tr>
<td>konnector</td>
<td><em>Mandatory</em> (string) The slug (or better, an uuid) of the current konnector.</td>
</tr>
<tr>
<td>shouldSave</td>
<td>(function) A method taking current entry and matching document in database to evaluate if an entry has to be saved in database. See below default method and customization.</td>
</tr>
<tr>
<td>shouldUpdate</td>
<td>(function) A method taking current entry and matching document in database to evaluate if a document must be updated with current entry. See below for default method and customization.</td>
</tr>
</tbody>
</table>
<h3 id="findlegacydocument">findLegacyDocument<a class="headerlink" href="#findlegacydocument" title="Permanent link">&para;</a></h3>
<p>If a document has not been saved yet with actual synchronization data, we will have no way to retrieve it, except by providing a <code>findLegacyDocument</code> function to <code>saveEntry</code> options. This signature of a <code>findLegacyDocument</code> function is:</p>
<div class="codehilite"><pre><span></span><span class="nx">async</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">entry</span><span class="p">,</span> <span class="nx">cozy</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* look for your document */</span> <span class="p">}</span>
<span class="sb">````</span>

<span class="nx">The</span> <span class="sb">`cozy`</span> <span class="nx">parameter</span> <span class="nx">is</span> <span class="nx">an</span> <span class="nx">instance</span> <span class="k">of</span> <span class="nx">Cozy</span><span class="o">-</span><span class="nx">Client</span><span class="p">.</span>

<span class="nx">The</span> <span class="nx">idea</span> <span class="nx">is</span> <span class="k">for</span> <span class="nx">example</span> <span class="nx">to</span> <span class="nx">retrive</span> <span class="nx">a</span> <span class="nb">document</span> <span class="nx">by</span> <span class="nx">its</span> <span class="nx">file</span> <span class="nx">path</span> <span class="nx">or</span> <span class="nx">any</span> <span class="nx">other</span> <span class="nx">accurate</span> <span class="nx">information</span><span class="p">.</span>

<span class="err">###</span> <span class="nx">getSyncData</span>
<span class="nx">This</span> <span class="nx">method</span> <span class="nx">returns</span> <span class="nx">any</span> <span class="nx">addtional</span> <span class="nx">synchronization</span> <span class="nx">data</span> <span class="nx">the</span> <span class="nx">konnector</span> <span class="nx">should</span> <span class="nx">need</span><span class="p">.</span> <span class="nx">Default</span> <span class="nx">method</span> <span class="nx">should</span> <span class="nx">be</span> <span class="nx">something</span> <span class="nx">returning</span> <span class="nx">an</span> <span class="nx">empty</span> <span class="nx">object</span> <span class="nx">or</span> <span class="sb">`null`</span><span class="p">.</span>

<span class="sb">```js</span>
<span class="sb">(entry) =&gt; ({})</span>
</pre></div>


<p>A konnector should provide its own method:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nx">getSyncData</span><span class="o">:</span> <span class="p">(</span><span class="nx">entry</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">({</span>
    <span class="nx">filename</span><span class="o">:</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">name</span>
  <span class="p">})</span>
<span class="p">}</span><span class="sb">```</span>

<span class="sb">### idAttribute</span>
<span class="sb">#### String</span>
<span class="sb">Name of the id attribute in entry. Default is `</span><span class="nx">id</span><span class="sb">`. If we want to use another name, we may use:</span>
<span class="sb">```</span><span class="nx">js</span>
<span class="nx">saveFiles</span><span class="p">(</span><span class="nx">files</span><span class="p">,</span> <span class="p">{</span><span class="nx">idAttribute</span><span class="o">:</span> <span class="s1">&#39;uuid&#39;</span><span class="p">})</span>
</pre></div>


<h4 id="array">Array<a class="headerlink" href="#array" title="Permanent link">&para;</a></h4>
<p>This attribute may also be an array of string, defining each entry attribute which must be used for identifier.</p>
<h5 id="example">Example<a class="headerlink" href="#example" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><span class="nx">saveFiles</span><span class="p">(</span><span class="nx">files</span><span class="p">,</span> <span class="p">{</span><span class="nx">idAttribute</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">]})</span>
</pre></div>


<p>In this case, all fields are used in synchronization data.</p>
<h4 id="function">function<a class="headerlink" href="#function" title="Permanent link">&para;</a></h4>
<p>When an entry does not provide an unique identifer, it is possible to use a function as <code>idAttribute</code> to customize the way the unique identifer is generated.</p>
<h5 id="example_1">Example<a class="headerlink" href="#example_1" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><span class="nx">addData</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="p">{</span><span class="nx">idAttribute</span><span class="o">:</span> <span class="p">(</span><span class="nx">entry</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">hash</span><span class="p">(</span><span class="nx">entry</span><span class="p">)})</span>
<span class="c1">// hash() is a custom method  hashing the current file.</span>
</pre></div>


<h3 id="konnector">konnector<a class="headerlink" href="#konnector" title="Permanent link">&para;</a></h3>
<p>The konnector attribute is used as a key reference to retrieve all document synchronized by this konnector.</p>
<p>For now, the <code>konnector</code> option will be needed for every call. But it could be interesting to initialize some kind of runner with it, which may encapsulate all the <code>cozy-konnector-libs</code> functions.</p>
<h3 id="shouldsave">shouldSave<a class="headerlink" href="#shouldsave" title="Permanent link">&para;</a></h3>
<p>The shouldSave function returns a boolean which indicate if the entry should be saved. The default method should be:</p>
<div class="codehilite"><pre><span></span><span class="nx">async</span> <span class="kd">function</span> <span class="nx">shouldSave</span> <span class="p">(</span><span class="nx">entry</span><span class="p">,</span> <span class="nx">existingDocument</span><span class="p">,</span> <span class="nx">cozy</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="o">!</span><span class="nx">existingDocument</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>


<p>When calling this function, it is assumed that <code>cozy-konnector-libs</code> first queries the database for an exisring document, based on synchronization data and pass the document resulting the query to the <code>shouldSave</code> function, event if this document is <code>null</code>. We pass the whole document, and not only synchronization data, to let the contributors free on their way they are determining it a document should be saved.</p>
<p>As a third parameter, a cozyClient instance is passed, it may be used by a konnector to perform another query.</p>
<p>Because of this third parameter, the whole <code>shouldSave</code> method is asynchronous.</p>
<h3 id="shouldupdate">shouldUpdate<a class="headerlink" href="#shouldupdate" title="Permanent link">&para;</a></h3>
<p>The <code>shouldUpdate</code> function acts exactly like <code>shouldSave</code>, except that it is used to determine if a document should be updated. By default, we make the choice to never update a document (except if it does not have synchronization data, see <code>findLegacyDocument</code> above). But some konnectors like <code>Linxo</code> related ones need to update existing documents.</p>
<p>The default method is:</p>
<div class="codehilite"><pre><span></span><span class="nx">async</span> <span class="kd">function</span> <span class="nx">shouldUpdate</span> <span class="p">(</span><span class="nx">entry</span><span class="p">,</span> <span class="nx">existingDocument</span><span class="p">,</span> <span class="nx">cozy</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Update an existing document only if it does not have synchronization data</span>
  <span class="kr">const</span> <span class="nx">hasSyncData</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">existingDocument</span> <span class="o">&amp;&amp;</span> <span class="o">!!</span><span class="nx">existingDocument</span><span class="p">.</span><span class="nx">metadata</span> <span class="o">&amp;&amp;</span> <span class="o">!!</span> <span class="nx">existingDocument</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">sync</span>
  <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="o">!</span><span class="nx">hasSyncData</span><span class="p">)</span>
<span class="p">}</span>
<span class="sb">````</span>

<span class="err">##</span> <span class="nx">Whole</span> <span class="nx">example</span>

<span class="nx">As</span> <span class="nx">the</span> <span class="nx">way</span> <span class="nx">data</span> <span class="nx">are</span> <span class="nx">saved</span> <span class="nx">from</span> <span class="sb">`cozy-konnector-libs`</span> <span class="nx">differs</span> <span class="nx">based</span> <span class="nx">on</span> <span class="nx">data</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">we</span> <span class="kd">let</span> <span class="nx">the</span> <span class="nx">saving</span> <span class="nx">mechanism</span> <span class="nx">to</span> <span class="nx">others</span> <span class="nx">functions</span> <span class="nx">or</span> <span class="nx">methods</span><span class="p">.</span> <span class="nx">For</span> <span class="nx">example</span><span class="p">,</span> <span class="k">in</span> <span class="nx">existing</span> <span class="nx">codebase</span><span class="p">,</span> <span class="nx">bills</span> <span class="nx">are</span> <span class="nx">saved</span> <span class="k">in</span> <span class="nx">a</span> <span class="nx">specific</span> <span class="nx">way</span><span class="p">,</span> <span class="nx">resulting</span> <span class="k">in</span> <span class="nx">two</span> <span class="nx">documents</span> <span class="k">in</span> <span class="nx">database</span><span class="p">.</span> <span class="nx">However</span><span class="p">,</span> <span class="nx">we</span> <span class="nx">could</span> <span class="nx">provide</span> <span class="nx">top</span><span class="o">-</span><span class="nx">level</span> <span class="nx">functions</span> <span class="nx">or</span> <span class="nx">methods</span><span class="p">,</span> <span class="nx">like</span> <span class="sb">`synchronizeBills`</span> <span class="nx">or</span> <span class="nx">a</span> <span class="nx">more</span> <span class="nx">generic</span> <span class="sb">`synchronizeData`</span><span class="p">.</span>

<span class="nx">Here</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">whole</span> <span class="nx">and</span> <span class="nx">naive</span> <span class="nx">example</span> <span class="k">of</span> <span class="nx">how</span> <span class="sb">`synchronizeBills`</span> <span class="nx">could</span> <span class="nx">be</span> <span class="nx">implemebted</span><span class="o">:</span>

<span class="sb">```js</span>
<span class="sb">const synchronizeBills = async (cozy, entries, synchronizationStrategy) =&gt; {</span>
<span class="sb">  return await filteredEntries = await filterEntriesToSynchronize(cozy, entries, synchronizationStrategy)</span>
<span class="sb">    .then(filteredEntries =&gt; filteredEntries.map(entry =&gt; addSyncData(entry, synchronizationStrategy)))</span>
<span class="sb">    // existing saveBills method (with maybe some little changes)</span>
<span class="sb">    .saveBills(synchronizedDocuments)</span>
<span class="sb">}</span>
</pre></div>


<p>Usage could be:</p>
<div class="codehilite"><pre><span></span>synchronizeBills(cozy, entries, {
  findLegacyDocument: (entry, cozy) =&gt; {
    return cozy.files.statByPath(getEntryPath(entry))
  },
  getSyncData: (file) =&gt; ({
    fileName: file.name
  }),
  idAttribute: &#39;uuid&#39;,
  konnector: &#39;myservice&#39;,
  shouldSave: (file) =&gt; {
    // For whatever reason we only save files created after 2010
    return Promise.resolve(moment(file.creationDate).year().isAfter(2010))
  },
  shouldUpdate: (file, existingDocument) =&gt; {
    const hasBeenModified = moment(file.modificationDate).isAfter(existingDocument.metadata.sync.last_sync)
    return Promise.resolve(hasBeenModified)
  }
})
</pre></div>


<p>Every synchronized document will contain:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;sync&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;konnector&quot;</span><span class="p">:</span> <span class="s2">&quot;myservice&quot;</span><span class="p">,</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;entry_id&gt;&quot;</span><span class="p">,</span>
      <span class="nt">&quot;last_sync&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;now&gt;&quot;</span><span class="p">,</span>
      <span class="nt">&quot;fileName&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;fileName&gt;&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
                </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <!-- Piwik -->
        <script type="text/javascript">
          var _paq = _paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
          _paq.push(['trackPageView']);
          _paq.push(['enableLinkTracking']);
          (function() {
            var u="//matomo.cozycloud.cc/";
            _paq.push(['setTrackerUrl', u+'piwik.php']);
            _paq.push(['setSiteId', '7']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
          })();
        </script>
        <noscript><p><img src="//matomo.cozycloud.cc/piwik.php?idsite=7&rec=1" style="border:0;" alt="" /></p></noscript>
        <!-- End Piwik Code -->
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>
        <script src="../../extra.js"></script>
        <script src="../../search/main.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
