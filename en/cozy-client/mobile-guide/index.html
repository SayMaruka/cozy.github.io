<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <meta name="author" content="CozyCloud - https://cozy.io">
        <link rel="canonical" href="https://docs.cozy.io/cozy-client/mobile-guide/">
        <link rel="shortcut icon" href="../../img/favicon.png">
        
        <title>mobile-guide - Dev Documentation</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
            <link href="../../css/extra.css" rel="stylesheet">
            <link href="../../css/highlight_theme.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

	<script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://docs.cozy.io/">Dev Documentation</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../..">Home</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorials <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../tutorials/app/">Create Your Application</a>
</li>
                            
<li >
    <a href="../../tutorials/konnector/">Develop a Connector</a>
</li>
                            
<li >
    <a href="../../tutorials/selfhost-debian/">Self-Host on Debian</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">How-to <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
  <li class="dropdown-submenu">
    <a href="#">Dev</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../howTos/dev/runCozyDocker/">Run an App in a Cozy using Docker</a>
</li>
            
<li >
    <a href="../../howTos/dev/hmr/">Use Hot Module Replacement in Your App</a>
</li>
            
<li >
    <a href="../../howTos/dev/cordova/">Make a Mobile App Using Cordova</a>
</li>
            
<li >
    <a href="../../howTos/dev/connect-mobile-app-local-stack/">Connect a Mobile App to Your Local Stack</a>
</li>
            
<li >
    <a href="../../howTos/dev/sendmail/">Send and Receive E-mails in Development</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Synchronize</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../howTos/sync/linux/">Install Cozy Drive on GNU/Linux</a>
</li>
    </ul>
  </li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">References <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../references/tech-intro/">Technical introduction to the Cozy platform</a>
</li>
                            
<li >
    <a href="../../references/git-flow/">Our Front-End Git Flow</a>
</li>
                            
  <li class="dropdown-submenu">
    <a href="#">Stack and tools</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">cozy-app-publish</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-app-publish/README/">CLI & Workflow</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-apps-registry</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-apps-registry/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-client</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../getting-started/">Getting started</a>
</li>
            
<li >
    <a href="../how-tos/">How tos</a>
</li>
            
<li >
    <a href="../api/cozy-client/">Cozy Client API</a>
</li>
            
<li >
    <a href="../api/cozy-pouch-link/">Cozy Pouch Link API</a>
</li>
            
<li >
    <a href="../api/cozy-stack-client/">Cozy Stack Client API</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-client-js</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-client-js/README/">README</a>
</li>
            
<li >
    <a href="../../cozy-client-js/intro/">Introduction</a>
</li>
            
<li >
    <a href="../../cozy-client-js/browser-sdk-transition/">Transition from cozy-browser-sdk</a>
</li>
            
<li >
    <a href="../../cozy-client-js/offline/">How to support offline</a>
</li>
            
<li >
    <a href="../../cozy-client-js/oauth/">OAuth guide</a>
</li>
            
<li >
    <a href="../../cozy-client-js/auth-api/">Authentication API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/data-api/">Data System API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/files-api/">Files API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/jobs-api/">Jobs API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/intents-api/">Intents API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/settings-api/">Settings API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/sharing-api/">Sharing API</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-ui</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-ui/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-doctypes</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-doctypes/docs/README/">README</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.accounts/">Accounts</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.photos.albums/">Albums</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.bank/">Banking doctypes</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.bills/">Bills</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.konnectors/">Connectors</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.contacts/">Contacts</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.files/">Files</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.files_metadata/">Files metadata</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.notifications/">Notifications</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.remote.requests/">Remote requests</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.sessions.logins/">Session logins</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.sharings/">Sharings</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.triggers/">Triggers</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-konnector-libs</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-konnector-libs/api/">API</a>
</li>
            
<li >
    <a href="../../cozy-konnector-libs/cli/">CLI</a>
</li>
            
<li >
    <a href="../../cozy-konnector-libs/dev/">Develop</a>
</li>
            
<li >
    <a href="../../cozy-konnector-libs/errors/">Errors</a>
</li>
            
<li >
    <a href="../../cozy-konnector-libs/operation-linking/">Operation linking</a>
</li>
            
<li >
    <a href="../../cozy-konnector-libs/synchronization/">Synchronization</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-stack</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/README/">README</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Usage</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/INSTALL/">Install the cozy-stack</a>
</li>
            
<li >
    <a href="../../cozy-stack/config/">Configuration file</a>
</li>
            
<li >
    <a href="../../cozy-stack/instance/">Managing Instances</a>
</li>
            
<li >
    <a href="../../cozy-stack/security/">Security</a>
</li>
            
<li >
    <a href="../../cozy-stack/cli/cozy-stack/">Manpages of the command-line tool</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">How-to guides for developpers</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/client-app-dev/">Develop a client-side app</a>
</li>
            
<li >
    <a href="../../cozy-stack/docker/">Running and building Docker images</a>
</li>
            
<li >
    <a href="../../cozy-stack/doctype/">Adding a new doctype</a>
</li>
            
<li >
    <a href="../../cozy-stack/assets/">Working with the stack assets</a>
</li>
            
<li >
    <a href="../../cozy-stack/release/">Build a release</a>
</li>
            
<li >
    <a href="../../cozy-stack/CONTRIBUTING/">The contributing guide</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Explanations</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/sharing-design/">Sharing design</a>
</li>
            
<li >
    <a href="../../cozy-stack/konnectors-workflow/">Workflow of the konnectors</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">List of services</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/auth/">/auth - Authentication & OAuth</a>
</li>
            
<li >
    <a href="../../cozy-stack/apps/">/apps - Applications Management</a>
</li>
            
<li >
    <a href="../../cozy-stack/registry/"> /apps - Apps registry</a>
</li>
            
<li >
    <a href="../../cozy-stack/konnectors/"> /apps - Konnectors</a>
</li>
            
<li >
    <a href="../../cozy-stack/data-system/">/data - Data System</a>
</li>
            
<li >
    <a href="../../cozy-stack/mango/"> /data - Mango</a>
</li>
            
<li >
    <a href="../../cozy-stack/couchdb-quirks/"> /data - CouchDB Quirks</a>
</li>
            
<li >
    <a href="../../cozy-stack/pouchdb-quirks/"> /data - PouchDB Quirks</a>
</li>
            
<li >
    <a href="../../cozy-stack/files/">/files - Virtual File System</a>
</li>
            
<li >
    <a href="../../cozy-stack/references-docs-in-vfs/"> /files - References of documents in VFS</a>
</li>
            
<li >
    <a href="../../cozy-stack/intents/">/intents - Intents</a>
</li>
            
<li >
    <a href="../../cozy-stack/jobs/">/jobs - Jobs</a>
</li>
            
<li >
    <a href="../../cozy-stack/workers/"> /jobs - Workers</a>
</li>
            
<li >
    <a href="../../cozy-stack/move/">/move - Move, export and import an instance</a>
</li>
            
<li >
    <a href="../../cozy-stack/notifications/">/notifications - Notifications</a>
</li>
            
<li >
    <a href="../../cozy-stack/public/">/public - Public</a>
</li>
            
<li >
    <a href="../../cozy-stack/permissions/">/permissions - Permissions</a>
</li>
            
<li >
    <a href="../../cozy-stack/realtime/">/realtime - Realtime</a>
</li>
            
<li >
    <a href="../../cozy-stack/remote/">/remote - Proxy for remote data/API</a>
</li>
            
<li >
    <a href="../../cozy-stack/settings/">/settings - Settings</a>
</li>
            
<li >
    <a href="../../cozy-stack/user-action-required/"> /settings - Terms of Services</a>
</li>
            
<li >
    <a href="../../cozy-stack/sharing/">/sharings - Sharing</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">konitor</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../konitor/cli/">CLI</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">babel-preset-cozy-app</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../babel-preset-cozy-app/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">commitlint-config-cozy</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../commitlint-config-cozy/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-device-helper</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-device-helper/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">eslint-config-cozy-app</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../eslint-config-cozy-app/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-flags</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-flags/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-realtime</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-realtime/README/">README</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li>
                        <a href="https://github.com/cozy/cozy.github.io/">
                                <i class="fa fa-github"></i>GitHub
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3 main-toc">
<div class="bs-sidebar hidden-print affix" role="complementary">
    <ul class="nav bs-sidenav well" style='padding-left: 0; padding-right: 0; margin-bottom: 1.5rem'>
        <li class="main active"><a href="#using-cozyclient-on-a-mobile-app">Using CozyClient on a mobile app</a></li>
            <li><a href="#configuration">Configuration 🛠</a></li>
            <li><a href="#starting-the-oauth-flow">Starting the OAuth flow 🏄‍♂️</a></li>
            <li><a href="#how-to-restore-a-previous-token">How to restore a previous token ?</a></li>
            <li><a href="#how-to-logout-the-client">How to logout the client ?</a></li>
        <li class="main "><a href="#support-offline-for-some-doctypes-with-cozy-pouch-link">Support offline for some doctypes with cozy-pouch-link</a></li>
    </ul>
  <div style='padding-left: 2rem'>
    
    <a id='edit-link' href='https://github.com/cozy/cozy.github.io/edit/dev/src/cozy-client/mobile-guide.md'>Edit documentation</a>
    <script type='text/javascript'>
        /* Here we detect if the current page is from an external documentation and we 
        change the href of the editing link so it goes to the right repository and file */
        const outsideDocs = [{"name": "cozy-app-publish", "repo": "https://github.com/cozy/cozy-app-publish.git", "subdir": "."}, {"name": "cozy-apps-registry", "repo": "https://github.com/cozy/cozy-apps-registry.git", "subdir": "."}, {"name": "cozy-client", "repo": "https://github.com/cozy/cozy-client.git", "subdir": "docs"}, {"name": "cozy-client-js", "repo": "https://github.com/cozy/cozy-client-js.git", "subdir": "docs"}, {"name": "cozy-ui", "repo": "https://github.com/cozy/cozy-ui.git", "subdir": "docs"}, {"name": "cozy-doctypes", "repo": "https://github.com/cozy/cozy-doctypes.git", "subdir": "."}, {"name": "cozy-konnector-libs", "repo": "https://github.com/konnectors/libs.git", "subdir": "packages/cozy-konnector-libs/docs"}, {"name": "cozy-scripts", "repo": "https://github.com/CPatchane/create-cozy-app.git", "subdir": "packages/cozy-scripts/docs"}, {"name": "cozy-stack", "repo": "https://github.com/cozy/cozy-stack.git", "subdir": "docs"}, {"name": "konitor", "repo": "https://github.com/konnectors/konitor.git", "subdir": "docs"}, {"name": "babel-preset-cozy-app", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/babel-preset-cozy-app"}, {"name": "commitlint-config-cozy", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/commitlint-config-cozy"}, {"name": "cozy-device-helper", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-device-helper"}, {"name": "eslint-config-cozy-app", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/eslint-config-cozy-app"}, {"name": "cozy-flags", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-flags"}, {"name": "cozy-realtime", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-realtime"}]
        const editNode = document.querySelector('#edit-link')
        const pathname = window.location.pathname
        const editURI = 'edit/master/'
        const removeGitSuffix = function (x) { return x.replace(/\.git$/, '') }

        // Returns the external repo associated to a pathname
        const detectExternalRepo = function (pathname) {
            for (var outsideDoc of outsideDocs) {
                if (window.location.pathname.includes('/' + outsideDoc.name + '/')) {
                    return outsideDoc
                }
            }
        }

        // Change the href attribute of a link to point to the correct edition page on GitHub
        // for the passed external documentation
        const fixEditLink = function (editNode, externalDoc) {
            const repoFile = pathname.replace('/en/' + externalDoc.name, '').replace(/\/$/, '.md')
            const baseRepo = removeGitSuffix(externalDoc.repo)
            editNode.href = baseRepo + '/' + editURI + externalDoc.subdir + repoFile
        }

        const externalRepo = detectExternalRepo(pathname)
        if (externalRepo) {
            fixEditLink(editNode, externalRepo)
        }
    </script>
    
  </div>
</div></div>
                <div class="col-md-9" role="main">
                    

<!-- MarkdownTOC autolink=true -->

<ul>
<li><a href="#using-cozyclient-on-a-mobile-app">Using CozyClient on a mobile app</a></li>
<li><a href="#configuration-%F0%9F%9B%A0">Configuration 🛠</a></li>
<li><a href="#starting-the-oauth-flow-%F0%9F%8F%84%E2%80%8D%E2%99%82%EF%B8%8F">Starting the OAuth flow 🏄‍♂️</a></li>
<li><a href="#how-to-restore-a-previous-token-">How to restore a previous token ?</a></li>
<li><a href="#how-to-logout-the-client-">How to logout the client ?</a></li>
<li><a href="#support-offline-for-some-doctypes-with-cozy-pouch-link">Support offline for some doctypes with <code>cozy-pouch-link</code></a></li>
</ul>
<!-- /MarkdownTOC -->

<h2 id="using-cozyclient-on-a-mobile-app">Using CozyClient on a mobile app<a class="headerlink" href="#using-cozyclient-on-a-mobile-app" title="Permanent link">&para;</a></h2>
<h3 id="configuration">Configuration 🛠<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h3>
<p>On the web, the server pass the token and the domain to the page directly through template variables. This is not possible on mobile as there is no server to serve the page. <code>CozyClient</code> supports connecting to a Cozy via OAtuh.</p>
<p>To get started, configure the OAuth settings when creating the client:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="nx">CozyClient</span> <span class="nx">from</span> <span class="s1">&#39;cozy-client&#39;</span>

<span class="kr">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CozyClient</span><span class="p">({</span>
  <span class="nx">uri</span><span class="o">:</span> <span class="s1">&#39;http://cozy.tools:8080&#39;</span><span class="p">,</span>
  <span class="nx">scope</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;io.cozy.mydoctype&#39;</span><span class="p">],</span>
  <span class="nx">oauth</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">clientName</span><span class="o">:</span> <span class="s1">&#39;MyClient&#39;</span><span class="p">,</span>
    <span class="nx">softwareID</span><span class="o">:</span> <span class="s1">&#39;MyAppId&#39;</span><span class="p">,</span>
    <span class="nx">redirectURI</span><span class="o">:</span> <span class="s1">&#39;http://localhost&#39;</span>
  <span class="p">}</span>
<span class="p">})</span>
</pre></div>


<ul>
<li>
<p><code>scope</code> is an array of <a href="https://github.com/cozy/cozy-stack/blob/master/docs/permissions.md">permissions</a> you require for your client</p>
</li>
<li>
<p><code>oauth</code> is a list of fields that identify your client for the user and the server. The complete list of field can be found <a href="https://github.com/cozy/cozy-stack/blob/master/docs/permissions.md">here</a>, although they should be camel-cased instead of snake-cased.</p>
</li>
</ul>
<h3 id="starting-the-oauth-flow">Starting the OAuth flow 🏄‍♂️<a class="headerlink" href="#starting-the-oauth-flow" title="Permanent link">&para;</a></h3>
<p>Before you can start making requests to the server, you will need to get a token. <code>cozy-client</code> will provide a URL to a page where the user is shown what data you want to access, and asking for his or her permission. After the user accepts these permissions, he or she is redirected to the <code>oauth.redirectURI</code> that you declared earlier. You will then have to give this redirected URL back to <code>cozy-client</code> as it contains a code, that will be exchanged for the token.</p>
<p>To get started, you call <code>client.startOAuthFlow</code> like this:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="nx">CozyClient</span> <span class="nx">from</span> <span class="s1">&#39;cozy-client&#39;</span>

<span class="kr">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CozyClient</span><span class="p">({</span>
  <span class="nx">uri</span><span class="o">:</span> <span class="s1">&#39;http://cozy.tools:8080&#39;</span><span class="p">,</span>
  <span class="nx">scope</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;io.cozy.mydoctype&#39;</span><span class="p">],</span>
  <span class="nx">oauth</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">clientName</span><span class="o">:</span> <span class="s1">&#39;MyClient&#39;</span><span class="p">,</span>
    <span class="nx">softwareID</span><span class="o">:</span> <span class="s1">&#39;MyAppId&#39;</span><span class="p">,</span>
    <span class="nx">redirectURI</span><span class="o">:</span> <span class="s1">&#39;http://localhost&#39;</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="nx">client</span><span class="p">.</span><span class="nx">startOAuthFlow</span><span class="p">(</span><span class="nx">openURL</span><span class="p">)</span>
</pre></div>


<p>The <code>openURL</code> parameter is a callback. It will receive the URL to the page as a parameter, and it must return a <code>Promise</code> that resolves with the redirected URL. How exactly you do this depends on your environment — for a mobile app you may use a WebView, in a browser maybe a new tab… Here is an example that uses the browser&rsquo;s console and an experienced user:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">openURL</span> <span class="o">=</span> <span class="nx">url</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Please visit the following URL, accept the permissions and copy the URL you are redirected to, then come back here. you have 10 seconds.&#39;</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">async</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">returnUrl</span> <span class="o">=</span> <span class="nx">prompt</span><span class="p">(</span><span class="s1">&#39;Paste the new URL here.&#39;</span><span class="p">)</span>
      <span class="nx">resolve</span><span class="p">(</span><span class="nx">returnUrl</span><span class="p">)</span>
    <span class="p">},</span> <span class="mi">10000</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span>
</pre></div>


<p>And that&rsquo;s it! After the promise is resolved, <code>cozy-client</code> finishes the OAuth flow and you can start using it.</p>
<h3 id="how-to-restore-a-previous-token">How to restore a previous token ?<a class="headerlink" href="#how-to-restore-a-previous-token" title="Permanent link">&para;</a></h3>
<p>Nobody likes to enter passwords, and you don&rsquo;t want to make your user go through this whole process every time your app starts. In order to restore the client from a previous version, you need to give it a token and some extra information about itself. Both of these are returned by the <code>openURL</code> function, so you can store them wherever you see fit — in this example we&rsquo;ll use the <code>localStorage</code> API.</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="nx">CozyClient</span> <span class="nx">from</span> <span class="s1">&#39;cozy-client&#39;</span>

<span class="kr">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CozyClient</span><span class="p">({</span>
  <span class="nx">uri</span><span class="o">:</span> <span class="s1">&#39;http://cozy.tools:8080&#39;</span><span class="p">,</span>
  <span class="nx">scope</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;io.cozy.mydoctype&#39;</span><span class="p">],</span>
  <span class="nx">oauth</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">clientName</span><span class="o">:</span> <span class="s1">&#39;MyClient&#39;</span><span class="p">,</span>
    <span class="nx">softwareID</span><span class="o">:</span> <span class="s1">&#39;MyAppId&#39;</span><span class="p">,</span>
    <span class="nx">redirectURI</span><span class="o">:</span> <span class="s1">&#39;http://localhost&#39;</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="kr">const</span> <span class="p">{</span><span class="nx">token</span><span class="p">,</span> <span class="nx">infos</span><span class="p">}</span> <span class="o">=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">startOAuthFlow</span><span class="p">(</span><span class="nx">openURL</span><span class="p">)</span>
<span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">,</span> <span class="nx">token</span><span class="p">)</span>
<span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;infos&#39;</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">infos</span><span class="p">))</span>
</pre></div>


<p>Next time your app starts, you can pass these informations to the constructor. Here is a complete example of the OAuth client initilisation:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">storedToken</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="kc">null</span>
<span class="kr">const</span> <span class="nx">storedInfos</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;infos&#39;</span><span class="p">))</span> <span class="o">||</span> <span class="p">{</span>
  <span class="nx">clientName</span><span class="o">:</span> <span class="s1">&#39;MyClient&#39;</span><span class="p">,</span>
  <span class="nx">softwareID</span><span class="o">:</span> <span class="s1">&#39;MyAppId&#39;</span><span class="p">,</span>
  <span class="nx">redirectURI</span><span class="o">:</span> <span class="s1">&#39;http://localhost&#39;</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CozyClient</span><span class="p">({</span>
  <span class="nx">uri</span><span class="o">:</span> <span class="s1">&#39;http://cozy.tools:8080&#39;</span><span class="p">,</span>
  <span class="nx">oauth</span><span class="o">:</span> <span class="nx">storedInfos</span><span class="p">,</span>
  <span class="nx">token</span><span class="o">:</span> <span class="nx">storedToken</span><span class="p">,</span>
  <span class="nx">scope</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;io.cozy.mydoctype&#39;</span><span class="p">]</span>
<span class="p">});</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">storedToken</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span><span class="nx">token</span><span class="p">,</span> <span class="nx">infos</span><span class="p">}</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">startOAuthFlow</span><span class="p">(</span><span class="nx">openURL</span><span class="p">)</span>
  <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">,</span> <span class="nx">token</span><span class="p">)</span>
  <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;infos&#39;</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">infos</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>


<h3 id="how-to-logout-the-client">How to logout the client ?<a class="headerlink" href="#how-to-logout-the-client" title="Permanent link">&para;</a></h3>
<p>When a user logout, we would like remove all references on this instance and
remove all user data. You can just use <code>cozyClient.logout()</code>.</p>
<h2 id="support-offline-for-some-doctypes-with-cozy-pouch-link">Support offline for some doctypes with <code>cozy-pouch-link</code><a class="headerlink" href="#support-offline-for-some-doctypes-with-cozy-pouch-link" title="Permanent link">&para;</a></h2>
<p>If you are already using <code>cozy-client</code> and the <code>StackLink</code>, you may want to go
further and store some documents locally so you can retrieve them even while
being offline.</p>
<p>Currently, you have a code like this one :</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="nx">CozyClient</span><span class="p">,</span> <span class="p">{</span> <span class="nx">StackLink</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;cozy-client&#39;</span>

<span class="kr">const</span> <span class="nx">stackLink</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">StackLink</span><span class="p">()</span>

<span class="kr">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CozyClient</span><span class="p">({</span>
  <span class="c1">// ...</span>
  <span class="nx">links</span><span class="o">:</span> <span class="p">[</span><span class="nx">stackLink</span><span class="p">]</span>
<span class="p">})</span>
</pre></div>


<p>To manage the offline aspect, we provide the
<a href="https://github.com/cozy/cozy-client/tree/master/packages/cozy-pouch-link">cozy-pouch-link</a>.
First, let&rsquo;s install it :</p>
<div class="codehilite"><pre><span></span><span class="gp">#</span> using npm
<span class="go">npm install cozy-pouch-link</span>

<span class="gp">#</span> using yarn
<span class="go">yarn add cozy-pouch-link</span>
</pre></div>


<p>Then, we will create a new instance of this link and give it the list of
doctypes that we want to access offline. We have to put the <code>PouchLink</code> first, so
it is reached first when we query the link chain :</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="nx">CozyClient</span><span class="p">,</span> <span class="p">{</span> <span class="nx">StackLink</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;cozy-client&#39;</span>
<span class="kr">import</span> <span class="nx">PouchLink</span> <span class="nx">from</span> <span class="s1">&#39;cozy-pouch-link&#39;</span>

<span class="kr">const</span> <span class="nx">stackLink</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">StackLink</span><span class="p">()</span>

<span class="kr">const</span> <span class="nx">offlineDoctypes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;io.cozy.todos&#39;</span><span class="p">]</span>
<span class="kr">const</span> <span class="nx">pouchLink</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PouchLink</span><span class="p">({</span>
  <span class="nx">doctypes</span><span class="o">:</span> <span class="nx">offlineDoctypes</span><span class="p">,</span>
  <span class="nx">initialSync</span><span class="o">:</span> <span class="kc">true</span> <span class="c1">// whether you want to trigger the synchronization on login or not</span>
<span class="p">})</span>

<span class="kr">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CozyClient</span><span class="p">({</span>
  <span class="c1">// ...</span>
  <span class="nx">links</span><span class="o">:</span> <span class="p">[</span><span class="nx">pouchLink</span><span class="p">,</span> <span class="nx">stackLink</span><span class="p">]</span>
<span class="p">})</span>
</pre></div>


<p>The <code>PouchLink</code> will create the PouchDB databases for all offline doctypes and
synchronize them with the distant CouchDB. All doctypes that are not managed by
the <code>PouchLink</code> will be passed to the next link in the chain (in the previous
example, the <code>StackLink</code>).</p>
                </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <!-- Piwik -->
        <script type="text/javascript">
          var _paq = _paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
          _paq.push(['trackPageView']);
          _paq.push(['enableLinkTracking']);
          (function() {
            var u="//matomo.cozycloud.cc/";
            _paq.push(['setTrackerUrl', u+'piwik.php']);
            _paq.push(['setSiteId', '7']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
          })();
        </script>
        <noscript><p><img src="//matomo.cozycloud.cc/piwik.php?idsite=7&rec=1" style="border:0;" alt="" /></p></noscript>
        <!-- End Piwik Code -->
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>
        <script src="../../extra.js"></script>
        <script src="../../search/main.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
