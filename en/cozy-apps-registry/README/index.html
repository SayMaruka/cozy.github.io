<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <meta name="author" content="CozyCloud - https://cozy.io">
        <link rel="canonical" href="https://docs.cozy.io/cozy-apps-registry/README/">
        <link rel="shortcut icon" href="../../img/favicon.png">
        
        <title>README - Dev Documentation</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
            <link href="../../css/extra.css" rel="stylesheet">
            <link href="../../css/highlight_theme.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

	<script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://docs.cozy.io/">Dev Documentation</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../..">Home</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorials <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../tutorials/app/">Create Your Application</a>
</li>
                            
<li >
    <a href="../../tutorials/konnector/">Develop a Connector</a>
</li>
                            
<li >
    <a href="../../tutorials/selfhost-debian/">Self-Host on Debian</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">How-to <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
  <li class="dropdown-submenu">
    <a href="#">Dev</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../howTos/dev/runCozyDocker/">Run an App in a Cozy using Docker</a>
</li>
            
<li >
    <a href="../../howTos/dev/hmr/">Use Hot Module Replacement in Your App</a>
</li>
            
<li >
    <a href="../../howTos/dev/cordova/">Make a Mobile App Using Cordova</a>
</li>
            
<li >
    <a href="../../howTos/dev/connect-mobile-app-local-stack/">Connect a Mobile App to Your Local Stack</a>
</li>
            
<li >
    <a href="../../howTos/dev/sendmail/">Send and Receive E-mails in Development</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Synchronize</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../howTos/sync/linux/">Install Cozy Drive on GNU/Linux</a>
</li>
    </ul>
  </li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">References <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../references/tech-intro/">Technical introduction to the Cozy platform</a>
</li>
                            
<li >
    <a href="../../references/git-flow/">Our Front-End Git Flow</a>
</li>
                            
  <li class="dropdown-submenu">
    <a href="#">Stack and tools</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">cozy-app-publish</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-app-publish/README/">CLI & Workflow</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-apps-registry</a>
    <ul class="dropdown-menu">
            
<li class="active">
    <a href="./">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-client</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-client/getting-started/">Getting started</a>
</li>
            
<li >
    <a href="../../cozy-client/how-tos/">How tos</a>
</li>
            
<li >
    <a href="../../cozy-client/api/cozy-client/">Cozy Client API</a>
</li>
            
<li >
    <a href="../../cozy-client/api/cozy-pouch-link/">Cozy Pouch Link API</a>
</li>
            
<li >
    <a href="../../cozy-client/api/cozy-stack-client/">Cozy Stack Client API</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-client-js</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-client-js/README/">README</a>
</li>
            
<li >
    <a href="../../cozy-client-js/intro/">Introduction</a>
</li>
            
<li >
    <a href="../../cozy-client-js/browser-sdk-transition/">Transition from cozy-browser-sdk</a>
</li>
            
<li >
    <a href="../../cozy-client-js/offline/">How to support offline</a>
</li>
            
<li >
    <a href="../../cozy-client-js/oauth/">OAuth guide</a>
</li>
            
<li >
    <a href="../../cozy-client-js/auth-api/">Authentication API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/data-api/">Data System API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/files-api/">Files API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/jobs-api/">Jobs API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/intents-api/">Intents API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/settings-api/">Settings API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/sharing-api/">Sharing API</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-ui</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-ui/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-doctypes</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-doctypes/docs/README/">README</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.accounts/">Accounts</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.photos.albums/">Albums</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.bank/">Banking doctypes</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.bills/">Bills</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.konnectors/">Connectors</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.contacts/">Contacts</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.files/">Files</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.notifications/">Notifications</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.remote.requests/">Remote requests</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.sessions.logins/">Session logins</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.sharings/">Sharings</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.triggers/">Triggers</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-konnector-libs</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-konnector-libs/api/">API</a>
</li>
            
<li >
    <a href="../../cozy-konnector-libs/cli/">CLI</a>
</li>
            
<li >
    <a href="../../cozy-konnector-libs/dev/">Develop</a>
</li>
            
<li >
    <a href="../../cozy-konnector-libs/errors/">Errors</a>
</li>
            
<li >
    <a href="../../cozy-konnector-libs/operation-linking/">Operation linking</a>
</li>
            
<li >
    <a href="../../cozy-konnector-libs/synchronization/">Synchronization</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-stack</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/README/">README</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Usage</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/INSTALL/">Install the cozy-stack</a>
</li>
            
<li >
    <a href="../../cozy-stack/config/">Configuration file</a>
</li>
            
<li >
    <a href="../../cozy-stack/instance/">Managing Instances</a>
</li>
            
<li >
    <a href="../../cozy-stack/security/">Security</a>
</li>
            
<li >
    <a href="../../cozy-stack/cli/cozy-stack/">Manpages of the command-line tool</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">How-to guides for developpers</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/client-app-dev/">Develop a client-side app</a>
</li>
            
<li >
    <a href="../../cozy-stack/docker/">Running and building Docker images</a>
</li>
            
<li >
    <a href="../../cozy-stack/doctype/">Adding a new doctype</a>
</li>
            
<li >
    <a href="../../cozy-stack/assets/">Working with the stack assets</a>
</li>
            
<li >
    <a href="../../cozy-stack/release/">Build a release</a>
</li>
            
<li >
    <a href="../../cozy-stack/CONTRIBUTING/">The contributing guide</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Explanations</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/sharing-design/">Sharing design</a>
</li>
            
<li >
    <a href="../../cozy-stack/konnectors-workflow/">Workflow of the konnectors</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">List of services</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/auth/">/auth - Authentication & OAuth</a>
</li>
            
<li >
    <a href="../../cozy-stack/apps/">/apps - Applications Management</a>
</li>
            
<li >
    <a href="../../cozy-stack/registry/"> /apps - Apps registry</a>
</li>
            
<li >
    <a href="../../cozy-stack/konnectors/"> /apps - Konnectors</a>
</li>
            
<li >
    <a href="../../cozy-stack/data-system/">/data - Data System</a>
</li>
            
<li >
    <a href="../../cozy-stack/mango/"> /data - Mango</a>
</li>
            
<li >
    <a href="../../cozy-stack/couchdb-quirks/"> /data - CouchDB Quirks</a>
</li>
            
<li >
    <a href="../../cozy-stack/pouchdb-quirks/"> /data - PouchDB Quirks</a>
</li>
            
<li >
    <a href="../../cozy-stack/files/">/files - Virtual File System</a>
</li>
            
<li >
    <a href="../../cozy-stack/references-docs-in-vfs/"> /files - References of documents in VFS</a>
</li>
            
<li >
    <a href="../../cozy-stack/intents/">/intents - Intents</a>
</li>
            
<li >
    <a href="../../cozy-stack/jobs/">/jobs - Jobs</a>
</li>
            
<li >
    <a href="../../cozy-stack/workers/"> /jobs - Workers</a>
</li>
            
<li >
    <a href="../../cozy-stack/move/">/move - Move, export and import an instance</a>
</li>
            
<li >
    <a href="../../cozy-stack/notifications/">/notifications - Notifications</a>
</li>
            
<li >
    <a href="../../cozy-stack/public/">/public - Public</a>
</li>
            
<li >
    <a href="../../cozy-stack/permissions/">/permissions - Permissions</a>
</li>
            
<li >
    <a href="../../cozy-stack/realtime/">/realtime - Realtime</a>
</li>
            
<li >
    <a href="../../cozy-stack/remote/">/remote - Proxy for remote data/API</a>
</li>
            
<li >
    <a href="../../cozy-stack/settings/">/settings - Settings</a>
</li>
            
<li >
    <a href="../../cozy-stack/user-action-required/"> /settings - Terms of Services</a>
</li>
            
<li >
    <a href="../../cozy-stack/sharing/">/sharings - Sharing</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">konitor</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../konitor/cli/">CLI</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">babel-preset-cozy-app</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../babel-preset-cozy-app/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">commitlint-config-cozy</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../commitlint-config-cozy/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-device-helper</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-device-helper/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">eslint-config-cozy-app</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../eslint-config-cozy-app/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-flags</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-flags/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-realtime</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-realtime/README/">README</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li>
                        <a href="https://github.com/cozy/cozy.github.io/">
                                <i class="fa fa-github"></i>GitHub
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3 main-toc">
<div class="bs-sidebar hidden-print affix" role="complementary">
    <ul class="nav bs-sidenav well" style='padding-left: 0; padding-right: 0; margin-bottom: 1.5rem'>
        <li class="main active"><a href="#cozy-apps-registry">cozy-apps-registry</a></li>
            <li><a href="#whats-cozy">What's Cozy?</a></li>
            <li><a href="#table-of-contents">Table of contents</a></li>
            <li><a href="#what-about-this-repository">What about this repository?</a></li>
            <li><a href="#how-to-develop-with-a-cozy-apps-registry-working-in-local-environment">How to develop with a cozy-apps-registry working in local environment</a></li>
            <li><a href="#publish-your-application-on-the-registry">Publish your application on the registry</a></li>
            <li><a href="#access-control-and-tokens">Access control and tokens</a></li>
            <li><a href="#maintenance">Maintenance</a></li>
            <li><a href="#application-confidence-grade-labelling">Application confidence grade / labelling</a></li>
            <li><a href="#community">Community</a></li>
    </ul>
  <div style='padding-left: 2rem'>
    
    <a id='edit-link' href='https://github.com/cozy/cozy.github.io/edit/dev/src/cozy-apps-registry/README.md'>Edit documentation</a>
    <script type='text/javascript'>
        /* Here we detect if the current page is from an external documentation and we 
        change the href of the editing link so it goes to the right repository and file */
        const outsideDocs = [{"name": "cozy-app-publish", "repo": "https://github.com/cozy/cozy-app-publish.git", "subdir": "."}, {"name": "cozy-apps-registry", "repo": "https://github.com/cozy/cozy-apps-registry.git", "subdir": "."}, {"name": "cozy-client", "repo": "https://github.com/cozy/cozy-client.git", "subdir": "docs"}, {"name": "cozy-client-js", "repo": "https://github.com/cozy/cozy-client-js.git", "subdir": "docs"}, {"name": "cozy-ui", "repo": "https://github.com/cozy/cozy-ui.git", "subdir": "docs"}, {"name": "cozy-doctypes", "repo": "https://github.com/cozy/cozy-doctypes.git", "subdir": "."}, {"name": "cozy-konnector-libs", "repo": "https://github.com/konnectors/libs.git", "subdir": "packages/cozy-konnector-libs/docs"}, {"name": "cozy-scripts", "repo": "https://github.com/CPatchane/create-cozy-app.git", "subdir": "packages/cozy-scripts/docs"}, {"name": "cozy-stack", "repo": "https://github.com/cozy/cozy-stack.git", "subdir": "docs"}, {"name": "konitor", "repo": "https://github.com/konnectors/konitor.git", "subdir": "docs"}, {"name": "babel-preset-cozy-app", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/babel-preset-cozy-app"}, {"name": "commitlint-config-cozy", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/commitlint-config-cozy"}, {"name": "cozy-device-helper", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-device-helper"}, {"name": "eslint-config-cozy-app", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/eslint-config-cozy-app"}, {"name": "cozy-flags", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-flags"}, {"name": "cozy-realtime", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-realtime"}]
        const editNode = document.querySelector('#edit-link')
        const pathname = window.location.pathname
        const editURI = 'edit/master/'
        const removeGitSuffix = function (x) { return x.replace(/\.git$/, '') }

        // Returns the external repo associated to a pathname
        const detectExternalRepo = function (pathname) {
            for (var outsideDoc of outsideDocs) {
                if (window.location.pathname.includes('/' + outsideDoc.name + '/')) {
                    return outsideDoc
                }
            }
        }

        // Change the href attribute of a link to point to the correct edition page on GitHub
        // for the passed external documentation
        const fixEditLink = function (editNode, externalDoc) {
            const repoFile = pathname.replace('/en/' + externalDoc.name, '').replace(/\/$/, '.md')
            const baseRepo = removeGitSuffix(externalDoc.repo)
            editNode.href = baseRepo + '/' + editURI + externalDoc.subdir + repoFile
        }

        const externalRepo = detectExternalRepo(pathname)
        if (externalRepo) {
            fixEditLink(editNode, externalRepo)
        }
    </script>
    
  </div>
</div></div>
                <div class="col-md-9" role="main">
                    

<h1 id="cozy-apps-registry">cozy-apps-registry<a class="headerlink" href="#cozy-apps-registry" title="Permanent link">&para;</a></h1>
<h3 id="whats-cozy">What&rsquo;s Cozy?<a class="headerlink" href="#whats-cozy" title="Permanent link">&para;</a></h3>
<div align="center">
  <a href="https://cozy.io">
    <img src="https://cdn.rawgit.com/cozy/cozy-site/master/src/images/cozy-logo-name-horizontal-blue.svg" alt="cozy" height="48" />
  </a>
 </div>

<p></br></p>
<p><a href="https://cozy.io" title="Cozy Cloud">Cozy</a> is a platform that brings all your web services in the same private space.  With it, your webapps and your devices can share data easily, providing you with a new experience. You can install Cozy on your own hardware where no one&rsquo;s tracking you.</p>
<h2 id="table-of-contents">Table of contents<a class="headerlink" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="#cozy-apps-registry">cozy-apps-registry</a><ul>
<li><a href="#whats-cozy">What&rsquo;s Cozy?</a></li>
</ul>
</li>
<li><a href="#table-of-contents">Table of contents</a></li>
<li><a href="#what-about-this-repository">What about this repository?</a></li>
<li><a href="#how-to-develop-with-a-cozy-apps-registry-working-in-local-environment">How to develop with a <code>cozy-apps-registry</code> working in local environment</a><ul>
<li><a href="#1-install-and-configure-the-local-cozy-apps-registry">1) Install and configure the local <code>cozy-apps-registry</code></a></li>
<li><a href="#2-configure-the-registry-with-cozy-registryyml">2) Configure the registry with <code>cozy-registry.yml</code></a></li>
<li><a href="#3-run-the-registry-to-serve-the-apps">3) Run the registry to serve the apps</a></li>
<li><a href="#4-create-an-editor">4) Create an editor</a></li>
<li><a href="#5-configure-cozy-stack-with-the-registry">5) Configure <code>cozy-stack</code> with the registry</a></li>
</ul>
</li>
<li><a href="#publish-your-application-on-the-registry">Publish your application on the registry</a><ul>
<li><a href="#1-prepare-your-application">1) Prepare your application</a><ul>
<li><a href="#for-an-application">For an application</a></li>
<li><a href="#for-a-connector">For a connector</a></li>
<li><a href="#properties-meaning-reference">Properties meaning (reference)</a></li>
<li><a href="#translated-manifest-fields">Translated manifest fields</a></li>
<li><a href="#application-terms">Application terms</a></li>
<li><a href="#konnectors-folders-handling">Konnectors folders handling</a></li>
</ul>
</li>
<li><a href="#2-add-a-new-application-in-the-registry">2) Add a new application in the registry</a></li>
<li><a href="#our-official-apps-registry">Our official apps registry</a></li>
<li><a href="#custom-registry">Custom registry</a></li>
<li><a href="#3-add-a-new-version-of-a-registered-application">3) Add a new version of a registered application</a></li>
<li><a href="#via-cozy-app-publishcozy-app-publish-highly-recommanded">Via <a href="https://github.com/cozy/cozy-app-publish"><code>cozy-app-publish</code></a> (highly recommanded)</a></li>
<li><a href="#via-curl">Via <code>curl</code></a></li>
<li><a href="#spaces--virtual-spaces">Spaces &amp; Virtual Spaces</a></li>
<li><a href="#spaces">Spaces</a><ul>
<li><a href="#create-a-space">Create a space</a></li>
<li><a href="#remove-a-space">Remove a space</a></li>
</ul>
</li>
<li><a href="#virtual-spaces">Virtual Spaces</a></li>
<li><a href="#automation-ci">Automation (CI)</a></li>
<li><a href="#access-to-our-official-apps-registry">Access to our official apps registry</a></li>
</ul>
</li>
<li><a href="#access-control-and-tokens">Access control and tokens</a></li>
<li><a href="#maintenance">Maintenance</a></li>
<li><a href="#application-confidence-grade--labelling">Application confidence grade / labelling</a></li>
<li><a href="#community">Community</a></li>
</ul>
<h2 id="what-about-this-repository">What about this repository?<a class="headerlink" href="#what-about-this-repository" title="Permanent link">&para;</a></h2>
<p>The <code>cozy-apps-registry</code> is a go project that implements the <a href="https://github.com/cozy/cozy-stack/blob/master/docs/registry.md">registry
API</a>
described to work with the <a href="https://github.com/cozy/cozy-stack">cozy-stack</a>.</p>
<p>To work properly, it requires:
- Couchdb &gt;= 2.0
- Openstack Object Storage (Swift)</p>
<h2 id="how-to-develop-with-a-cozy-apps-registry-working-in-local-environment">How to develop with a <code>cozy-apps-registry</code> working in local environment<a class="headerlink" href="#how-to-develop-with-a-cozy-apps-registry-working-in-local-environment" title="Permanent link">&para;</a></h2>
<p>Before starting, you will need to have a couchdb running already. That can be the one used by the local <code>cozy-stack</code> if you have one. For this tutorial, couchdb will be running on the default port 5984.</p>
<p>You also must have an OpenStack Object Storage (Swift) up and running. You can follow install instructions on <a href="https://docs.openstack.org/swift/latest/install/index.html">the official website</a></p>
<h3 id="1-install-and-configure-the-local-cozy-apps-registry">1) Install and configure the local <code>cozy-apps-registry</code><a class="headerlink" href="#1-install-and-configure-the-local-cozy-apps-registry" title="Permanent link">&para;</a></h3>
<p>Since this is a golang project, you can install it using <code>go</code> with the followed command:</p>
<div class="codehilite"><pre><span></span>go get -u github.com/cozy/cozy-apps-registry
<span class="nb">cd</span> <span class="nv">$GOPATH</span>/src/github.com/cozy/cozy-apps-registry/
</pre></div>


<p>Then you will need a session secret key to run the registry (this key will be store in the <code>sessionsecret.key</code> file of your working directory) using a password:</p>
<div class="codehilite"><pre><span></span>cozy-apps-registry gen-session-secret --passphrase sessionsecret.key
</pre></div>


<blockquote>
<p>This password is important, you will need it to run the <code>cozy-apps-registry</code> again later. If you lose it, you will have to start again these steps.</p>
</blockquote>
<h3 id="2-configure-the-registry-with-cozy-registryyml">2) Configure the registry with <code>cozy-registry.yml</code><a class="headerlink" href="#2-configure-the-registry-with-cozy-registryyml" title="Permanent link">&para;</a></h3>
<p>Before running the registry, you have to configure it correctly. Don&rsquo;t worry, here is the <code>.yaml</code> file to copy and paste in your <code>cozy-registry.yml</code> (should be in the root folder of <code>cozy-registry/</code>):</p>
<blockquote>
<p>:bulb: You can find an <a href="../cozy-registry.example.yml">example of this configuration file</a> at the root of the directory.</p>
</blockquote>
<div class="codehilite"><pre><span></span><span class="c1"># server host (serve command) - flag --host</span>
<span class="l l-Scalar l-Scalar-Plain">host</span><span class="p p-Indicator">:</span> <span class="s">&quot;localhost&quot;</span>
<span class="c1"># server port (serve command) - flag --port</span>
<span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">8081</span>

<span class="l l-Scalar l-Scalar-Plain">couchdb</span><span class="p p-Indicator">:</span>
  <span class="c1"># CouchDB server url - flag --couchdb-url</span>
  <span class="l l-Scalar l-Scalar-Plain">url</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">http://localhost:5984</span>
  <span class="c1"># CouchDB user - flag --couchdb-user</span>
  <span class="l l-Scalar l-Scalar-Plain">user</span><span class="p p-Indicator">:</span> <span class="s">&#39;&#39;</span>
  <span class="c1"># CouchDB password - flag --couchdb-password</span>
  <span class="l l-Scalar l-Scalar-Plain">password</span><span class="p p-Indicator">:</span> <span class="s">&#39;&#39;</span>
  <span class="c1"># CouchDB prefix for the registries databases - flag --couchdb-prefix</span>
  <span class="l l-Scalar l-Scalar-Plain">prefix</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">registry1</span>

<span class="l l-Scalar l-Scalar-Plain">swift</span><span class="p p-Indicator">:</span>
  <span class="c1"># Swift auth URL (provided by keystone)</span>
  <span class="l l-Scalar l-Scalar-Plain">auth_url</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">http://172.28.128.3/identity/v3</span>
  <span class="c1"># Swift username</span>
  <span class="l l-Scalar l-Scalar-Plain">username</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">admin</span>
  <span class="c1"># Swift password</span>
  <span class="l l-Scalar l-Scalar-Plain">api_key</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">secret</span>
  <span class="c1"># Endpoint type (public/admin/internal)</span>
  <span class="l l-Scalar l-Scalar-Plain">endpointy_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">public</span>
  <span class="c1"># Project name</span>
  <span class="l l-Scalar l-Scalar-Plain">tenant</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">demo</span>
  <span class="c1"># Swift domain</span>
  <span class="l l-Scalar l-Scalar-Plain">domain</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>

<span class="c1"># Path to the session secret file containing the master secret to generate</span>
<span class="c1"># session token.</span>
<span class="c1">#</span>
<span class="c1"># Should be generated with the &quot;gen-session-secret&quot; command.</span>
<span class="l l-Scalar l-Scalar-Plain">session-secret</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">sessionsecret.key</span>
</pre></div>


<p>Feel free to change it if some configurations change in your case (the couchdb user, the server parameters or the databases prefix for example).</p>
<blockquote>
<p><strong>Notices :</strong>
- Here the generated session token (step 1) is stored in the <code>sessionsecret.key</code> file of the working directory, this is so the value of the property <code>session-secret</code> at the end of the configuration file.
- By default, the local couchdb allow all admin accesses without creating users, so there is no user and password here. But if an admin user has been created, you have to use the properties <code>user</code> and <code>password</code> in the <code>couchdb</code> part to provide these informations.</p>
</blockquote>
<p>It&rsquo;s also possible to use env variables for configuration. You can take the key from the configuration file and add the <code>COZY_REGISTRY</code> prefix. For example, you can run:</p>
<div class="codehilite"><pre><span></span><span class="nv">COZY_REGISTRY_PORT</span><span class="o">=</span><span class="m">8081</span> cozy-apps-registry serve
</pre></div>


<p>There is also the <code>REGISTRY_SESSION_PASS</code> env variable for the password for the session secret.</p>
<h3 id="3-run-the-registry-to-serve-the-apps">3) Run the registry to serve the apps<a class="headerlink" href="#3-run-the-registry-to-serve-the-apps" title="Permanent link">&para;</a></h3>
<p>Run the registry using this followed command (here our configuration file is a <code>cozy-registry.yml</code> in the current working directory):</p>
<div class="codehilite"><pre><span></span>cozy-apps-registry serve -c cozy-registry.yml
</pre></div>


<p>At this step, you should have a cozy-apps-registry running and ready for the development.</p>
<p>If you runnig the registry for the first time you can see the next steps to create a new editor and to configure your local <code>cozy-stack</code> to run with this new registry.</p>
<blockquote>
<p>The <code>-c</code> options is always mandatory if you want to specify a config file like here.</p>
</blockquote>
<h3 id="4-create-an-editor">4) Create an editor<a class="headerlink" href="#4-create-an-editor" title="Permanent link">&para;</a></h3>
<p>This step is required to submit new applications in the registry.
In another terminal, run these commands to create an editor (the one that will submit the application(s)) and generate an access token:</p>
<div class="codehilite"><pre><span></span>cozy-apps-registry add-editor Cozy -c cozy-registry.yml
cozy-apps-registry gen-token --master Cozy -c cozy-registry.yml
</pre></div>


<p>Here we go, you have now an registry ready and running on the 8081 port.</p>
<blockquote>
<p>The <code>-c</code> options is always mandatory if you want to specify a config file like here.</p>
</blockquote>
<h3 id="5-configure-cozy-stack-with-the-registry">5) Configure <code>cozy-stack</code> with the registry<a class="headerlink" href="#5-configure-cozy-stack-with-the-registry" title="Permanent link">&para;</a></h3>
<p>On the <code>cozy-stack</code>, you have to add the new registry in the stack configuration file <a href="https://github.com/cozy/cozy-stack/blob/master/docs/config.md#main-configuration-file"><code>cozy.yaml</code></a> (registries property):</p>
<div class="codehilite"><pre><span></span><span class="nn">...</span>
<span class="l l-Scalar l-Scalar-Plain">registries</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">default</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">http://localhost:8081/</span>
<span class="nn">...</span>
</pre></div>


<p>Now restart your local <code>cozy-stack</code> to take this new configuration in consideration (stop and run again <code>cozy-stack serve</code>) and you&rsquo;re ready to work with the <code>cozy-apps-registry</code>!</p>
<h2 id="publish-your-application-on-the-registry">Publish your application on the registry<a class="headerlink" href="#publish-your-application-on-the-registry" title="Permanent link">&para;</a></h2>
<p>If you need more details about the registry you can go to <a href="https://cozy.github.io/cozy-stack/registry.html">the official registry documentation</a></p>
<p><strong>:warning: Important:</strong> In this whole documentation, by the term <code>application</code>, we mean a web application or a konnector. Indeed, for the registry, all entities are applications and they can be either <code>webapp</code> or <code>konnector</code> type.</p>
<h3 id="1-prepare-your-application">1) Prepare your application<a class="headerlink" href="#1-prepare-your-application" title="Permanent link">&para;</a></h3>
<h5 id="for-an-application">For an application<a class="headerlink" href="#for-an-application" title="Permanent link">&para;</a></h5>
<p>To be publishable, your application requires some informations in its <code>manifest.webapp</code>, the manifest of a Cozy application. Here is an example for the application Drive:</p>
<details>

wzxhzdk:7


</details>

<h5 id="for-a-connector">For a connector<a class="headerlink" href="#for-a-connector" title="Permanent link">&para;</a></h5>
<p>To be publishable, your konnector requires some informations in its <code>manifest.konnector</code>, the manifest of a Cozy konnector. Here is an example for the konnector <code>cozy-konnector-trainline</code>:</p>
<details>

wzxhzdk:8


</details>

<h5 id="properties-meaning-reference">Properties meaning (reference)<a class="headerlink" href="#properties-meaning-reference" title="Permanent link">&para;</a></h5>
<p>Here are all properties meaning for the manifest file (for webapp and konnectors) sorted alphabetically:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>aggregator</code></td>
<td>Object containing aggregator data. Typically <code>{ accountId: 'aggregator-service' }</code>.</td>
</tr>
<tr>
<td><code>categories</code></td>
<td>array of categories for your apps (see authorized categories), it will be <code>['others']</code> by default if empty</td>
</tr>
<tr>
<td><code>data_types</code></td>
<td><em>(konnector specific)</em> Array of the data type the konnector will manage</td>
</tr>
<tr>
<td><code>developer</code></td>
<td><code>name</code> and <code>url</code> for the developer</td>
</tr>
<tr>
<td><code>editor</code></td>
<td>the editor&rsquo;s name to display on the cozy-bar (<strong>REQUIRED</strong>)</td>
</tr>
<tr>
<td><code>fields</code></td>
<td><em>(konnector specific)</em> JSON object describing the fields need by the konnector (<strong>except folder path</strong>). Used to generate a form. See <a href="https://github.com/cozy/cozy-collect/blob/master/docs/konnector-manifest.md#fields-property">collect documentation</a></td>
</tr>
<tr>
<td><code>folders</code></td>
<td><em>(konnector specific)</em> A list of folders required by the konnector to store files according to datatype (see the <a href="#konnectors-folders-handling">specific documentation below</a>)</td>
</tr>
<tr>
<td><code>frequency</code></td>
<td><em>(konnector specific)</em> A human readable value between <code>monthly</code>, <code>weekly</code>, <code>daily</code>, indicating the interval of time between two runs of the konnector. Default : <code>weekly</code>.</td>
</tr>
<tr>
<td><code>icon</code></td>
<td>path to the icon for the home (path in the build)</td>
</tr>
<tr>
<td><code>intents</code></td>
<td><em>(application specific)</em> a list of intents provided by this app (see <a href="https://cozy.github.io/cozy-stack/intents.html">cozy-stack intents doc</a> for more details)</td>
</tr>
<tr>
<td><code>langs</code></td>
<td>Languages available in your app (can be different from locales)</td>
</tr>
<tr>
<td><code>language</code></td>
<td><em>(konnector specific)</em> the konnector development language used (ex: <code>node</code>)</td>
</tr>
<tr>
<td><code>license</code></td>
<td><a href="https://spdx.org/licenses/">the SPDX license identifier</a></td>
</tr>
<tr>
<td><code>locales</code></td>
<td>an object with language slug as property, each name property is an object of localized informations (see the second part below)</td>
</tr>
<tr>
<td><code>manifest_version</code></td>
<td>The current manifest version used. This is a versioning for the manifest and allow better retrocompatiblity when processing app manifest</td>
</tr>
<tr>
<td><code>messages</code></td>
<td><em>(konnector specific)</em> Array of message identifiers, which can be used by application to display information at known areas. See example in <a href="https://github.com/cozy/cozy-collect/blob/master/docs/konnector-manifest.md#messages-example">collect documentation</a>.</td>
</tr>
<tr>
<td><code>name</code></td>
<td>the name to display on the home (<strong>REQUIRED</strong>)</td>
</tr>
<tr>
<td><code>name_prefix</code></td>
<td>the prefix to display with the name</td>
</tr>
<tr>
<td><code>oauth</code></td>
<td><em>(konnector specific)</em> JSON object containing oAuth information, like <code>scope</code>. If a manifest provides an <code>oauth</code> property, it is considered as an OAuth konnector.</td>
</tr>
<tr>
<td><code>parameters</code></td>
<td><em>(konnector specific)</em> Additional parameters which should be passed to the konnector. Used for example for bank konnectors to pass a <code>bankId</code> parameter.</td>
</tr>
<tr>
<td><code>partnership</code></td>
<td>an object to provide informations (to display in the Store for example) about a partnership related to the application (<code>icon</code> <code>description</code>, <code>name</code> and <code>domain</code>)</td>
</tr>
<tr>
<td><code>permissions</code></td>
<td>a map of permissions needed by the app (see <a href="https://cozy.github.io/cozy-stack/permissions.html">see cozy-stack permissions doc </a> for more details)</td>
</tr>
<tr>
<td><code>platforms</code></td>
<td><em>(application specific)</em> List of objects for platform native applications. For now there are only two properties: <code>type</code> (i.e. <code>'ios'</code> or <code>'linux'</code>) and the optional <code>url</code> to reach this application page.</td>
</tr>
<tr>
<td><code>routes</code></td>
<td><em>(application specific)</em> a map of routes for the app (see <a href="https://cozy.github.io/cozy-stack/apps.html#routes">cozy-stack routes doc</a> for more details) (<strong>REQUIRED</strong>)</td>
</tr>
<tr>
<td><code>screenshots</code></td>
<td>an array of paths to the screenshots of the application (paths in the build)</td>
</tr>
<tr>
<td><code>services</code></td>
<td><em>(application specific)</em> a map of the services associated with the app (see <a href="https://cozy.github.io/cozy-stack/apps.html#services">cozy-stack services doc</a> for more details)</td>
</tr>
<tr>
<td><code>slug</code></td>
<td>the default slug that should never change (alpha-numeric lowercase) (<strong>REQUIRED</strong>)</td>
</tr>
<tr>
<td><code>source</code></td>
<td>where the files of the app can be downloaded (by default it will look for the branch <code>build</code>)</td>
</tr>
<tr>
<td><code>tags</code></td>
<td>a list a tags describing your application and features (useful for indexing and search)</td>
</tr>
<tr>
<td><code>terms</code></td>
<td>an object defining  properties for terms that need to be displayed/accepted by the user when installing the application (<a href="#application-terms">more-info-below</a>)</td>
</tr>
<tr>
<td><code>time_interval</code></td>
<td><em>(konnector specific)</em> By defaults, konnector triggers are scheduled randomly between 00:00 AM and 05:00 AM. Those two values can be overwritten thanks to this property, by passing an array containing two values: first is the interval start hour, second is the interval end hour. Example: <code>[15, 21]</code> will randomly schedule the konnector trigger between 15:00 (03:00 PM) and 21:00 (09:00 PM). The time zone used is GMT.</td>
</tr>
<tr>
<td><code>type</code></td>
<td>type of application (<code>konnector</code> or <code>webapp</code>) (<strong>REQUIRED</strong>)</td>
</tr>
<tr>
<td><code>version</code></td>
<td>the current version number (<strong>REQUIRED</strong>)</td>
</tr>
<tr>
<td><code>vendor_link</code></td>
<td><em>(konnector specific)</em> URL to editor or service website</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Notices:</strong>
- All images paths (<code>icon</code>, <code>partnership.icon</code> and <code>screenshots</code>) should be relative to the build directory. For example, here, the <code>icon.svg</code> is stored in the build root directory and all <code>screenshots</code> are store in a folder <code>screenshots</code> in the build directory. Therefore, if you use a bundler (like webpack) be sure to know exactly where the bundler will store these assets in the build directory (and change it in the manifest if needed).
- All properties in <code>locales</code> objects will override the matched property of the main <code>manifest.webapp</code> body, if a property is not found in <code>locales</code> it will fallback to the main body one.
- We use to have the <code>en</code> locale as default one if the one wanted by the user doesn&rsquo;t exist. Be sure to have, at least, that locale complete with the name and all descriptions.
- In your build files, this <code>manifest.webapp</code> file must be at the root.</p>
</blockquote>
<h5 id="translated-manifest-fields">Translated manifest fields<a class="headerlink" href="#translated-manifest-fields" title="Permanent link">&para;</a></h5>
<p>Here are the properties that you can override using <code>locales</code> (we recommand to automatically build these properties according to your locales files if you&rsquo;re using a translating tool like <code>transifex</code>) :</p>
<ul>
<li><code>name</code></li>
<li><code>short_description</code></li>
<li><code>long_description</code></li>
<li><code>changes</code></li>
<li><code>screenshots</code></li>
<li><code>folders</code></li>
</ul>
<h5 id="application-terms">Application terms<a class="headerlink" href="#application-terms" title="Permanent link">&para;</a></h5>
<p>You can provide a related <code>terms</code> property if you want to display and make the user accept some terms (ToS for example) just before installing the application. Here are all properties allowed and used:</p>
<ul>
<li><code>url</code>, the URL of the terms/contract to redirect the user to (<strong>REQUIRED</strong>)</li>
<li><code>version</code>: A specific version of the terms, we need it handle terms updates and ask the user again to accept the update. The special characters <code>[*+~.()'"!:@]</code> are not allowed here. (<strong>REQUIRED</strong>)</li>
<li><code>id</code>: An id for the terms. When accepting terms, we store in <code>io.cozy.terms</code>, a document containing the <code>id</code> and <code>version</code> so that we know which terms have been accepted, and show the user a modal if the terms have not been accepted yet. The special characters <code>[*+~.()'"!:@]</code> are not allowed here. (<strong>REQUIRED</strong>)</li>
</ul>
<h5 id="konnectors-folders-handling">Konnectors folders handling<a class="headerlink" href="#konnectors-folders-handling" title="Permanent link">&para;</a></h5>
<p>The <code>folders</code> property is a list of objects with these following properties:</p>
<ul>
<li>
<p><code>defaultDir</code>: (<strong>REQUIRED</strong>) The default root directory of your folder. In this folder will automatically be created a subfolder with the konnector name and into this latter a subfolder with the account name to store the related files. Here you can use some variables in the path like the following:</p>
<ul>
<li><code>$administrative</code>: Folder which will receive all administrative related files (bills, contracts, invoices&hellip;)</li>
<li><code>$photos</code>: Folder which will receive all photos</li>
<li><code>$konnector</code>: The name of the konnector</li>
</ul>
<blockquote>
<p>:warning: All paths provided using <code>defaultDir</code> will be the root directory, not the final folder which will receive the files. For example, if you set <code>$photos</code>, the final folder will be <code>$photos/$konnector/$account</code> in order to keep them always sorted by konnectors and accounts.</p>
</blockquote>
</li>
</ul>
<h3 id="2-add-a-new-application-in-the-registry">2) Add a new application in the registry<a class="headerlink" href="#2-add-a-new-application-in-the-registry" title="Permanent link">&para;</a></h3>
<h4 id="our-official-apps-registry">Our official apps registry<a class="headerlink" href="#our-official-apps-registry" title="Permanent link">&para;</a></h4>
<p>Official registry URL: <code>https://apps-registry.cozycloud.cc</code></p>
<p>In order to use our official repository, you need a token for a specific
editor. To do so, contact us directly at the address contact@cozycloud.cc
with a mail using the following title prefix: <code>[registry]</code> and provide us these folowing information (not changeable after):
- <code>slug</code> of your application
- <code>editor</code> name that you want</p>
<p>We will provide you with the correct token.</p>
<h4 id="custom-registry">Custom registry<a class="headerlink" href="#custom-registry" title="Permanent link">&para;</a></h4>
<p>See the details below to know how to add a new application in a custom <code>cozy-apps-registry</code> instance (local or not).
<details></p>
<blockquote>
<p><strong>Prequisites</strong>:
- For this step, you will need your editor token access generated when you created your editor (see <a href="#4-create-an-editor">below</a>). You have to replace all <code>{{EDITOR_TOKEN}}</code> in this documentation by this token.
- The communication with the registry is done through HTTP requests for now. So we will use the <code>curl</code> command line tool to register our application here.</p>
</blockquote>
<p>Now you can add your application in the registry. This step is splitted in two septs:
  - Add a new application (without versions)
  - Add a version of the application</p>
<p><strong>:pushpin: A new application without registered version won&rsquo;t be displayed by the <a href="https://github.com/cozy/cozy-store"><code>cozy-store</code> application</a>.</strong></p>
<p>To add a new application, you have to do a <code>POST</code> request which all the informations needed to the route <code>registryAddress/registry</code>
with <code>registryAddress</code> your registry address (for example here <code>http://localhost:8081</code>).</p>
<p>Let&rsquo;s add the Collect application as example:</p>
<div class="codehilite"><pre><span></span><span class="c1"># {{EDITOR_TOKEN}} -&gt; your generated editor access token</span>
curl -X <span class="s2">&quot;POST&quot;</span> <span class="s2">&quot;http://localhost:8081/registry&quot;</span> <span class="se">\</span>
     -H <span class="s2">&quot;Authorization: Token {{EDITOR_TOKEN}}&quot;</span> <span class="se">\</span>
     -H <span class="s2">&quot;Content-Type: application/json&quot;</span> <span class="se">\</span>
     -d <span class="s1">$&#39;{</span>
<span class="s1">  &quot;slug&quot;: &quot;collect&quot;,</span>
<span class="s1">  &quot;type&quot;: &quot;webapp&quot;,</span>
<span class="s1">  &quot;editor&quot;: &quot;{{EDITOR}}&quot;</span>
<span class="s1">}&#39;</span>
</pre></div>


<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>slug</td>
<td>your application unique ID</td>
</tr>
<tr>
<td>type</td>
<td>kind of application (it can be only <code>webapp</code> or <code>konnector</code>)</td>
</tr>
<tr>
<td>editor</td>
<td>Name of the editor matching the <code>{{EDITOR_TOKEN}}</code></td>
</tr>
</tbody>
</table>
<p><strong>:warning: Here the <code>slug</code> is the unique ID of the application in the registry, so it can&rsquo;t be changed after the application is already registered.</strong>
</details></p>
<h3 id="3-add-a-new-version-of-a-registered-application">3) Add a new version of a registered application<a class="headerlink" href="#3-add-a-new-version-of-a-registered-application" title="Permanent link">&para;</a></h3>
<h4 id="via-cozy-app-publish-highly-recommanded">Via <a href="https://github.com/cozy/cozy-app-publish"><code>cozy-app-publish</code></a> (highly recommanded)<a class="headerlink" href="#via-cozy-app-publish-highly-recommanded" title="Permanent link">&para;</a></h4>
<p><strong>Here we will show the classical way to add a version using the manual mode of <a href="https://github.com/cozy/cozy-app-publish"><code>cozy-app-publish</code></a> as reference. But you may need to look at  the <a href="#automation-ci">Automation CI part</a> of this documentation instead.</strong></p>
<blockquote>
<p><strong>Prequisites</strong>:
- For this step, you will need your editor token access generated when you created your editor (see <a href="#4-create-an-editor">below</a>). You have to replace all <code>{{EDITOR_TOKEN}}</code> in this documentation by this token.
- Don&rsquo;t forget to build your application first (run <code>yarn build</code>), <code>cozy-app-publish</code> will read the manifest from your build</p>
</blockquote>
<p>Firstly, install the <a href="https://github.com/cozy/cozy-app-publish"><code>cozy-app-publish</code></a> package using
 <code>yarn</code> or <code>npm</code>:</p>
<div class="codehilite"><pre><span></span>yarn add cozy-app-publish --dev
</pre></div>


<blockquote>
<p>You can also install the package as a global package, but don&rsquo;t forget to update it frequently</p>
</blockquote>
<p>Then use it to publish your application, here is an example for <code>collect</code>:</p>
<div class="codehilite"><pre><span></span><span class="x">yarn cozy-app-publish \</span>
<span class="x">--token </span><span class="cp">{{</span><span class="nv">EDITOR_TOKEN</span><span class="cp">}}</span><span class="x"> \</span>
<span class="x">--build-url https://github.com/cozy/cozy-collect/archive/042cef26d9d33ea604fe4364eaab569980b500c9.tar.gz \</span>
<span class="x">--manual-version 1.0.2-dev.042cef26d9d33ea604fe4364eaab569980b500c9</span>
</pre></div>


<p>If you need more information about this tool, you can go to the official <a href="https://github.com/cozy/cozy-app-publish"><code>cozy-app-publish</code> documentation</a>.</p>
<h4 id="via-curl">Via <code>curl</code><a class="headerlink" href="#via-curl" title="Permanent link">&para;</a></h4>
<p><strong>Here we will show the classical way to add a version using <code>curl</code> as reference. But you may need to look at our dedicated tool <a href="https://github.com/cozy/cozy-app-publish"><code>cozy-app-publish</code></a> or the <a href="#automation-ci">Automation CI part</a> of this documentation instead.</strong></p>
<blockquote>
<p><strong>Prequisites</strong>:
- For this step, you will need your editor token access generated when you created your editor (see <a href="#4-create-an-editor">below</a>). You have to replace all <code>{{EDITOR_TOKEN}}</code> in this documentation by this token.
- The communication with the registry is done through HTTP requests for now. So we will use the <code>curl</code> command line tool to register our application here.</p>
</blockquote>
<p>To add a new application, you have to do a <code>POST</code> request which all the informations needed to the route <code>registryAddress/registry/:appSlug</code>
with <code>registryAddress</code> your registry address (for example here <code>http://localhost:8081</code>), <code>:appName</code> your application slug (here <code>drive</code>).</p>
<p>Let&rsquo;s add the version 1.0.1 of the Collect application as example:</p>
<div class="codehilite"><pre><span></span><span class="c1"># {{EDITOR_TOKEN}} -&gt; your generated editor access token</span>
curl -X <span class="s2">&quot;POST&quot;</span> <span class="s2">&quot;http://localhost:8081/registry/collect&quot;</span> <span class="se">\</span>
     -H <span class="s2">&quot;Authorization: Token {{EDITOR_TOKEN}}&quot;</span> <span class="se">\</span>
     -H <span class="s2">&quot;Content-Type: application/json&quot;</span> <span class="se">\</span>
     -d <span class="s1">$&#39;{</span>
<span class="s1">  &quot;url&quot;: &quot;https://github.com/cozy/cozy-collect/archive/1.0.1.tar.gz&quot;,</span>
<span class="s1">  &quot;sha256&quot;: &quot;96212bf53ab618808da0a92c7b6d9f2867b1f9487ba7c1c29606826b107041b5&quot;,</span>
<span class="s1">  &quot;version&quot;: &quot;1.0.1&quot;,</span>
<span class="s1">  &quot;type&quot;: &quot;webapp&quot;,</span>
<span class="s1">  &quot;editor&quot;: &quot;{{EDITOR}}&quot;</span>
<span class="s1">}&#39;</span>
</pre></div>


<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>url</td>
<td>the archive source of your application, it will be downloaded and checked with the sha256 property</td>
</tr>
<tr>
<td>sha256</td>
<td>the sha256 hash of your source archive matching the archive in <code>url</code> (see the notice below)</td>
</tr>
<tr>
<td>version</td>
<td>version of the application, must match the one in the manifest (see the notice below)</td>
</tr>
<tr>
<td>type</td>
<td>kind of application (it can be only <code>webapp</code> or <code>konnector</code>)</td>
</tr>
<tr>
<td>editor</td>
<td>Name of the editor matching the <code>{{EDITOR_TOKEN}}</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>:warning: Important notices:</strong>
- The version must match the one in the <code>manifest.webapp</code> file for stable release. For beta (X.X.X-betaX) or dev releases (X.X.X-dev.hash256), the version before the cyphen must match the one in the <code>manifest.webapp</code>.
- For better integrity, the <code>sha256</code> provided must match the sha256 of the archive provided in <code>url</code>. If it&rsquo;s not the case, that will be considered as an error and the version won&rsquo;t be registered.</p>
</blockquote>
<h3 id="spaces-virtual-spaces">Spaces &amp; Virtual Spaces<a class="headerlink" href="#spaces-virtual-spaces" title="Permanent link">&para;</a></h3>
<h4 id="spaces">Spaces<a class="headerlink" href="#spaces" title="Permanent link">&para;</a></h4>
<p>You can divide your applications between several isolated places, called
<code>spaces</code>.</p>
<p>When an application and its versions are published in a <code>space</code>, they are only
reachable in that one (you can consider a <code>space</code> like a entire sub-part of the
registry). It is espacially useful for splitting up applications by logical
topics.</p>
<p>Most of the CLI and API endpoints have a <code>space</code> option. You can refer to the
documentation or CLI help to view all available parameters.</p>
<h5 id="create-a-space">Create a space<a class="headerlink" href="#create-a-space" title="Permanent link">&para;</a></h5>
<p>Spaces are defined in the config file and are automatically created during registry
launching.</p>
<p>Add a <code>space</code> entry, followed by your spaces names, and let the registry do the work:</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">spaces</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">__default__ myspace foospace</span>
</pre></div>


<h5 id="remove-a-space">Remove a space<a class="headerlink" href="#remove-a-space" title="Permanent link">&para;</a></h5>
<p>To remove a space, you have to clean all the remaining apps &amp; versions before removing the <code>space</code> entry name.</p>
<p>A CLI is available for the job:</p>
<div class="codehilite"><pre><span></span>$ cozy-apps-registry rm-space &lt;your-space&gt;
</pre></div>


<p>Example:</p>
<div class="codehilite"><pre><span></span>$ cozy-apps-registry rm-space foobar
Warning: You are going to remove space foobar and all its applications. This action is irreversible.
Please enter the space name to confirm: foobar
Removing app1/0.7.3-dev.f26bf2b8db3da459071a074a1367ce36e78bb34c
Removing app1/0.7.3-dev.cf1efba4c1b6dd08bb5857f5752790f0d2663d6d
Removing app1/0.7.3-dev.0bbd57a6ce50af82cfbefb8c231fbfe04516e742
Removing app1/0.7.3-dev.21338229a0c2317dc0f3b94e92b22a367f84c537
Removing app1/0.7.3-dev.08ab3624136fb70dc996003aebc3049af51f7438
Removing app1/0.7.3-dev.4e9d174a3b01acaf8a44b561455efc3f34871142
Removing app1/0.7.3-dev.b2654bf00be393aa611fcbb7f70a8ef671895a84
Removing app1/0.7.3-dev.860861868a5dfe294c7120d81fa9feb5387bb57f
Removing app2/0.1.9-dev.954dac9e12e080d591cb76591c311611fed1bea9
</pre></div>


<p>You can now delete the name from your config file.</p>
<h4 id="virtual-spaces">Virtual Spaces<a class="headerlink" href="#virtual-spaces" title="Permanent link">&para;</a></h4>
<p>A <code>virtual space</code> is necessarily built over an existing <code>space</code>. It allows to
filter by selecting or rejecting applications available on the underlying space.</p>
<blockquote>
<p>:warning: Please note that a <code>virtual space</code> does not have any database
document or associated swift object, it does only enforce filters on a
<code>space</code>. Therefore, <strong>it is not possible to publish applications or versions
on a <code>virtual space</code></strong>.</p>
</blockquote>
<h3 id="automation-ci">Automation (CI)<a class="headerlink" href="#automation-ci" title="Permanent link">&para;</a></h3>
<p>The following tutorial explains how to connect your continuous integration
based on Travis to automatically publish new versions on the apps registry.</p>
<p>In this tutorial, we assume:</p>
<ul>
<li>you have a token allowing you to publish applications for your <code>editor</code>:
    <code>{{EDITOR_TOKEN}}</code></li>
<li>you are working on a repository plugged on travis and named on github
    <code>myname/cozy-example</code></li>
</ul>
<p>You first need to add the token to your travis configuration file
<code>.travis.yml</code>. To do so, you need the <a href="https://github.com/travis-ci/travis.rb#installation"><code>travis</code> utility</a> to encrypt its value.</p>
<div class="codehilite"><pre><span></span>$ travis encrypt <span class="nv">REGISTRY_TOKEN</span><span class="o">={{</span>EDITOR_TOKEN<span class="o">}}</span> -r myname/cozy-example --org
Please add the following to your .travis.yml file:

  secure: <span class="s2">&quot;jUAjk..LOOOOONG_ENCRYPTED_STRING.....jdk89=&quot;</span>
</pre></div>


<p>Like said, you need to add this block of ciphered data in the <code>.travis.yml</code> (if it&rsquo;s not already done automatically).
This will allow you to use the <code>REGISTRY_TOKEN</code> variable in your deployment
script.</p>
<p>Then, you can add the publish script in your <code>package.json</code> in order to be used by Travis:</p>
<div class="codehilite"><pre><span></span><span class="err">...</span>
<span class="s2">&quot;publish:cozy&quot;</span><span class="err">:</span> <span class="s2">&quot;git fetch origin ${DEPLOY_BRANCH:-build}:${DEPLOY_BRANCH:-build} &amp;&amp; cozy-app-publish --token $REGISTRY_TOKEN --build-commit $(git rev-parse ${DEPLOY_BRANCH:-build})&quot;</span>
<span class="err">...</span>
</pre></div>


<blockquote>
<p>This script will fetch your last commit from the <code>build</code> branch to publish to the registry. If you push a tag, be sure to wait the last <code>build</code> branch Travis build finished in order to have the real last commit to publish.</p>
</blockquote>
<p>Finally, you can add this script to your <code>.travis.yml</code> to publish your app using our publishing tool <a href="https://github.com/cozy/cozy-app-publish"><code>cozy-app-publish</code></a> during the <code>deploy</code> process:</p>
<div class="codehilite"><pre><span></span>...
before_deploy:
- yarn add cozy-app-publish
deploy:
  - provider: script
    repo: myname/cozy-example
    skip-cleanup: true
    script: export DEPLOY_BRANCH=build &amp;&amp; yarn deploy &amp;&amp; yarn publish:cozy
    on:
      branch: master
  - provider: script
    repo: myname/cozy-example
    skip-cleanup: true
    script: export DEPLOY_BRANCH=build &amp;&amp; yarn publish:cozy
    on:
      tags: true
...
</pre></div>


<blockquote>
<p><strong>Important notices:</strong>
- A commit push to the branch master will publish your application in the <code>dev</code> channel of the registry.
- A tag push (Github release) will publish a stable version (ex: <code>1.0.0</code>) or a beta version (ex: <code>1.0.1-beta2</code>) to the registry (automatically handled by the registry).
- <a href="https://github.com/cozy/cozy-app-publish"><code>cozy-app-publish</code></a> will use the github archive URL computing to get the application tarball. If your applicaiton is not on Github, you may need to use the manual mode of the command.</p>
</blockquote>
<h3 id="access-to-our-official-apps-registry">Access to our official apps registry<a class="headerlink" href="#access-to-our-official-apps-registry" title="Permanent link">&para;</a></h3>
<p>Official registry URL: <code>https://apps-registry.cozycloud.cc</code></p>
<p>In order to use our official repository, you need a token for a specific
editor. To do so, contact us directly at the address contact@cozycloud.cc
with a mail using the following title prefix: <code>[registry]</code> and provide us these folowing information (not changeable after):
- <code>slug</code> of your application
- <code>editor</code> name that you want</p>
<p>We will provide you with the correct token.</p>
<h2 id="access-control-and-tokens">Access control and tokens<a class="headerlink" href="#access-control-and-tokens" title="Permanent link">&para;</a></h2>
<p>The read-only routes of the registry are all public and do not require any
access-contre. However routes allowing to create applications and versions have
access-control policies associated to them.</p>
<p>The registry has two types of access permissions, that are associated to two
different tokens:</p>
<ul>
<li><strong>editor tokens</strong>: these tokens give access to the publication of new versions
    on the registry, for a specific editor name, at these conditions:<ul>
<li>the version&rsquo;s application must already exist in the registry</li>
<li>the version&rsquo;s application must have the same &ldquo;editor&rdquo; value as the token</li>
</ul>
</li>
<li><strong>master tokens</strong>: these tokens are allowed to create and register new
    applications on the registry, and associate them with an existing editor
    name. They also have the same accesses as the editor tokens.</li>
</ul>
<p>Editor tokens can be specific to one or more applications names that they are
allowed to publish.</p>
<p>In order to create tokens, the binary offers a <code>gen-token</code> command-line. Here
are some examples to illustrates some usages:</p>
<div class="codehilite"><pre><span></span><span class="c1"># Generating tokens</span>
  <span class="c1"># generate an editor token for the editor &quot;cozy&quot;, for any application</span>
  $ cozy-apps-registry gen-token cozy
  <span class="c1"># generate an editor token for the editor &quot;cozy&quot; expiring after 30 days</span>
  $ cozy-apps-registry gen-token cozy --max-age 30d
  <span class="c1"># generate an editor token for the editor &quot;cozy&quot; for application &quot;collect&quot; and &quot;drive&quot;</span>
  $ cozy-apps-registry gen-token cozy --apps collect,drive
  <span class="c1"># generate a master token associated with the editor &quot;cozy&quot; expiring after 30 days</span>
  $ cozy-apps-registry gen-token cozy --master --max-age 30d

<span class="c1"># Verifying tokens</span>
  <span class="c1"># verify the editor token &quot;XXX&quot; for the editor &quot;cozy&quot;</span>
  $ cozy-apps-registry verify-token cozy <span class="s2">&quot;XXX&quot;</span>
  <span class="c1"># verify the master token &quot;XXX&quot; associated with the editor &quot;cozy&quot;</span>
  $ cozy-apps-registry verify-token cozy <span class="s2">&quot;XXX&quot;</span> --master

<span class="c1"># Revoking tokens</span>
  <span class="c1"># revoke all editors tokens for the cozy editor</span>
  $ cozy-apps-registry revoke-tokens cozy
  <span class="c1"># revoke all master tokens associated with the cozy editor</span>
  $ cozy-apps-registry revoke-tokens cozy --master
</pre></div>


<h2 id="maintenance">Maintenance<a class="headerlink" href="#maintenance" title="Permanent link">&para;</a></h2>
<p>In order to set/unset an application into maintenance mode, the binary offers
a <code>maintenance</code> command-line. Here are some examples of how to use it:</p>
<div class="codehilite"><pre><span></span><span class="c1"># Activate maintenance mode for the application &#39;bank&#39; of space &#39;myspace&#39;</span>
<span class="c1"># Available flagged options:</span>
<span class="c1">#  --infra            specify a maintenance specific to our infra</span>
<span class="c1">#  --no-manual-exec   specify a maintenance disallowing manual execution</span>
<span class="c1">#  --short            specify a short maintenance</span>
$ cozy-apps-registry maintenance activate bank --space myspace

<span class="c1"># Deactivate maintenance mode for the application &#39;bank&#39; of space &#39;myspace&#39;</span>
$ cozy-apps-registry maintenance deactivate bank --space myspace
</pre></div>


<p>Or using a cURL request and a master token:</p>
<div class="codehilite"><pre><span></span>curl -XPUT <span class="se">\</span>
  -H<span class="s2">&quot;Authorization: Token </span><span class="nv">$COZY_REGISTRY_ADMIN_TOKEN</span><span class="s2">&quot;</span> <span class="se">\</span>
  -H<span class="s2">&quot;Content-Type: application/json&quot;</span> <span class="se">\</span>
  -d<span class="s1">&#39;{&quot;flag_infra_maintenance&quot;: false,&quot;flag_short_maintenance&quot;: false,&quot;flag_disallow_manual_exec&quot;: false,&quot;messages&quot;: {&quot;fr&quot;: {&quot;long_message&quot;: &quot;Bla bla bla&quot;,&quot;short_message&quot;: &quot;Bla&quot;},&quot;en&quot;: {&quot;long_message&quot;: &quot;Yadi yadi yada&quot;,&quot;short_message&quot;: &quot;Yada&quot;}}}&#39;</span> <span class="se">\</span>
  https://apps-registry.cozycloud.cc/myspace/registry/maintenance/bank/activate

curl -XPUT <span class="se">\</span>
  -H<span class="s2">&quot;Authorization: Token </span><span class="nv">$COZY_REGISTRY_ADMIN_TOKEN</span><span class="s2">&quot;</span> <span class="se">\</span>
  https://apps-registry.cozycloud.cc/registry/maintenance/bank/deactivate
</pre></div>


<h2 id="application-confidence-grade-labelling">Application confidence grade / labelling<a class="headerlink" href="#application-confidence-grade-labelling" title="Permanent link">&para;</a></h2>
<p>The confidence grade of an applications can be specified by specifying the
<code>data_usage_commitment</code> and <code>data_usage_commitment_by</code> fields of the
application document.</p>
<p>Possible values for these properties are:</p>
<ul>
<li><code>data_usage_commitment</code>: specify a technical commitment from the
  application editor:</li>
<li><code>user_ciphered</code>: technical commitment that the user&rsquo;s data is encrypted
    and can only be known by him.</li>
<li><code>user_reserved</code>: commitment that the data is only used for the user, to
    directly offer its service.</li>
<li><code>none</code>: no commitment</li>
<li><code>data_usage_commitment_by</code>: specify what entity is taking the commitment:</li>
<li><code>cozy</code>: the commitment is taken by cozy</li>
<li><code>editor</code>: the commitment is taken by the application&rsquo;s editor</li>
<li><code>none</code>: no commitment is taken</li>
</ul>
<p>To do that, a command line and admin API are available, and be used as follow:</p>
<div class="codehilite"><pre><span></span>$ cozy-apps-registry modify-app banks --space my_space --data-usage-commitment user_reserved --data-usage-commitment-by editor
</pre></div>


<p>Or using a cURL request and a master token:</p>
<div class="codehilite"><pre><span></span>curl -XPATCH \
  -H&quot;Authorization: Token $COZY_REGISTRY_ADMIN_TOKEN&quot; \
  -H&quot;Content-Type: application/json&quot; \
  -d&#39;{&quot;data_usage_commitment&quot;: &quot;user_reserved&quot;, &quot;data_usage_commitment_by&quot;: &quot;editor&quot;}
  https://apps-registry.cozycloud.cc/my_space/registry/banks
</pre></div>


<h2 id="community">Community<a class="headerlink" href="#community" title="Permanent link">&para;</a></h2>
<p>You can reach the Cozy Community by:</p>
<ul>
<li>Chatting with us on IRC <a href="http://webchat.freenode.net/?randomnick=1&amp;channels=%23cozycloud&amp;uio=d4">#cozycloud on Freenode</a></li>
<li>Posting on our <a href="https://forum.cozy.io/">Forum</a></li>
<li>Posting issues on the <a href="https://github.com/cozy/">Github repos</a></li>
<li>Say Hi! on <a href="https://twitter.com/cozycloud">Twitter</a></li>
</ul>
                </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <!-- Piwik -->
        <script type="text/javascript">
          var _paq = _paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
          _paq.push(['trackPageView']);
          _paq.push(['enableLinkTracking']);
          (function() {
            var u="//matomo.cozycloud.cc/";
            _paq.push(['setTrackerUrl', u+'piwik.php']);
            _paq.push(['setSiteId', '7']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
          })();
        </script>
        <noscript><p><img src="//matomo.cozycloud.cc/piwik.php?idsite=7&rec=1" style="border:0;" alt="" /></p></noscript>
        <!-- End Piwik Code -->
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>
        <script src="../../extra.js"></script>
        <script src="../../search/main.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
