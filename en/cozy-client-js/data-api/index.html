<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <meta name="author" content="CozyCloud - https://cozy.io">
        <link rel="canonical" href="https://docs.cozy.io/cozy-client-js/data-api/">
        <link rel="shortcut icon" href="../../img/favicon.png">
        
        <title>Data System API - Dev Documentation</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
            <link href="../../css/extra.css" rel="stylesheet">
            <link href="../../css/highlight_theme.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

	<script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://docs.cozy.io/">Dev Documentation</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../..">Home</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorials <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../tutorials/app/">Create Your Application</a>
</li>
                            
<li >
    <a href="../../tutorials/konnector/">Develop a Connector</a>
</li>
                            
<li >
    <a href="../../tutorials/selfhost-debian/">Self-Host on Debian</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">How-to <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
  <li class="dropdown-submenu">
    <a href="#">Dev</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../howTos/dev/runCozyDocker/">Run an App in a Cozy using Docker</a>
</li>
            
<li >
    <a href="../../howTos/dev/hmr/">Use Hot Module Replacement in Your App</a>
</li>
            
<li >
    <a href="../../howTos/dev/cordova/">Make a Mobile App Using Cordova</a>
</li>
            
<li >
    <a href="../../howTos/dev/connect-mobile-app-local-stack/">Connect a Mobile App to Your Local Stack</a>
</li>
            
<li >
    <a href="../../howTos/dev/sendmail/">Send and Receive E-mails in Development</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Synchronize</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../howTos/sync/linux/">Install Cozy Drive on GNU/Linux</a>
</li>
    </ul>
  </li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">References <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../references/tech-intro/">Technical introduction to the Cozy platform</a>
</li>
                            
<li >
    <a href="../../references/git-flow/">Our Front-End Git Flow</a>
</li>
                            
  <li class="dropdown-submenu">
    <a href="#">Stack and tools</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">cozy-app-publish</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-app-publish/README/">CLI & Workflow</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-apps-registry</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-apps-registry/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-client</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-client/getting-started/">Getting started</a>
</li>
            
<li >
    <a href="../../cozy-client/how-tos/">How tos</a>
</li>
            
<li >
    <a href="../../cozy-client/api/cozy-client/">Cozy Client API</a>
</li>
            
<li >
    <a href="../../cozy-client/api/cozy-pouch-link/">Cozy Pouch Link API</a>
</li>
            
<li >
    <a href="../../cozy-client/api/cozy-stack-client/">Cozy Stack Client API</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-client-js</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../README/">README</a>
</li>
            
<li >
    <a href="../intro/">Introduction</a>
</li>
            
<li >
    <a href="../browser-sdk-transition/">Transition from cozy-browser-sdk</a>
</li>
            
<li >
    <a href="../offline/">How to support offline</a>
</li>
            
<li >
    <a href="../oauth/">OAuth guide</a>
</li>
            
<li >
    <a href="../auth-api/">Authentication API</a>
</li>
            
<li class="active">
    <a href="./">Data System API</a>
</li>
            
<li >
    <a href="../files-api/">Files API</a>
</li>
            
<li >
    <a href="../jobs-api/">Jobs API</a>
</li>
            
<li >
    <a href="../intents-api/">Intents API</a>
</li>
            
<li >
    <a href="../settings-api/">Settings API</a>
</li>
            
<li >
    <a href="../sharing-api/">Sharing API</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-ui</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-ui/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-doctypes</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-doctypes/docs/README/">README</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.accounts/">Accounts</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.photos.albums/">Albums</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.bank/">Banking doctypes</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.bills/">Bills</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.konnectors/">Connectors</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.contacts/">Contacts</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.files/">Files</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.notifications/">Notifications</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.remote.requests/">Remote requests</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.sessions.logins/">Session logins</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.sharings/">Sharings</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.triggers/">Triggers</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-konnector-libs</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-konnector-libs/api/">API</a>
</li>
            
<li >
    <a href="../../cozy-konnector-libs/cli/">CLI</a>
</li>
            
<li >
    <a href="../../cozy-konnector-libs/dev/">Develop</a>
</li>
            
<li >
    <a href="../../cozy-konnector-libs/errors/">Errors</a>
</li>
            
<li >
    <a href="../../cozy-konnector-libs/operation-linking/">Operation linking</a>
</li>
            
<li >
    <a href="../../cozy-konnector-libs/synchronization/">Synchronization</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-stack</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/README/">README</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Architecture</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/architecture/">General overview</a>
</li>
            
<li >
    <a href="../../cozy-stack/security/">Security</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Usage</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/INSTALL/">Install the cozy-stack</a>
</li>
            
<li >
    <a href="../../cozy-stack/cli/cozy-stack/">Manpages of the command-line tool</a>
</li>
            
<li >
    <a href="../../cozy-stack/config/">Configuration file</a>
</li>
            
<li >
    <a href="../../cozy-stack/instance/">Managing Instances</a>
</li>
            
<li >
    <a href="../../cozy-stack/onboarding/">Onboarding</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">For developpers</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/client-app-dev/">Develop a client-side app</a>
</li>
            
<li >
    <a href="../../cozy-stack/docker/">Running and building Docker images</a>
</li>
            
<li >
    <a href="../../cozy-stack/assets/">Working with the stacka assets</a>
</li>
            
<li >
    <a href="../../cozy-stack/release/">Build a release</a>
</li>
            
<li >
    <a href="../../cozy-stack/CONTRIBUTING/">The contributing guide</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Services</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/auth/">/auth - Authentication & OAuth</a>
</li>
            
<li >
    <a href="../../cozy-stack/apps/">/apps - Applications Management</a>
</li>
            
<li >
    <a href="../../cozy-stack/registry/"> /apps - Apps registry</a>
</li>
            
<li >
    <a href="../../cozy-stack/konnectors/"> /apps - Konnectors</a>
</li>
            
<li >
    <a href="../../cozy-stack/konnectors-workflow/"> /apps - Konnectors workflow</a>
</li>
            
<li >
    <a href="../../cozy-stack/data-system/">/data - Data System</a>
</li>
            
<li >
    <a href="../../cozy-stack/mango/"> /data - Mango</a>
</li>
            
<li >
    <a href="../../cozy-stack/replication/"> /data - Replication</a>
</li>
            
<li >
    <a href="../../cozy-stack/couchdb-quirks/"> /data - CouchDB Quirks</a>
</li>
            
<li >
    <a href="../../cozy-stack/pouchdb-quirks/"> /data - PouchDB Quirks</a>
</li>
            
<li >
    <a href="../../cozy-stack/files/">/files - Virtual File System</a>
</li>
            
<li >
    <a href="../../cozy-stack/references-docs-in-vfs/"> /files - References of documents in VFS</a>
</li>
            
<li >
    <a href="../../cozy-stack/intents/">/intents - Intents</a>
</li>
            
<li >
    <a href="../../cozy-stack/jobs/">/jobs - Jobs</a>
</li>
            
<li >
    <a href="../../cozy-stack/workers/"> /jobs - Workers</a>
</li>
            
<li >
    <a href="../../cozy-stack/move/">/move - Move, export and import an instance</a>
</li>
            
<li >
    <a href="../../cozy-stack/notifications/">/notifications - Notifications</a>
</li>
            
<li >
    <a href="../../cozy-stack/permissions/">/permissions - Permissions</a>
</li>
            
<li >
    <a href="../../cozy-stack/realtime/">/realtime - Realtime</a>
</li>
            
<li >
    <a href="../../cozy-stack/remote/">/remote - Proxy for remote data/API</a>
</li>
            
<li >
    <a href="../../cozy-stack/settings/">/settings - Settings</a>
</li>
            
<li >
    <a href="../../cozy-stack/user-action-required/"> /settings - Terms of Services</a>
</li>
            
<li >
    <a href="../../cozy-stack/sharing/">/sharings - Sharing</a>
</li>
            
<li >
    <a href="../../cozy-stack/sharing-design/"> /sharings - Request for comments</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">konitor</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../konitor/cli/">CLI</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">babel-preset-cozy-app</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../babel-preset-cozy-app/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">commitlint-config-cozy</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../commitlint-config-cozy/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-device-helper</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-device-helper/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">eslint-config-cozy-app</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../eslint-config-cozy-app/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-flags</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-flags/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-realtime</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-realtime/README/">README</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li>
                        <a href="https://github.com/cozy/cozy.github.io/">
                                <i class="fa fa-github"></i>GitHub
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3 main-toc">
<div class="bs-sidebar hidden-print affix" role="complementary">
    <ul class="nav bs-sidenav well" style='padding-left: 0; padding-right: 0; margin-bottom: 1.5rem'>
        <li class="main active"><a href="#data-api">Data API</a></li>
            <li><a href="#cozyclientdatacreatedoctype-attributes">cozy.client.data.create(doctype, attributes)</a></li>
            <li><a href="#cozyclientdatafinddoctype-id">cozy.client.data.find(doctype, id)</a></li>
            <li><a href="#cozyclientdatafindmanydoctype-ids">cozy.client.data.findMany(doctype, [ids])</a></li>
            <li><a href="#cozyclientdatafindalldoctype">cozy.client.data.findAll(doctype)</a></li>
            <li><a href="#cozyclientdatachangesfeeddoctype-options">cozy.client.data.changesFeed(doctype, options)</a></li>
            <li><a href="#cozyclientdataupdatedoctype-doc-newdoc">cozy.client.data.update(doctype, doc, newdoc)</a></li>
            <li><a href="#cozyclientdataupdateattributesdoctype-id-changes">cozy.client.data.updateAttributes(doctype, id, changes)</a></li>
            <li><a href="#cozyclientdatadeletedoctype-doc">cozy.client.data.delete(doctype, doc)</a></li>
            <li><a href="#cozyclientdatadefineindexdoctype-fields">cozy.client.data.defineIndex(doctype, fields)</a></li>
            <li><a href="#cozyclientdataqueryindexreference-query">cozy.client.data.query(indexReference, query)</a></li>
    </ul>
  <div style='padding-left: 2rem'>
    
    <a id='edit-link' href='https://github.com/cozy/cozy.github.io/edit/dev/src/cozy-client-js/data-api.md'>Edit documentation</a>
    <script type='text/javascript'>
        /* Here we detect if the current page is from an external documentation and we 
        change the href of the editing link so it goes to the right repository and file */
        const outsideDocs = [{"name": "cozy-app-publish", "repo": "https://github.com/cozy/cozy-app-publish.git", "subdir": "."}, {"name": "cozy-apps-registry", "repo": "https://github.com/cozy/cozy-apps-registry.git", "subdir": "."}, {"name": "cozy-client", "repo": "https://github.com/cozy/cozy-client.git", "subdir": "docs"}, {"name": "cozy-client-js", "repo": "https://github.com/cozy/cozy-client-js.git", "subdir": "docs"}, {"name": "cozy-ui", "repo": "https://github.com/cozy/cozy-ui.git", "subdir": "docs"}, {"name": "cozy-doctypes", "repo": "https://github.com/cozy/cozy-doctypes.git", "subdir": "."}, {"name": "cozy-konnector-libs", "repo": "https://github.com/konnectors/libs.git", "subdir": "packages/cozy-konnector-libs/docs"}, {"name": "cozy-scripts", "repo": "https://github.com/CPatchane/create-cozy-app.git", "subdir": "packages/cozy-scripts/docs"}, {"name": "cozy-stack", "repo": "https://github.com/cozy/cozy-stack.git", "subdir": "docs"}, {"name": "konitor", "repo": "https://github.com/konnectors/konitor.git", "subdir": "docs"}, {"name": "babel-preset-cozy-app", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/babel-preset-cozy-app"}, {"name": "commitlint-config-cozy", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/commitlint-config-cozy"}, {"name": "cozy-device-helper", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-device-helper"}, {"name": "eslint-config-cozy-app", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/eslint-config-cozy-app"}, {"name": "cozy-flags", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-flags"}, {"name": "cozy-realtime", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-realtime"}]
        const editNode = document.querySelector('#edit-link')
        const pathname = window.location.pathname
        const editURI = 'edit/master/'
        const removeGitSuffix = function (x) { return x.replace(/\.git$/, '') }

        // Returns the external repo associated to a pathname
        const detectExternalRepo = function (pathname) {
            for (var outsideDoc of outsideDocs) {
                if (window.location.pathname.includes('/' + outsideDoc.name + '/')) {
                    return outsideDoc
                }
            }
        }

        // Change the href attribute of a link to point to the correct edition page on GitHub
        // for the passed external documentation
        const fixEditLink = function (editNode, externalDoc) {
            const repoFile = pathname.replace('/en/' + externalDoc.name, '').replace(/\/$/, '.md')
            const baseRepo = removeGitSuffix(externalDoc.repo)
            editNode.href = baseRepo + '/' + editURI + externalDoc.subdir + repoFile
        }

        const externalRepo = detectExternalRepo(pathname)
        if (externalRepo) {
            fixEditLink(editNode, externalRepo)
        }
    </script>
    
  </div>
</div></div>
                <div class="col-md-9" role="main">
                    

<h1 id="data-api">Data API<a class="headerlink" href="#data-api" title="Permanent link">&para;</a></h1>
<h3 id="cozyclientdatacreatedoctype-attributes"><code>cozy.client.data.create(doctype, attributes)</code><a class="headerlink" href="#cozyclientdatacreatedoctype-attributes" title="Permanent link">&para;</a></h3>
<p><code>cozy.client.data.create(doctype, attributes)</code> adds a document to the database.</p>
<p>It returns a promise for the created object. The created object has the same attributes than thoses passed, with an added <code>_id</code>. It&rsquo;s the unique identifier for the created document.</p>
<p>If you use an existing doctype, you should follow its expected format. <strong>v2</strong> does not enforce this, but we plan to on <strong>v3</strong>. Anyway, do you want to be the app that creates empty contacts in the native app ?</p>
<ul>
<li><code>doctype</code> is a string specifying the <a href="../intro/#doctypes--permissions">doctype</a></li>
<li><code>attributes</code> is an object that can be stringified using <code>JSON.stringify</code>: if it is a complex or cyclic object, add a <code>toJSON</code> method to it (native behaviour of <code>JSON.stringify</code>).</li>
</ul>
<p><strong>Warning</strong>: on <strong>v3</strong>, an extra field <code>_rev</code> is added, it is the unique identifier for the document revision, after creation, it will be of the shape <code>1-xxxxxxxxx</code> for first revision.</p>
<div class="codehilite"><pre><span></span><span class="c1">// simple object</span>
<span class="kr">const</span> <span class="nx">book</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;Moby Dick&quot;</span><span class="p">,</span> <span class="nx">author</span><span class="o">:</span><span class="s2">&quot;Herman Melville&quot;</span><span class="p">,</span> <span class="nx">isbn</span><span class="o">:</span> <span class="s2">&quot;42&quot;</span> <span class="p">}</span>
<span class="kr">const</span> <span class="nx">created</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cozy</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">myBooksDoctype</span><span class="p">,</span> <span class="nx">book</span><span class="p">)</span>
<span class="c1">// same fields</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">created</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="nx">created</span><span class="p">.</span><span class="nx">author</span><span class="p">,</span> <span class="nx">created</span><span class="p">.</span><span class="nx">isbn</span><span class="p">)</span>
<span class="c1">// _id, _rev are added</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">created</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span> <span class="nx">created</span><span class="p">.</span><span class="nx">_rev</span><span class="p">)</span>
<span class="c1">// let&#39;s keep it for later</span>
<span class="nx">createdBookId</span> <span class="o">=</span> <span class="nx">created</span><span class="p">.</span><span class="nx">_id</span>
</pre></div>


<h3 id="cozyclientdatafinddoctype-id"><code>cozy.client.data.find(doctype, id)</code><a class="headerlink" href="#cozyclientdatafinddoctype-id" title="Permanent link">&para;</a></h3>
<p><code>cozy.client.data.find(doctype, id)</code> returns the document associated to the given ID.</p>
<p>It returns a promise for the document. It will have the same fields than the returned value of <code>create</code>, including <code>_id</code> and <code>_rev</code>.</p>
<p>If the document does not exist, the promise will be rejected or the callback will be passed an error.</p>
<ul>
<li><code>doctype</code> is a string specifying the <a href="../intro/#doctypes--permissions">doctype</a></li>
<li><code>id</code> is a string specifying the identifier of the document you look for</li>
</ul>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">doc</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cozy</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">myBooksDoctype</span><span class="p">,</span> <span class="nx">createdBookId</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">_rev</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">author</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">isbn</span><span class="p">)</span>
</pre></div>


<h3 id="cozyclientdatafindmanydoctype-ids"><code>cozy.client.data.findMany(doctype, [ids])</code><a class="headerlink" href="#cozyclientdatafindmanydoctype-ids" title="Permanent link">&para;</a></h3>
<p><code>cozy.client.data.findMany(doctype, [ids])</code> returns the documents associated to the given IDs.</p>
<p>It returns a promise for a map, with the given IDs as keys.</p>
<p>When a document is found, the corresponding value will be an object with a
single <code>doc</code> key containing the document.
Documents will have the same fields than the returned values of <code>create</code>,
including <code>_id</code> and <code>_rev</code>.</p>
<p>When a document is missing, the corresponding value will be an object with a
single <code>error</code> key containing the error message.
Even when some document is missing, the promise will still be fulfilled or the
callback will be passed the resulting map, so you can still access the other
documents found and identify the missing ones.</p>
<ul>
<li><code>doctype</code> is a string specifying the
  <a href="../intro/#doctypes--permissions">doctype</a></li>
<li><code>ids</code> is an array of strings specifying the identifiers of the documents you
  look for</li>
</ul>
<p><strong>Warning</strong>: Not available on <strong>v2</strong>. A fallback implementation could be
provided at some point.</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">ids</span> <span class="o">=</span> <span class="p">[</span><span class="nx">createdBookId</span><span class="p">,</span> <span class="p">...]</span>
<span class="kr">const</span> <span class="nx">resultsById</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cozy</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">findMany</span><span class="p">(</span><span class="nx">myBooksDoctype</span><span class="p">,</span> <span class="nx">ids</span><span class="p">)</span>
<span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">id</span> <span class="k">of</span> <span class="nx">ids</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span><span class="nx">doc</span><span class="p">,</span> <span class="nx">error</span><span class="p">}</span> <span class="o">=</span> <span class="nx">resultsById</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`Error while fetching book </span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">: </span><span class="si">${</span><span class="nx">error</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">_rev</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">author</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">isbn</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h3 id="cozyclientdatafindalldoctype"><code>cozy.client.data.findAll(doctype)</code><a class="headerlink" href="#cozyclientdatafindalldoctype" title="Permanent link">&para;</a></h3>
<p><code>cozy.client.data.findAll(doctype)</code> returns the all documents associated to the given doctype.</p>
<p>It returns a promise for a map, with the given IDs as keys.</p>
<p>When a document is found, the corresponding value will be an object with a
single <code>doc</code> key containing the document.
Documents will have the same fields than the returned values of <code>create</code>,
including <code>_id</code> and <code>_rev</code>.</p>
<ul>
<li><code>doctype</code> is a string specifying the
  <a href="../intro/#doctypes--permissions">doctype</a>
  look for</li>
</ul>
<p><strong>Warning</strong>: Not available on <strong>v2</strong>. A fallback implementation could be
provided at some point.</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cozy</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">findAll</span><span class="p">(</span><span class="nx">myBooksDoctype</span><span class="p">)</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Error while fetching books&#39;</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">id</span> <span class="k">of</span> <span class="nx">result</span><span class="p">.</span><span class="nx">keys</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">doc</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">docs</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">_rev</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">author</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">isbn</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>


<h3 id="cozyclientdatachangesfeeddoctype-options"><code>cozy.client.data.changesFeed(doctype, options)</code><a class="headerlink" href="#cozyclientdatachangesfeeddoctype-options" title="Permanent link">&para;</a></h3>
<p><code>cozy.client.data.changesFeed(doctype, options)</code> returns the last changes from CouchDB for the given doctype</p>
<p>It returns a promise for the changes.</p>
<ul>
<li><code>doctype</code> is a string specifying the <a href="../intro/#doctypes--permissions">doctype</a></li>
<li><code>options</code> is an object, only its <code>since</code> parameter is supported currently</li>
</ul>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">changes</span> <span class="o">=</span> <span class="nx">await</span><span class="p">.</span><span class="nx">cozy</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">changesFeed</span><span class="p">(</span><span class="nx">myBooksDoctype</span><span class="p">,</span> <span class="p">{</span> <span class="nx">since</span><span class="o">:</span> <span class="mi">0</span> <span class="p">})</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">changes</span><span class="p">.</span><span class="nx">last_seq</span><span class="p">,</span> <span class="nx">changes</span><span class="p">.</span><span class="nx">results</span><span class="p">)</span>
</pre></div>


<h3 id="cozyclientdataupdatedoctype-doc-newdoc"><code>cozy.client.data.update(doctype, doc, newdoc)</code><a class="headerlink" href="#cozyclientdataupdatedoctype-doc-newdoc" title="Permanent link">&para;</a></h3>
<p><code>cozy.client.data.update(doctype, doc, newdoc)</code> replaces the document by a new version.</p>
<p>It returns a promise for the updated document. The updated document will have the same fields and values than provided in newdoc, the same <code>_id</code> than doc, and a <code>_rev</code> incremented from doc&rsquo;s number.</p>
<p>If the document does not exist, the promise will reject with an error.</p>
<p>If the document current <code>_rev</code> does not match the passed one, it means there is a conflict and the promise is rejected with an error.</p>
<ul>
<li><code>doctype</code> is a string specifying the <a href="../intro/#doctypes--permissions">doctype</a></li>
<li><code>doc</code> is an object with <em>at least</em> the fields <code>_id</code> and <code>_rev</code> containing the identifier and revision of the file you want to update.</li>
<li><code>newdoc</code> is an object, specifying the new content of the document</li>
</ul>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">updates</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;Moby Dick !&quot;</span><span class="p">,</span> <span class="nx">author</span><span class="o">:</span><span class="s2">&quot;THE Herman Melville&quot;</span><span class="p">}</span>
<span class="kr">const</span> <span class="nx">updated</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cozy</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">myBooksDoctype</span><span class="p">,</span> <span class="nx">doc</span><span class="p">,</span> <span class="nx">updates</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">updated</span><span class="p">.</span><span class="nx">_id</span> <span class="o">===</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span><span class="p">)</span> <span class="c1">// _id does not change</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">updated</span><span class="p">.</span><span class="nx">_rev</span><span class="p">)</span> <span class="c1">// 2-xxxxxx</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">updated</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="nx">updated</span><span class="p">.</span><span class="nx">year</span><span class="p">)</span> <span class="c1">// fields are changed</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">updated</span><span class="p">.</span><span class="nx">isbn</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="c1">// update erase fields</span>
</pre></div>


<h3 id="cozyclientdataupdateattributesdoctype-id-changes"><code>cozy.client.data.updateAttributes(doctype, id, changes)</code><a class="headerlink" href="#cozyclientdataupdateattributesdoctype-id-changes" title="Permanent link">&para;</a></h3>
<p><code>cozy.client.data.updateAttributes(doctype, id, changes)</code> applies change to the document.</p>
<p>It returns a promise for the updated document. The updated document will be the result of merging changes into the document with given <code>_id</code> and a incremented <code>_rev</code>.</p>
<p>If the document does not exist, the promise will be rejected or the callback will be passed an error.</p>
<p>This function gives 3 attempts not to conflict.</p>
<ul>
<li><code>doctype</code> is a string specifying the <a href="../intro/#doctypes--permissions">doctype</a></li>
<li><code>id</code> is a string specifying the identifier of the document to update</li>
<li><code>changes</code> is an object</li>
</ul>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">updates</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">year</span><span class="o">:</span> <span class="mi">1852</span><span class="p">}</span>
<span class="kr">const</span> <span class="nx">updated</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cozy</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">updateAttributes</span><span class="p">(</span><span class="nx">myBooksDoctype</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">updates</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">updated</span><span class="p">.</span><span class="nx">_id</span> <span class="o">===</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span><span class="p">)</span> <span class="c1">// _id does not change</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">updated</span><span class="p">.</span><span class="nx">_rev</span><span class="p">)</span> <span class="c1">// 3-xxxxxx</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">updated</span><span class="p">.</span><span class="nx">year</span><span class="p">)</span> <span class="c1">// fields are changed</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">updated</span><span class="p">.</span><span class="nx">isbn</span><span class="p">)</span> <span class="c1">// updateAttributes preserve other fields</span>
</pre></div>


<h3 id="cozyclientdatadeletedoctype-doc"><code>cozy.client.data.delete(doctype, doc)</code><a class="headerlink" href="#cozyclientdatadeletedoctype-doc" title="Permanent link">&para;</a></h3>
<p><code>cozy.client.data.delete(doctype, doc )</code> will erase the document from the database.</p>
<p>It returns a promise which will be resolved when the document has been deleted.</p>
<p>If the document does not exist, the promise will be rejected with an error. If the document current <code>_rev</code> does not match the passed one, it means there is a conflict and the promise is rejected with an error.</p>
<ul>
<li><code>doctype</code> is a string specifying the <a href="../intro/#doctypes--permissions">doctype</a></li>
<li><code>doc</code> is an object with <em>at least</em> the fields <code>_id</code> and <code>_rev</code> containing the identifier and revision of the file you want to destroy.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="nx">await</span> <span class="nx">cozy</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">myBooksDoctype</span><span class="p">,</span> <span class="nx">updated</span><span class="p">)</span>
</pre></div>


<h3 id="cozyclientdatadefineindexdoctype-fields"><code>cozy.client.data.defineIndex(doctype, fields)</code><a class="headerlink" href="#cozyclientdatadefineindexdoctype-fields" title="Permanent link">&para;</a></h3>
<p><code>cozy.client.data.defineIndex(doctype, fields)</code> creates an index for a document type. It is idempotent, it can be called several time with no bad effect.</p>
<p>It returns a promise for an <strong>indexReference</strong>, which can be passed to <code>cozy.data.query</code>.</p>
<ul>
<li><code>doctype</code> is a string specifying the <a href="../intro/#doctypes--permissions">doctype</a></li>
<li><code>fields</code> is an array of the fields name to index</li>
</ul>
<p><strong>Warning</strong>: when used on <strong>v2</strong>, a map-reduce view is created internally, when used on <strong>v3</strong>, we use couchdb built-in mango queries.</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">booksByYearRef</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cozy</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">defineIndex</span><span class="p">(</span><span class="nx">myType</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;rating&#39;</span><span class="p">])</span>
</pre></div>


<h3 id="cozyclientdataqueryindexreference-query"><code>cozy.client.data.query(indexReference, query)</code><a class="headerlink" href="#cozyclientdataqueryindexreference-query" title="Permanent link">&para;</a></h3>
<p><code>cozy.client.data.query(indexReference, query)</code> find documents using an index.</p>
<p>It returns a promise with a list of documents matching the query. Results will be returned in the order defined for the index.</p>
<ul>
<li><code>query</code> is an object with the following fields:</li>
<li><code>selector</code>: a mango selector</li>
<li><code>limit</code>: maximum number of results</li>
<li><code>skip</code>: ignore the first x results (pagination)</li>
<li><code>wholeResponse</code>: when set to true, the whole query response will be returned instead of just the docs. This is useful when paginating, because you&rsquo;ll get the <code>next</code> property in the response object.</li>
</ul>
<p><strong>Warning</strong>: complex mango queries are not compatible with <strong>v2</strong></p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cozy</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">booksByYearRef</span><span class="p">,</span> <span class="p">{</span>
  <span class="s2">&quot;selector&quot;</span><span class="o">:</span> <span class="p">{</span><span class="nx">year</span><span class="o">:</span> <span class="mi">1851</span><span class="p">},</span>
  <span class="s2">&quot;limit&quot;</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
  <span class="s2">&quot;skip&quot;</span><span class="o">:</span> <span class="mi">1</span>
<span class="p">})</span>

<span class="nx">results</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">3</span> <span class="c1">// we limited to 3 results</span>
<span class="nx">resuts</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">_id</span> <span class="o">===</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span>
<span class="nx">resuts</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">title</span> <span class="o">===</span> <span class="s2">&quot;Moby Dick&quot;</span>
<span class="nx">resuts</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">rating</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="c1">// lowest rating first</span>
</pre></div>
                </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <!-- Piwik -->
        <script type="text/javascript">
          var _paq = _paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
          _paq.push(['trackPageView']);
          _paq.push(['enableLinkTracking']);
          (function() {
            var u="//matomo.cozycloud.cc/";
            _paq.push(['setTrackerUrl', u+'piwik.php']);
            _paq.push(['setSiteId', '7']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
          })();
        </script>
        <noscript><p><img src="//matomo.cozycloud.cc/piwik.php?idsite=7&rec=1" style="border:0;" alt="" /></p></noscript>
        <!-- End Piwik Code -->
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>
        <script src="../../extra.js"></script>
        <script src="../../search/main.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
